<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silver Fox Marketing STL - Enhanced Order Processing Tool</title>
    
    <!-- Google API Client Library -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* CSS Custom Properties for Light/Dark Theme */
        :root {
            /* Light Theme (Default) */
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f8f9fa;
            --bg-gradient-start: #ffffff;
            --bg-gradient-end: #f8f9fa;
            --text-primary: #220901;
            --text-secondary: #2c3e50;
            --text-muted: rgba(34, 9, 1, 0.7);
            --border-primary: #e0e0e0;
            --border-secondary: #e3e6ea;
            --border-accent: #220901;
            --input-bg: #ffffff;
            --input-border: #ddd;
            --input-focus: #007bff;
            --button-primary: #007bff;
            --button-success: #28a745;
            --button-danger: #dc3545;
            --button-secondary: #6c757d;
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-medium: rgba(0, 0, 0, 0.15);
            --summary-bg: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
            --summary-border: #e3e6ea;
            --summary-text: #2c3e50;
            --modal-bg: #ffffff;
            --modal-shadow: rgba(0, 0, 0, 0.5);
            --table-stripe: #f8f9fa;
            --table-hover: #e9ecef;
            --table-header-bg: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3a3a3a;
            --bg-gradient-start: #2d2d2d;
            --bg-gradient-end: #3a3a3a;
            --text-primary: #e0e0e0;
            --text-secondary: #c0c0c0;
            --text-muted: rgba(224, 224, 224, 0.7);
            --border-primary: #444444;
            --border-secondary: #555555;
            --border-accent: #e0e0e0;
            --input-bg: #3a3a3a;
            --input-border: #555555;
            --input-focus: #4dabf7;
            --button-primary: #4dabf7;
            --button-success: #51cf66;
            --button-danger: #ff6b6b;
            --button-secondary: #868e96;
            --shadow-light: rgba(0, 0, 0, 0.3);
            --shadow-medium: rgba(0, 0, 0, 0.5);
            --summary-bg: linear-gradient(135deg, #2d2d2d 0%, #3a3a3a 100%);
            --summary-border: #555555;
            --summary-text: #c0c0c0;
            --modal-bg: #2d2d2d;
            --modal-shadow: rgba(0, 0, 0, 0.7);
            --table-stripe: #3a3a3a;
            --table-hover: #4a4a4a;
            --table-header-bg: linear-gradient(180deg, #3a3a3a 0%, #4a4a4a 100%);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--bg-secondary);
            border-radius: 10px;
            box-shadow: 0 2px 10px var(--shadow-light);
            overflow: visible;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        .header {
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            border-bottom: 3px solid var(--border-accent);
            color: var(--text-primary);
            padding: 25px 30px;
            position: relative;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        
        .logo-image {
            height: 50px;
            width: auto;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
            margin: 10px 15px;
        }

        .settings-section {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Dark Mode Toggle Switch */
        .theme-toggle {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
        }

        .theme-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border-primary);
            transition: all 0.3s ease;
            border-radius: 28px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .theme-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background: var(--bg-secondary);
            transition: all 0.3s ease;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .theme-toggle input:checked + .theme-slider {
            background: var(--button-primary);
        }

        .theme-toggle input:checked + .theme-slider:before {
            transform: translateX(24px);
        }

        .theme-icon {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            color: var(--text-muted);
            transition: all 0.3s ease;
        }

        .theme-icon.sun {
            left: 6px;
        }

        .theme-icon.moon {
            right: 6px;
        }

        .theme-toggle input:checked ~ .theme-icon.sun {
            opacity: 0.3;
        }

        .theme-toggle input:not(:checked) ~ .theme-icon.moon {
            opacity: 0.3;
        }

        .settings-btn {
            background: var(--bg-tertiary);
            border: 2px solid var(--border-primary);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.3s ease;
            opacity: 0.7;
        }

        .settings-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-secondary);
            transform: rotate(15deg);
            opacity: 1;
            color: var(--text-primary);
        }

        .settings-btn svg {
            width: 20px;
            height: 20px;
        }

        .main-content {
            display: flex;
            min-height: 600px;
            height: auto;
            width: 100%;
            box-sizing: border-box;
        }

        .form-section {
            flex: 1;
            padding: 30px;
            border-right: 2px solid var(--border-primary);
            background: var(--bg-secondary);
            transition: background-color 0.3s ease, border-color 0.3s ease;
            min-width: 0; /* Prevents flex overflow */
            box-sizing: border-box;
        }

        .summary-section {
            flex: 1;
            padding: 30px;
            background: linear-gradient(180deg, var(--bg-tertiary) 0%, var(--bg-secondary) 100%);
            position: relative;
            min-height: auto;
            height: auto;
            overflow: visible;
            transition: background 0.3s ease;
            min-width: 0; /* Prevents flex overflow */
            box-sizing: border-box;
        }
        
        .summary-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--border-accent) 50%, transparent);
            opacity: 0.1;
        }

        .form-group {
            margin-bottom: 20px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--text-secondary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 14px;
            font-weight: 400;
            transition: border-color 0.3s ease, background-color 0.3s ease, color 0.3s ease;
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: var(--input-focus);
            outline: none;
            box-shadow: 0 0 0 3px rgba(64, 171, 247, 0.1);
        }
        
        /* Placeholder text styling */
        input::placeholder,
        textarea::placeholder,
        select::placeholder {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 14px;
            font-weight: 400;
            color: var(--text-muted);
            transition: color 0.3s ease;
        }

        /* Small helper text and character warnings */
        small,
        .char-warning {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
            font-size: 12px !important;
            font-weight: 400 !important;
        }

        /* Button text standardization */
        button,
        .btn {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-weight: 600;
        }

        /* Fix dropdown border consistency */
        select,
        #orderTypeSelect {
            border: 2px solid #ddd !important;
            border-radius: 8px !important;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6,9 12,15 18,9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
            padding-right: 40px;
        }

        /* Extra specific rule for order type select */
        .order-type-selector select,
        .order-type-selector #orderTypeSelect,
        div.order-type-selector select {
            border-top: 2px solid #ddd !important;
            border-right: 2px solid #ddd !important;
            border-bottom: 2px solid #ddd !important;
            border-left: 2px solid #ddd !important;
            border-radius: 8px !important;
            box-sizing: border-box !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            appearance: none !important;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #fd410d;
            box-shadow: 0 0 0 3px rgba(253, 65, 13, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            margin-right: 8px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--button-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--button-primary);
            filter: brightness(0.9);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px var(--shadow-light);
        }

        .btn-secondary {
            background: var(--button-secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: var(--button-secondary);
            filter: brightness(0.9);
        }

        .btn-danger {
            background: var(--button-danger);
            color: white;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-danger:hover {
            background: var(--button-danger);
            filter: brightness(0.9);
        }

        .btn-danger svg {
            flex-shrink: 0;
        }

        .btn-success {
            background: var(--button-success);
            color: white;
            font-weight: 600;
        }

        .btn-success:hover {
            background: var(--button-success);
            filter: brightness(0.9);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px var(--shadow-light);
        }

        .btn-google {
            background: #4285f4;
            color: white;
        }

        .btn-google:hover {
            background: #357ae8;
        }

        .summary-header {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-secondary);
            position: relative;
            transition: border-color 0.3s ease;
        }
        
        .summary-header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: var(--progress-width, 0%);
            height: 3px;
            background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
            transition: width 0.5s ease-in-out;
            border-radius: 2px;
        }
        
        .summary-header h2 {
            font-size: 1.4em;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: -0.5px;
            text-align: center;
            transition: color 0.3s ease;
        }

        /* Dynamic form headings */
        h3 {
            color: var(--text-primary);
            transition: color 0.3s ease;
        }

        .summary-content {
            background: var(--summary-bg);
            padding: 25px;
            border-radius: 12px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            box-shadow: 0 4px 6px var(--shadow-light), 
                        0 1px 3px var(--shadow-medium),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid var(--summary-border);
            transition: all 0.3s ease;
            overflow-wrap: break-word;
            word-break: break-all;
            color: var(--summary-text);
            min-height: 300px;
            height: auto !important;
            max-height: none !important;
            overflow: visible !important;
            display: block;
            max-width: 100%;
            width: 100%;
            box-sizing: border-box;
            overflow-x: hidden;
        }
        
        .summary-content:hover {
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.06), 
                        0 2px 4px rgba(0, 0, 0, 0.08),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .summary-content.character-limit-exceeded {
            border: 3px solid #dc3545 !important;
            box-shadow: 0 0 10px rgba(220, 53, 69, 0.3), inset 0 2px 4px rgba(0,0,0,0.06);
        }
        
        .character-limit-warning {
            background: #dc3545;
            color: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
            display: none;
            text-align: center;
        }

        .action-buttons {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .hidden {
            display: none;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #28a745;
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: slideInRight 0.3s ease;
            z-index: 1000;
        }

        .notification.error {
            background: #dc3545;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }

        /* Settings Panel */
        .settings-panel {
            background: #f9f9f9;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .settings-panel h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .settings-group {
            margin-bottom: 15px;
        }

        .settings-group label {
            font-size: 14px;
            color: #666;
        }

        .folder-path-input {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .folder-path-input input {
            flex: 1;
        }

        /* Nested conditional fields styling */
        .nested-conditional-fields {
            padding: 20px;
            margin-top: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border: 2px solid #e3e6ea;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            position: relative;
            transition: all 0.3s ease;
        }

        .nested-conditional-fields:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
            border-color: #d1d5db;
        }

        .nested-conditional-fields:focus-within {
            border-color: #fd410d;
            box-shadow: 0 8px 25px rgba(253, 65, 13, 0.15);
        }

        .required {
            color: #fd410d;
        }

        small {
            display: block;
            color: #666;
            font-size: 12px;
            margin-bottom: 5px;
        }

        /* Multiple Items Button Styling */
        .multiple-items-container {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .btn-multiple {
            background: #220901;
            color: white;
            width: 100%;
            padding: 15px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-multiple:hover {
            background: #3a1602;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(34, 9, 1, 0.3);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: var(--modal-shadow);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--modal-bg);
            margin: 2% auto;
            padding: 0;
            border-radius: 16px;
            width: clamp(70%, 95vw, 95%);
            min-width: 600px;
            max-width: none;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px var(--shadow-medium),
                        0 10px 20px -5px var(--shadow-light);
            border: 1px solid var(--border-secondary);
            animation: slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        /* Hide mobile summary elements on desktop by default */
        .mobile-summary-fab,
        .mobile-fab-container {
            display: none !important;
        }
        
        /* Hide mobile modal on desktop (but allow JS to show it on mobile) */
        @media (min-width: 769px) {
            .mobile-summary-modal {
                display: none !important;
            }
        }
        
        /* Enhanced Mobile Optimization */
        @media (max-width: 768px) {
            /* Hide desktop summary section on mobile */
            .summary-section {
                display: none;
            }
            
            /* Main content takes full width on mobile */
            .main-content {
                display: block;
            }
            
            .form-section {
                border-right: none;
                padding: 20px 15px;
            }
            
            /* Mobile FAB Container */
            .mobile-fab-container {
                position: fixed;
                bottom: 20px;
                right: 20px;
                display: flex !important;
                flex-direction: column;
                gap: 12px;
                z-index: 1000;
            }
            
            /* Individual Mobile FABs */
            .mobile-fab {
                width: 56px;
                height: 56px;
                border: none;
                border-radius: 50%;
                color: white;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                -webkit-tap-highlight-color: transparent;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            }
            
            .mobile-fab:hover,
            .mobile-fab:active {
                transform: scale(1.1);
                box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
            }
            
            .mobile-fab svg {
                width: 22px;
                height: 22px;
            }
            
            /* Individual FAB Colors */
            .mobile-fab-summary {
                background: var(--button-primary);
                box-shadow: 0 4px 12px rgba(74, 171, 247, 0.4);
            }
            
            .mobile-fab-copy {
                background: #10b981;
                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
            }
            
            .mobile-fab-download {
                background: #8b5cf6;
                box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
            }
            
            .mobile-fab-clear {
                background: #ef4444;
                box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
            }
            
            .mobile-fab-summary:hover {
                box-shadow: 0 6px 16px rgba(74, 171, 247, 0.5);
            }
            
            .mobile-fab-copy:hover {
                box-shadow: 0 6px 16px rgba(16, 185, 129, 0.5);
            }
            
            .mobile-fab-download:hover {
                box-shadow: 0 6px 16px rgba(139, 92, 246, 0.5);
            }
            
            .mobile-fab-clear:hover {
                box-shadow: 0 6px 16px rgba(239, 68, 68, 0.5);
            }
            
            /* Mobile summary modal styling */
            .mobile-summary-modal {
                display: none;
                position: fixed;
                z-index: 1001;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background: var(--modal-shadow);
                backdrop-filter: blur(5px);
                -webkit-backdrop-filter: blur(5px);
            }
            
            .mobile-summary-modal-content {
                background: var(--modal-bg);
                margin: 5% auto;
                padding: 0;
                border-radius: 16px;
                width: 95%;
                max-width: 400px;
                max-height: 85vh;
                overflow: hidden;
                box-shadow: 0 25px 50px -12px var(--shadow-medium),
                            0 10px 20px -5px var(--shadow-light);
                border: 1px solid var(--border-secondary);
                animation: slideUpMobile 0.3s ease-out;
            }
            
            .mobile-summary-header {
                background: linear-gradient(135deg, var(--text-primary) 0%, var(--border-accent) 100%);
                color: white;
                padding: 20px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .mobile-summary-header h3 {
                margin: 0;
                font-size: 1.2rem;
                font-weight: 600;
            }
            
            .mobile-summary-close {
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                color: white;
                width: 32px;
                height: 32px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                font-size: 18px;
                backdrop-filter: blur(10px);
                transition: all 0.3s ease;
            }
            
            .mobile-summary-close:hover {
                background: var(--button-danger);
                border-color: var(--button-danger);
                transform: rotate(90deg) scale(1.1);
            }
            
            .mobile-summary-body {
                padding: 20px;
                max-height: calc(85vh - 80px);
                overflow-y: auto;
                background: var(--modal-bg);
            }
            
            .mobile-summary-content {
                background: var(--summary-bg);
                padding: 15px;
                border-radius: 8px;
                font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
                font-size: 12px;
                line-height: 1.5;
                white-space: pre-wrap;
                word-wrap: break-word;
                border: 1px solid var(--summary-border);
                color: var(--summary-text);
                word-break: break-all;
                max-width: 100%;
                box-sizing: border-box;
                overflow-x: hidden;
            }
            
            .mobile-copy-btn {
                width: 100%;
                margin-top: 15px;
                padding: 12px;
                background: var(--button-success);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                transition: all 0.3s ease;
                -webkit-tap-highlight-color: transparent;
            }
            
            .mobile-copy-btn:hover,
            .mobile-copy-btn:active {
                background: var(--button-primary);
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(74, 171, 247, 0.3);
            }
            
            @keyframes slideUpMobile {
                from {
                    transform: translateY(100px);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }
            
            .modal-content {
                width: 95%;
                min-width: 320px;
                margin: 2% auto;
                max-height: 95vh;
                border-radius: 12px;
            }
            
            .modal-header {
                padding: 20px 25px;
                gap: 10px;
            }
            
            .modal-header h2 {
                font-size: 1.2rem;
            }
            
            .modal-header-logo {
                height: 28px;
            }
            
            .modal-close {
                width: 36px;
                height: 36px;
                font-size: 24px;
                right: 20px;
            }
            
            .modal-body {
                padding: 20px 15px;
                max-height: calc(95vh - 120px);
            }
            
            /* Touch-friendly buttons */
            .add-row-btn, .clear-table-btn, .export-btn {
                min-height: 44px;
                padding: 12px 20px;
                font-size: 16px;
                margin: 8px 4px;
                border-radius: 8px;
                -webkit-tap-highlight-color: transparent;
            }
            
            /* Enhanced touch targets */
            .modal-close {
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
            }
            
            /* Mobile-friendly drag handles */
            .drag-handle {
                width: 24px;
                padding: 12px 8px;
                touch-action: none;
            }
            
            /* Mobile table optimizations */
            .spreadsheet-table {
                font-size: 14px;
                border-collapse: separate;
                border-spacing: 1px;
            }
            
            .spreadsheet-table th,
            .spreadsheet-table td {
                padding: 12px 8px;
                min-height: 44px;
                border-radius: 4px;
            }
            
            .spreadsheet-table input,
            .spreadsheet-table textarea,
            .spreadsheet-table select {
                min-height: 40px;
                font-size: 16px;
                padding: 10px 12px;
                border-radius: 6px;
                -webkit-appearance: none;
                touch-action: manipulation;
            }
            
            /* Prevent zoom on input focus */
            .spreadsheet-table input:focus,
            .spreadsheet-table textarea:focus,
            .spreadsheet-table select:focus {
                font-size: 16px;
            }
            
            /* Enhanced quantity input for mobile */
            .spreadsheet-table td:nth-child(2) input {
                text-align: center;
                font-weight: 600;
                min-width: 60px;
            }
            
            /* Mobile scroll indicators */
            .modal-body::before {
                content: '';
                position: sticky;
                top: 0;
                left: 0;
                width: 100%;
                height: 4px;
                background: linear-gradient(90deg, 
                    var(--button-primary) 0%, 
                    transparent 20%, 
                    transparent 80%, 
                    var(--button-primary) 100%);
                opacity: 0.3;
                z-index: 5;
            }
        }
        
        /* Mobile Main Form Optimization */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
                gap: 15px;
            }
            
            .header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .logo-section {
                justify-content: center;
                gap: 20px;
            }
            
            .logo-image {
                height: 35px;
            }
            
            .settings-section {
                justify-content: center;
            }
            
            .form-section {
                padding: 20px 15px;
                border-radius: 12px;
            }
            
            .form-group {
                margin-bottom: 20px;
            }
            
            .form-group label {
                font-size: 16px;
                margin-bottom: 8px;
                font-weight: 600;
            }
            
            /* Mobile-friendly dropdowns and inputs */
            select, input[type="text"], input[type="number"], textarea {
                min-height: 44px;
                font-size: 16px;
                padding: 12px 16px;
                border-radius: 8px;
                -webkit-appearance: none;
                touch-action: manipulation;
            }
            
            /* Prevent zoom on focus */
            select:focus, input:focus, textarea:focus {
                font-size: 16px;
            }
            
            /* Mobile button styling */
            .btn {
                min-height: 48px;
                padding: 14px 24px;
                font-size: 16px;
                font-weight: 600;
                border-radius: 8px;
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
            }
            
            .btn-primary {
                box-shadow: 0 4px 12px rgba(74, 171, 247, 0.3);
            }
            
            /* Lock icon mobile optimization */
            .lock-icon {
                width: 20px;
                height: 20px;
                right: 8px;
            }
            
            /* Order summary mobile layout */
            .order-summary {
                padding: 15px;
                border-radius: 10px;
                margin-top: 20px;
            }
            
            .order-summary h3 {
                font-size: 1.2rem;
                margin-bottom: 10px;
            }
            
            #summary-content {
                font-size: 14px;
                line-height: 1.5;
                max-height: 250px;
                padding: 12px;
            }
            
            .copy-btn {
                min-height: 44px;
                padding: 12px 20px;
                font-size: 15px;
                margin-top: 12px;
                width: 100%;
            }
        }
        
        /* Small Mobile Devices (< 480px) */
        @media (max-width: 480px) {
            .container {
                padding: 5px;
            }
            
            .header {
                padding: 10px 15px;
            }
            
            .logo-image {
                height: 30px;
            }
            
            .form-section {
                padding: 15px 10px;
            }
            
            .modal-content {
                width: 98%;
                min-width: 280px;
                margin: 1% auto;
                max-height: 98vh;
            }
            
            .modal-header {
                padding: 15px 20px;
            }
            
            .modal-body {
                padding: 15px 10px;
            }
            
            .spreadsheet-table {
                font-size: 13px;
            }
            
            .spreadsheet-table th,
            .spreadsheet-table td {
                padding: 10px 6px;
            }
            
            /* Stack buttons vertically on very small screens */
            .button-container {
                flex-direction: column;
                gap: 8px;
            }
            
            .add-row-btn, .clear-table-btn, .export-btn {
                width: 100%;
                margin: 4px 0;
            }
        }
        
        /* Landscape mobile optimization */
        @media (max-width: 768px) and (orientation: landscape) {
            .modal-content {
                max-height: 90vh;
            }
            
            .modal-body {
                max-height: calc(90vh - 100px);
            }
            
            .header {
                flex-direction: row;
                justify-content: space-between;
                padding: 10px 20px;
            }
        }
        
        @media (min-width: 1200px) {
            .modal-content {
                width: 85%;
            }
        }
        
        @media (min-width: 1600px) {
            .modal-content {
                width: 75%;
            }
        }
        
        @media (min-width: 2000px) {
            .modal-content {
                width: 65%;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--border-accent) 100%);
            color: white;
            padding: 25px 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            transition: background 0.3s ease;
        }

        /* Dark mode modal header */
        [data-theme="dark"] .modal-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--border-accent) 100%);
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header-content {
            display: flex;
            align-items: center;
            gap: 15px;
            animation: modalTitleFadeIn 0.6s ease-out;
        }

        .modal-header-logo {
            height: 35px;
            width: auto;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.4rem;
            font-weight: 600;
            letter-spacing: 0.3px;
            text-align: center;
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        /* Dark mode support for modal headers */
        [data-theme="dark"] .modal-header h2 {
            color: var(--text-primary);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }

        @keyframes modalTitleFadeIn {
            0% {
                opacity: 0;
                transform: translateY(-10px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 50%;
            right: 30px;
            transform: translateY(-50%);
            color: white;
            font-size: 28px;
            font-weight: 300;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 1;
            padding: 0;
            margin: 0;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .modal-close:hover {
            background: var(--button-danger);
            border-color: var(--button-danger);
            color: white;
            transform: translateY(-50%) rotate(90deg) scale(1.1);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }

        .modal-body {
            padding: 30px;
            max-height: calc(90vh - 140px);
            overflow-y: auto;
            background: var(--modal-bg);
            transition: background 0.3s ease;
        }
        
        .modal-body::-webkit-scrollbar {
            width: 10px;
        }
        
        .modal-body::-webkit-scrollbar-track {
            background: var(--input-bg);
            border-radius: 10px;
        }
        
        .modal-body::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 10px;
        }
        
        .modal-body::-webkit-scrollbar-thumb:hover {
            background: var(--border-accent);
        }


        .spreadsheet-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 600px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        /* Responsive table width */
        @media (min-width: 768px) {
            .spreadsheet-table {
                min-width: 800px;
            }
        }
        
        @media (min-width: 1200px) {
            .spreadsheet-table {
                min-width: 1000px;
            }
        }
        
        @media (min-width: 1600px) {
            .spreadsheet-table {
                min-width: 1200px;
            }
        }

        .spreadsheet-table th,
        .spreadsheet-table td {
            border: 1px solid var(--border-light);
            padding: 8px 12px;
            text-align: left;
            background: var(--bg-primary);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        /* Dark mode table cell styling */
        [data-theme="dark"] .spreadsheet-table td {
            background: var(--input-bg);
            border-color: var(--border-color);
        }

        .spreadsheet-table th {
            background: var(--table-header-bg);
            font-weight: 600;
            color: var(--text-primary);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 2px solid #dee2e6;
            padding: 8px 10px;
        }

        .spreadsheet-table input,
        .spreadsheet-table select,
        .spreadsheet-table textarea {
            width: 100%;
            border: 1px solid transparent;
            padding: 6px 8px;
            background: transparent;
            border-radius: 4px;
            transition: all 0.2s ease;
            font-size: 13px;
            line-height: 1.4;
            min-height: 36px;
        }

        .spreadsheet-table textarea {
            resize: vertical;
            min-height: 40px;
            max-height: 150px;
            overflow-y: hidden;
            transition: height 0.1s ease;
        }

        .spreadsheet-table input:focus,
        .spreadsheet-table select:focus,
        .spreadsheet-table textarea:focus {
            outline: none;
            border: 1px solid #4CAF50;
            background: white;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        /* Character limit violation styling for modal cells */
        .spreadsheet-table input.char-limit-exceeded,
        .spreadsheet-table textarea.char-limit-exceeded {
            border: 2px solid #dc3545 !important;
            background-color: #fff5f5 !important;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1) !important;
        }

        /* Modal notification system */
        .modal-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #dc3545;
            color: white;
            padding: 12px 16px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            max-width: 300px;
        }

        .modal-notification.show {
            transform: translateX(0);
        }

        .modal-notification.warning {
            background: #fd7e14;
        }

        .modal-notification.info {
            background: #0d6efd;
        }

        /* Row highlighting and drag-and-drop styles */
        .spreadsheet-table tbody tr {
            cursor: grab;
            transition: background-color 0.2s ease;
            position: relative;
        }

        .spreadsheet-table tbody tr:hover {
            background-color: var(--table-hover);
        }

        .spreadsheet-table tbody tr.row-focused {
            background-color: var(--table-hover);
        }

        .spreadsheet-table tbody tr.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .spreadsheet-table tbody tr.drag-over {
            border-top: 4px solid var(--button-primary);
            background: var(--table-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-light);
            transition: all 0.2s ease;
        }

        .spreadsheet-table tbody tr.drag-over::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--button-primary);
            z-index: 10;
            box-shadow: 0 0 8px var(--button-primary);
        }

        /* Drag and drop animations */
        @keyframes dragPulse {
            0% {
                box-shadow: 0 4px 8px var(--shadow-light), 0 0 0 0 var(--button-primary);
            }
            100% {
                box-shadow: 0 4px 8px var(--shadow-light), 0 0 0 4px rgba(64, 171, 247, 0.2);
            }
        }

        /* Drag handle styling */
        .drag-handle {
            cursor: grab;
            color: var(--text-muted);
            padding: 0 8px;
            user-select: none;
            transition: color 0.2s ease, transform 0.2s ease;
        }

        .drag-handle:hover {
            color: var(--button-primary);
            transform: scale(1.1);
        }

        .drag-handle:active {
            cursor: grabbing;
            transform: scale(0.95);
        }
        
        /* Delete button styling */
        .delete-row-btn {
            background: transparent;
            border: none;
            color: #6c757d;
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
            transition: all 0.2s ease;
            opacity: 0;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .delete-row-btn svg {
            width: 16px;
            height: 16px;
        }
        
        .spreadsheet-table tbody tr:hover .delete-row-btn {
            opacity: 1;
        }
        
        .delete-row-btn:hover {
            background: #dc3545;
            color: white;
        }
        
        .spreadsheet-container {
            overflow-x: auto;
            position: relative;
        }
        
        /* Column width controls */
        .spreadsheet-table th:nth-child(2),
        .spreadsheet-table td:nth-child(2) {
            width: 60px;
            max-width: 60px;
        }
        
        .spreadsheet-table th:nth-child(2) input,
        .spreadsheet-table td:nth-child(2) input {
            text-align: center;
        }

        .add-row-btn {
            margin-top: 10px;
        }

        .modal-footer {
            padding: 15px 20px;
            background: #f8f9fa;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
        }

        /* Order History Modal Styles */
        .order-history-modal .modal-content {
            max-width: 500px;
            width: 90%;
        }

        .order-history-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px 0;
        }

        .order-history-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .order-history-empty svg {
            opacity: 0.5;
            margin-bottom: 15px;
        }

        .order-history-empty p {
            font-size: 16px;
            margin-bottom: 5px;
            color: var(--text-secondary);
        }

        .order-history-empty span {
            font-size: 13px;
        }

        .order-history-item {
            display: flex;
            align-items: center;
            padding: 0;
            border-bottom: 1px solid var(--border-secondary);
        }

        .order-history-item:last-child {
            border-bottom: none;
        }

        .order-history-item input[type="radio"] {
            display: none;
        }

        .order-history-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 12px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .order-history-label:hover {
            background: var(--table-hover);
        }

        .order-history-item input[type="radio"]:checked + .order-history-label {
            background: rgba(0, 123, 255, 0.1);
            border-left: 3px solid var(--button-primary);
        }

        .order-history-info {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .order-history-time {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .order-history-type {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .order-history-subtype {
            font-size: 12px;
            color: var(--text-muted);
            font-style: italic;
        }

        .order-history-delete {
            background: none;
            border: none;
            padding: 8px;
            cursor: pointer;
            color: var(--text-muted);
            border-radius: 4px;
            transition: all 0.2s;
            opacity: 0.6;
        }

        .order-history-delete:hover {
            background: rgba(220, 53, 69, 0.1);
            color: var(--button-danger);
            opacity: 1;
        }

        /* Save Before Restore Dialog */
        .save-restore-dialog {
            display: none;
            position: fixed;
            z-index: 1100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(3px);
        }

        .save-restore-dialog-content {
            background: var(--modal-bg);
            margin: 15% auto;
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .save-restore-dialog h3 {
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .save-restore-dialog p {
            margin-bottom: 25px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .save-restore-dialog-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .save-restore-dialog-buttons .btn {
            min-width: 100px;
        }

        /* Settings Modal Styles */
        .shortcuts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 25px;
        }

        .shortcut-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            background: rgba(34, 9, 1, 0.03);
            border-radius: 8px;
            border-left: 4px solid #220901;
        }

        .shortcut-item kbd {
            background: linear-gradient(135deg, #220901 0%, #3a1a0a 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            font-weight: bold;
            min-width: 24px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .shortcut-item span {
            color: #495057;
            font-size: 14px;
            line-height: 1.4;
        }

        .modal-settings-section {
            margin-bottom: 30px;
        }

        .modal-settings-section:last-child {
            margin-bottom: 0;
        }

        .modal-settings-section h3 {
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border-primary);
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .tips-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .tips-list li {
            padding: 10px 15px;
            margin-bottom: 8px;
            background: rgba(34, 9, 1, 0.03);
            border-radius: 6px;
            border-left: 3px solid #220901;
            color: #495057;
            line-height: 1.5;
        }

        .tips-list li strong {
            color: var(--text-primary);
            transition: color 0.3s ease;
        }

        /* Dark mode support for Settings Modal */
        [data-theme="dark"] .shortcut-item {
            background: rgba(255, 255, 255, 0.05);
            border-left-color: var(--border-accent);
        }

        [data-theme="dark"] .shortcut-item kbd {
            background: linear-gradient(135deg, #4a4a4a 0%, #5a5a5a 100%);
            color: var(--text-primary);
        }

        [data-theme="dark"] .shortcut-item span {
            color: var(--text-secondary);
        }

        [data-theme="dark"] .tips-list li {
            background: rgba(255, 255, 255, 0.05);
            border-left-color: var(--border-accent);
            color: var(--text-secondary);
        }

        [data-theme="dark"] .modal-body {
            color: var(--text-primary);
        }

        /* Dark mode support for nested conditional fields (Dealership Merchandising panels) */
        [data-theme="dark"] .nested-conditional-fields {
            background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-secondary) 100%);
            border-color: var(--border-secondary);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .nested-conditional-fields:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border-color: var(--border-primary);
        }

        [data-theme="dark"] .nested-conditional-fields:focus-within {
            border-color: #fd410d;
            box-shadow: 0 8px 25px rgba(253, 65, 13, 0.25);
        }

        [data-theme="dark"] .nested-conditional-fields label {
            color: var(--text-primary);
        }

        [data-theme="dark"] .nested-conditional-fields small {
            color: var(--text-secondary);
        }

        /* Lock Icon Styles */
        .field-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .lock-icon {
            width: 24px;
            height: 24px;
            background: #4CAF50;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #45a049;
            flex-shrink: 0;
        }

        .lock-icon:hover {
            background: #45a049;
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .lock-icon.visible {
            display: flex;
        }

        .lock-icon svg {
            width: 14px;
            height: 14px;
            fill: white;
        }

        .field-locked {
            background-color: #f5f5f5 !important;
            color: #666 !important;
            cursor: not-allowed !important;
        }

        /* Update select styling to work with field containers */
        .field-container select {
            flex: 1;
        }

        /* Auto-scaling quantity input */
        input[data-field="quantity"] {
            width: 60px; /* Minimum width */
            min-width: 60px;
            text-align: center;
            transition: width 0.2s ease;
            box-sizing: border-box;
        }

        /* Allow quantity cells to expand */
        .spreadsheet-table .qty-cell {
            width: auto;
            min-width: 60px;
            transition: width 0.2s ease;
            white-space: nowrap;
            overflow: visible;
        }

        /* Ensure table layout is flexible */
        .spreadsheet-table {
            table-layout: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="logo-section">
                    <svg class="logo-image" id="Layer_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 979.33 617.54">
                        <defs><style>.cls-1{fill:#58595a;}.cls-1,.cls-2,.cls-3{stroke-width:0px;}.cls-2{fill:#231f20;}.cls-3{fill:#fff;}</style></defs>
                        <g id="Layer_1-2">
                            <rect class="cls-3" width="979.33" height="617.54"/>
                            <path class="cls-2" d="m175.6,471.37c0,6.74-1.31,11.28-3.93,13.62-2.62,2.34-7.35,3.51-14.18,3.51h-44.78c-7.39,0-12.26-1.31-14.6-3.93-2.34-2.62-3.51-7.67-3.51-15.16l14.88-3.09v8.56h51.23v-16.56h-45.2c-6.83,0-11.53-1.17-14.11-3.51-2.57-2.34-3.86-6.88-3.86-13.62v-8c0-6.74,1.28-11.28,3.86-13.62,2.57-2.34,7.28-3.51,14.11-3.51h41.13c6.92,0,11.65,1.19,14.18,3.58,2.53,2.39,3.79,7,3.79,13.83l-14.88,3.51v-8.28h-47.44v15.58h45.2c6.83,0,11.56,1.17,14.18,3.51,2.62,2.34,3.93,6.88,3.93,13.62v9.97Z"/>
                            <path class="cls-2" d="m218.59,488.5h-16.84v-72.43h16.84v72.43Z"/>
                            <path class="cls-2" d="m311.31,488.5h-71.17v-72.43h16.84v58.81h54.32v13.62Z"/>
                            <path class="cls-2" d="m389.5,416.07l-39.86,72.43h-11.65l-41.83-72.43h19.23l29.34,52.36,27.93-52.36h16.84Z"/>
                            <path class="cls-2" d="m477.09,488.5h-74.82v-72.43h74.11v12.35h-57.27v16.14h33.41v12.35h-33.41v17.97h57.97v13.62Z"/>
                            <path class="cls-2" d="m578.99,488.5h-24.14l-29.2-27.37h-16v27.37h-16.56v-72.43h62.04c10.85,0,16.28,4.68,16.28,14.04v16.98c0,7.02-2.81,11.37-8.42,13.05-2.15.66-7.96.98-17.41.98l33.41,27.37Zm-23.86-45.48v-8.7c0-2.43-.7-4.02-2.11-4.77-1.03-.65-2.86-.98-5.47-.98h-37.9v20.21h37.9c2.62,0,4.44-.33,5.47-.98,1.4-.75,2.11-2.34,2.11-4.77Z"/>
                            <path class="cls-2" d="m668.37,428.7h-56.43v19.09h30.46v13.19h-30.46v27.51h-16.84v-72.43h73.27v12.63Z"/>
                            <path class="cls-2" d="m772.34,471.37c0,6.74-1.29,11.28-3.86,13.62-2.58,2.34-7.28,3.51-14.11,3.51h-53.34c-6.83,0-11.53-1.17-14.11-3.51-2.58-2.34-3.86-6.88-3.86-13.62v-38.18c0-6.74,1.28-11.28,3.86-13.62,2.57-2.34,7.28-3.51,14.11-3.51h53.34c6.83,0,11.53,1.17,14.11,3.51,2.57,2.34,3.86,6.88,3.86,13.62v38.18Zm-16.84,3.51v-45.9h-55.59v45.9h55.59Z"/>
                            <path class="cls-2" d="m878.78,488.5h-22.88l-26.53-28.07-24.42,28.07h-19.93l34.39-37.2-34.95-35.23h22.32l23.16,24.57,22.04-24.57h19.37l-31.58,33.27,39.02,39.16Z"/>
                            <path class="cls-2" d="m617.52,366.07c3.19,5.86,17.06,10.74,28.69,6.66,11.63-4.08,16.6-15.58,13.41-21.44-3.19-5.86-9.79.39-42.1,14.78Z"/>
                            <path class="cls-2" d="m361.8,366.07c-3.19,5.86-17.06,10.74-28.69,6.66-11.63-4.08-16.6-15.58-13.41-21.44,3.19-5.86,9.79.39,42.1,14.78Z"/>
                            <path class="cls-1" d="m883.57,241.25l-112.68-77.15-21.32-98.47-132.31,72.77c-37.86-3.13-81.34-4.91-127.59-4.91s-89.73,1.78-127.59,4.91l-132.31-72.77-21.32,98.47-112.68,77.15,130.95,107.6s-37.56-131.97,75.12-105.57c112.68,26.39,187.8,142.12,187.8,142.12l.03-.08.03.08s75.12-115.73,187.8-142.12c112.68-26.39,75.12,105.57,75.12,105.57l130.95-107.6Z"/>
                        </g>
                    </svg>
                    <img class="logo-image" src="LS_GLYPH_SMALL-PRIMARY.png" alt="LotSherpa Logo">
                </div>
                
                <div class="settings-section">
                    <label class="theme-toggle" title="Toggle Dark Mode">
                        <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                        <span class="theme-slider"></span>
                        <svg class="theme-icon sun" viewBox="0 0 24 24" fill="currentColor">
                            <circle cx="12" cy="12" r="5"/>
                            <line x1="12" y1="1" x2="12" y2="3"/>
                            <line x1="12" y1="21" x2="12" y2="23"/>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                            <line x1="1" y1="12" x2="3" y2="12"/>
                            <line x1="21" y1="12" x2="23" y2="12"/>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                        </svg>
                        <svg class="theme-icon moon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </label>
                    <button class="settings-btn" onclick="openSettingsModal()" title="Keyboard Shortcuts & Settings">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                        </svg>
                    </button>
                </div>
                
            </div>
        </div>

        <div class="main-content">
            <div class="form-section">

                <div class="order-type-selector">
                    <div class="form-group">
                        <label for="orderTypeSelect">Select Order Type</label>
                        <select id="orderTypeSelect" onchange="selectOrderTypeFromDropdown()">
                            <option value="">Please Select:</option>
                            <option value="vehicle">Vehicle Merchandising</option>
                            <option value="dealership">Dealership Merchandising</option>
                            <option value="custom">Custom Special Products</option>
                            <option value="template">New Template Request</option>
                            <option value="business-cards">Business Cards</option>
                            <option value="banners">Custom Banners</option>
                        </select>
                    </div>
                </div>

                <div id="order-details" class="hidden">
                    <!-- Dynamic content will be inserted here -->
                </div>
            </div>

            <div class="summary-section">
                <div class="summary-header">
                    <h2>Order Summary</h2>
                </div>
                <div class="summary-content" id="summary-content">
                    Order details will appear here as you fill out the form...
                </div>
                <div class="character-limit-warning" id="character-limit-warning">
                     <strong>Character Limit For Output Reached!</strong> You can either: <br>
                    1) Reword or <br>
                    2) Attach the rest of the order as a separate product note
                </div>
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="copyToClipboard()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        to Clipboard
                    </button>
                    <button class="btn btn-success" onclick="exportAllToCSV()" style="background: #fd410d;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7,10 12,15 17,10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        as CSV
                    </button>
                    <button class="btn btn-secondary" onclick="showOrderHistoryModal()" title="View Order History (Past 48 Hours)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        History
                    </button>
                    <button class="btn btn-secondary" onclick="clearForm()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                            <polyline points="3,6 5,6 21,6"></polyline>
                            <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                        Form
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Floating Action Buttons -->
    <div class="mobile-fab-container">
        <!-- Order Summary FAB -->
        <button class="mobile-fab mobile-fab-summary" onclick="openMobileSummary()" title="View Order Summary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14,2 14,8 20,8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10,9 9,9 8,9"></polyline>
            </svg>
        </button>
        
        <!-- Copy FAB -->
        <button class="mobile-fab mobile-fab-copy" onclick="copyToClipboard()" title="Copy to Clipboard">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
        </button>
        
        <!-- Download CSV FAB -->
        <button class="mobile-fab mobile-fab-download" onclick="exportToCSV()" title="Download CSV">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7,10 12,15 17,10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        </button>
        
        <!-- Clear Form FAB -->
        <button class="mobile-fab mobile-fab-clear" onclick="confirmClearForm()" title="Clear Form">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3,6 5,6 21,6"></polyline>
                <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        </button>
    </div>

    <!-- Mobile Summary Modal - Hidden by default -->
    <div id="mobileSummaryModal" class="mobile-summary-modal">
        <div class="mobile-summary-modal-content">
            <div class="mobile-summary-header">
                <h3>Order Summary</h3>
                <button class="mobile-summary-close" onclick="closeMobileSummary()">&times;</button>
            </div>
            <div class="mobile-summary-body">
                <div class="mobile-summary-content" id="mobile-summary-content">
                    Order details will appear here as you fill out the form...
                </div>
                <button class="mobile-copy-btn" onclick="copyToClipboard()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                    Copy to Clipboard
                </button>
            </div>
        </div>
    </div>

    <!-- Multiple Items Modal -->
    <div id="multipleItemsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-header-content">
                    <svg class="modal-header-logo" viewBox="0 0 626.95 224.4" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <style>.cls-1{fill:currentColor;}.cls-1,.cls-2,.cls-3{stroke-width:0px;}.cls-2{fill:#fff;}.cls-3{fill:#fd410d;}</style>
                        </defs>
                        <g>
                            <rect class="cls-3" width="626.95" height="224.4"/>
                            <path class="cls-2" d="m123.21,147.95c-2.52.69-5.81,1.03-9.86,1.03-5.81,0-10.13-1.72-12.95-5.16-2.83-3.44-4.24-8.63-4.24-15.59v-60.98c0-.84.5-1.26,1.49-1.26h17.65c.99,0,1.49.42,1.49,1.26v59.15c0,2.45.27,4.22.8,5.33.53,1.11,1.45,1.66,2.75,1.66h1.95c.69,0,1.07.38,1.15,1.15l1.6,9.86c.15.92.23,1.64.23,2.18,0,.31-.15.56-.46.74-.31.19-.84.4-1.6.63Z"/>
                            <path class="cls-2" d="m154.84,148.99c-9.48,0-16.62-2.48-21.43-7.45-4.81-4.97-7.22-12.34-7.22-22.12,0-10.39,2.56-18.41,7.68-24.07,5.12-5.65,12.3-8.48,21.55-8.48s16.62,2.48,21.43,7.45c4.81,4.97,7.22,12.34,7.22,22.12,0,10.47-2.56,18.51-7.68,24.13-5.12,5.62-12.3,8.43-21.55,8.43Zm.34-16.51c2.75,0,4.77-1.11,6.08-3.32,1.3-2.22,1.95-5.65,1.95-10.32,0-5.5-.63-9.46-1.89-11.86-1.26-2.41-3.31-3.61-6.13-3.61s-4.8,1.11-6.13,3.32c-1.34,2.22-2.01,5.66-2.01,10.32,0,5.43.63,9.36,1.89,11.81,1.26,2.45,3.34,3.67,6.25,3.67Z"/>
                            <path class="cls-2" d="m232.44,143.71c.15.54.25.96.29,1.26.04.31.06.54.06.69,0,.38-.08.69-.23.92-.15.23-.5.42-1.03.57-4.36,1.22-9.25,1.83-14.67,1.83-7.26,0-12.76-1.57-16.51-4.7-3.74-3.13-5.62-7.72-5.62-13.75v-26.59h-8.25c-.99,0-1.49-.42-1.49-1.26v-13.41c0-.84.5-1.26,1.49-1.26h8.25v-12.15c0-.84.5-1.3,1.49-1.37l15.93-2.18c.46-.08.86-.13,1.2-.17.34-.04.63-.06.86-.06.76,0,1.15.42,1.15,1.26v14.67h15.36c.99,0,1.49.42,1.49,1.26v13.41c0,.84-.5,1.26-1.49,1.26h-15.36v19.83c0,3.13.46,5.37,1.38,6.71.92,1.34,2.48,2.01,4.7,2.01,1.07,0,2.14-.07,3.21-.23,1.07-.15,1.99-.3,2.75-.46.76-.15,1.3-.23,1.6-.23.69,0,1.07.38,1.15,1.15l2.29,11Z"/>
                            <path class="cls-1" d="m244.93,138.32c.23-.84.65-1.26,1.26-1.26.3,0,.75.1,1.32.29.57.19,1.24.36,2.01.52,4.89,1.22,8.94,1.83,12.15,1.83s5.44-.59,7.16-1.78c1.72-1.18,2.58-2.81,2.58-4.87s-.59-3.88-1.78-5.22c-1.19-1.34-3.31-2.73-6.36-4.18l-6.42-3.09c-4.2-2.06-7.24-4.36-9.11-6.88-1.87-2.52-2.81-5.65-2.81-9.4,0-5.04,1.79-9.04,5.39-11.98,3.59-2.94,8.48-4.41,14.67-4.41,4.81,0,9.59.65,14.33,1.95.69.23,1.03.65,1.03,1.26,0,.31-.04.61-.11.92-.08.31-.15.61-.23.92l-1.15,4.7c-.15.54-.33.88-.52,1.03-.19.15-.52.23-.97.23-.15,0-.34-.02-.57-.06-.23-.04-.54-.09-.92-.17-.84-.15-1.89-.36-3.15-.63-1.26-.27-2.64-.5-4.13-.69-1.49-.19-3.04-.29-4.64-.29-2.45,0-4.38.56-5.79,1.66-1.41,1.11-2.12,2.62-2.12,4.53s.57,3.38,1.72,4.64c1.15,1.26,3.1,2.54,5.85,3.84l5.96,2.87c4.66,2.22,7.98,4.58,9.97,7.11,1.99,2.52,2.98,5.77,2.98,9.74,0,5.35-1.87,9.59-5.62,12.72-3.75,3.13-8.87,4.7-15.36,4.7-3.06,0-6.29-.29-9.69-.86-3.4-.57-5.94-1.2-7.62-1.89-.69-.23-1.03-.61-1.03-1.15,0-.23.04-.5.11-.8.08-.3.15-.57.23-.8l1.38-5.04Z"/>
                            <path class="cls-1" d="m326.43,147.84c-.99,0-1.49-.42-1.49-1.26v-37.71c0-4.05-.71-6.97-2.12-8.77-1.41-1.79-3.76-2.69-7.05-2.69-1.91,0-4.05.36-6.42,1.09-2.37.73-4.55,1.66-6.53,2.81v45.27c0,.84-.5,1.26-1.49,1.26h-8.14c-.99,0-1.49-.42-1.49-1.26v-79.32c0-.84.5-1.26,1.49-1.26h8.14c.99,0,1.49.42,1.49,1.26v25.45c5.88-3.13,11.46-4.7,16.73-4.7s9.53,1.47,12.32,4.41c2.79,2.94,4.18,7.2,4.18,12.78v41.38c0,.84-.5,1.26-1.49,1.26h-8.14Z"/>
                            <path class="cls-1" d="m390.96,142.34c.3.92.46,1.53.46,1.83,0,.38-.34.73-1.03,1.03-6.04,2.52-12.57,3.78-19.6,3.78-8.33,0-14.61-2.52-18.86-7.57-4.24-5.04-6.36-12.49-6.36-22.35s2.14-17.69,6.42-23.04c4.28-5.35,10.32-8.02,18.11-8.02,7.11,0,12.47,2.33,16.1,6.99,3.63,4.66,5.44,11.54,5.44,20.63,0,1.6-.04,2.77-.11,3.5-.08.73-.25,1.22-.52,1.49-.27.27-.78.4-1.55.4h-32.09c.23,6.34,1.58,11.02,4.07,14.04,2.48,3.02,6.28,4.53,11.41,4.53,1.83,0,3.97-.23,6.42-.69,2.44-.46,4.7-1.03,6.76-1.72,1.37-.46,2.22-.69,2.52-.69.46,0,.76.31.92.92l1.49,4.93Zm-10.55-29.8c-.15-5.58-1.15-9.57-2.98-11.98-1.83-2.41-4.66-3.61-8.48-3.61-6.95,0-10.81,5.2-11.58,15.59h23.04Z"/>
                            <path class="cls-1" d="m402.88,147.84c-.99,0-1.49-.42-1.49-1.26v-56.16c0-.84.5-1.26,1.49-1.26h6.08c.46,0,.8.08,1.03.23.23.15.42.5.57,1.03l.92,2.98c3.9-1.83,7.07-3.11,9.51-3.84,2.44-.72,4.7-1.09,6.76-1.09.92,0,1.57.08,1.95.23.38.15.57.5.57,1.03,0,.23-.02.48-.06.74-.04.27-.1.59-.17.97l-1.03,6.19c-.08.84-.69,1.26-1.83,1.26-5.04,0-9.93.69-14.67,2.06v45.62c0,.84-.5,1.26-1.49,1.26h-8.14Z"/>
                            <path class="cls-1" d="m437.49,178.4c-.99,0-1.49-.42-1.49-1.26v-86.72c0-.84.5-1.26,1.49-1.26h6.08c.76,0,1.3.42,1.6,1.26l.92,2.87c3.28-2.06,6.06-3.46,8.31-4.18,2.25-.73,4.53-1.09,6.82-1.09,7.26,0,12.78,2.45,16.56,7.34,3.78,4.89,5.67,12,5.67,21.32,0,10.39-2.2,18.38-6.59,23.96-4.4,5.58-10.68,8.37-18.86,8.37-3.13,0-6.76-.8-10.89-2.41v30.56c0,.84-.5,1.26-1.49,1.26h-8.14Zm9.63-41.45c1.6.84,3.38,1.53,5.33,2.06,1.95.54,3.76.8,5.44.8,4.51,0,7.95-1.74,10.32-5.21,2.37-3.48,3.55-8.58,3.55-15.3,0-7.79-.99-13.43-2.98-16.91-1.99-3.48-5.24-5.22-9.74-5.22-2.52.08-4.74.52-6.65,1.32-1.91.8-3.67,1.7-5.27,2.69v35.76Z"/>
                            <path class="cls-1" d="m523.57,147.84c-.46,0-.78-.07-.97-.23-.19-.15-.36-.5-.52-1.03l-1.15-3.44c-5.2,3.9-10.77,5.85-16.74,5.85-4.89,0-8.71-1.47-11.46-4.41-2.75-2.94-4.13-7.05-4.13-12.32,0-5.96,1.91-10.6,5.73-13.93,3.82-3.32,9.44-5.18,16.85-5.56l8.71-.46v-3.44c0-2.9-.29-5.2-.86-6.88-.57-1.68-1.57-2.9-2.98-3.67-1.41-.76-3.5-1.15-6.25-1.15-2.22,0-4.34.15-6.36.46-2.03.31-3.76.63-5.22.97-1.45.34-2.37.52-2.75.52-.84,0-1.3-.38-1.38-1.15l-.69-3.9c-.23-1.37-.34-2.22-.34-2.52,0-.69.38-1.15,1.15-1.37,2.22-.69,4.95-1.22,8.2-1.6,3.25-.38,6.48-.57,9.69-.57,6.42,0,11.14,1.34,14.16,4.01,3.02,2.68,4.53,6.88,4.53,12.61v41.95c0,.84-.5,1.26-1.49,1.26h-5.73Zm-3.67-27.62l-10.32.69c-3.29.23-5.73,1.15-7.34,2.75s-2.41,3.97-2.41,7.11c0,6.27,2.6,9.4,7.79,9.4,3.97,0,8.06-1.53,12.27-4.59v-15.36Z"/>
                        </g>
                    </svg>
                    <h2>Multiple Items Entry</h2>
                </div>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="spreadsheet-container">
                    <table class="spreadsheet-table" id="spreadsheetTable">
                        <thead>
                            <tr id="spreadsheetHeader">
                                <!-- Headers will be dynamically generated -->
                            </tr>
                        </thead>
                        <tbody id="spreadsheetBody">
                            <!-- Rows will be dynamically generated -->
                        </tbody>
                    </table>
                    <button class="btn btn-primary add-row-btn" onclick="addSpreadsheetRow()">+ Add Row</button>
                </div>
            </div>
            <div class="modal-footer">
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button class="btn btn-danger" onclick="clearTable()" title="Clear All Rows">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                        Clear Table
                    </button>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="applyMultipleItems()">Apply to Order</button>
                    <button class="btn btn-success" onclick="exportToCSV()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7,10 12,15 17,10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        to CSV
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Settings Modal -->
    <div id="exportSettingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Export Settings</h2>
                <button class="modal-close" onclick="closeExportSettingsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-group">
                    <label>
                        <input type="checkbox" id="autoUploadToDrive" checked>
                        Automatically upload CSV to Google Drive
                    </label>
                </div>
                <div class="settings-group">
                    <label> Google Drive Upload Location:</label>
                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px; border-radius: 8px; border: 1px solid #e0e6ed; box-shadow: 0 2px 4px rgba(0,0,0,0.05), inset 0 1px 0 rgba(255,255,255,0.9);">
                        <strong>Silver Fox Marketing Folder</strong>
                        <br><small style="color: #666;">All CSV files will automatically upload to your designated Silver Fox folder</small>
                    </div>
                </div>
                <div class="settings-group" style="margin-top: 20px;">
                    <div class="google-drive-status" id="modalDriveStatus">
                        <span class="status-indicator" id="modalStatusIndicator"></span>
                        <span id="modalStatusText">Google Drive: Not Connected</span>
                        <button class="btn btn-google btn-sm" id="modalAuthButton" onclick="handleAuthClick()" style="padding: 5px 15px;">
                            Connect
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeExportSettingsModal()">Done</button>
            </div>
        </div>
    </div>

    <!-- Order History Modal -->
    <div id="orderHistoryModal" class="modal order-history-modal" onclick="handleOrderHistoryModalBackdropClick(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>Order History (Past 48 Hours)</h2>
                <button class="modal-close" onclick="closeOrderHistoryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="orderHistoryList" class="order-history-list">
                    <!-- History items will be dynamically inserted here -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="clearHistoryBtn" class="btn btn-danger" onclick="clearOrderHistory()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                    Clear All
                </button>
                <button id="restoreHistoryBtn" class="btn btn-primary" onclick="restoreSelectedOrder()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                        <polyline points="1 4 1 10 7 10"></polyline>
                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                    </svg>
                    Restore Selected
                </button>
            </div>
        </div>
    </div>

    <!-- Save Before Restore Dialog -->
    <div id="saveBeforeRestoreDialog" class="save-restore-dialog">
        <div class="save-restore-dialog-content">
            <h3>Save Current Order?</h3>
            <p>You have unsaved data in the form. Would you like to save it to history before restoring the selected order?</p>
            <div class="save-restore-dialog-buttons">
                <button class="btn btn-success" onclick="saveAndRestore()">Save & Restore</button>
                <button class="btn btn-secondary" onclick="restoreWithoutSaving()">Don't Save</button>
                <button class="btn btn-danger" onclick="closeSaveBeforeRestoreDialog()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Save Before Clear Dialog -->
    <div id="saveBeforeClearDialog" class="save-restore-dialog">
        <div class="save-restore-dialog-content">
            <h3>Save to History?</h3>
            <p>Would you like to save this order to history before clearing the form?</p>
            <div class="save-restore-dialog-buttons">
                <button class="btn btn-success" onclick="saveAndClear()">Save & Clear</button>
                <button class="btn btn-secondary" onclick="clearWithoutSaving()">Clear Without Saving</button>
                <button class="btn btn-danger" onclick="closeSaveBeforeClearDialog()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Save Before Switch Dialog -->
    <div id="saveBeforeSwitchDialog" class="save-restore-dialog">
        <div class="save-restore-dialog-content">
            <h3>Save Current Order?</h3>
            <p>Would you like to save this order to history before switching to a different order type?</p>
            <div class="save-restore-dialog-buttons">
                <button class="btn btn-success" onclick="saveAndSwitch()">Save & Switch</button>
                <button class="btn btn-secondary" onclick="switchWithoutSaving()">Switch Without Saving</button>
                <button class="btn btn-danger" onclick="closeSaveBeforeSwitchDialog()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings & Keyboard Shortcuts</h2>
                <button class="modal-close" onclick="closeSettingsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-settings-section">
                    <h3>Keyboard Shortcuts (Multiple Items Modal)</h3>
                    <div class="shortcuts-grid">
                        <div class="shortcut-item">
                            <kbd>Enter</kbd>
                            <span>Move to next row (auto-creates new row at bottom)</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Shift</kbd> + <kbd>Enter</kbd>
                            <span>Move to previous row</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Tab</kbd>
                            <span>Navigate to next cell</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Shift</kbd> + <kbd>Tab</kbd>
                            <span>Navigate to previous cell</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>Enter</kbd>
                            <span>Apply changes and close modal</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>D</kbd>
                            <span>Duplicate current row</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>Delete</kbd>
                            <span>Delete current row</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Escape</kbd>
                            <span>Cancel and close modal</span>
                        </div>
                    </div>
                </div>
                
                <div class="modal-settings-section">
                    <h3>Usage Tips</h3>
                    <ul class="tips-list">
                        <li><strong>Sequential Field Locking:</strong> Type  Size  Material  Text Fields</li>
                        <li><strong>Unlock Fields:</strong> Click "Change type/size/material" links in green indicators</li>
                        <li><strong>Bulk Entry:</strong> Use "Enter Multiple Items" after locking all required fields</li>
                        <li><strong>Drag & Drop:</strong> Reorder rows by dragging the handle icons</li>
                        <li><strong>Character Limits:</strong> Red borders indicate text exceeding recommendations</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Google Drive API Configuration
        const CLIENT_ID = '641488847057-l2jkpe9g98ibna0ff0qgtd39slkb825t.apps.googleusercontent.com';
        const API_KEY = 'YOUR_API_KEY'; // Optional - you can add this later if needed
        const DISCOVERY_DOCS = ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'];
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        let tokenClient;
        let gapiInited = false;
        let gisInited = false;
        let isSignedIn = false;

        // Form variables
        let currentOrderType = '';
        let currentProductType = '';
        let orderData = {};
        let multipleItemsData = [];

        // Auto-save and cache management
        const CACHE_KEY = 'silverFoxOrderFormCache';
        const CACHE_EXPIRY_HOURS = 24; // Cache expires after 24 hours

        // Order History Management (48-hour multi-order storage)
        const ORDER_HISTORY_KEY = 'silverFoxOrderHistory';
        const ORDER_HISTORY_EXPIRY_HOURS = 48;
        const MAX_STORED_ORDERS = 50;

        // Order type labels mapping
        const ORDER_TYPE_LABELS = {
            'vehicle': 'Vehicle Merchandising',
            'dealership': 'Dealership Merchandising',
            'custom': 'Custom Special Products',
            'template': 'New Template Request',
            'business-cards': 'Business Cards',
            'banners': 'Custom Banners'
        };

        // Auto-save form data every 5 seconds
        let autoSaveInterval;
        
        // Initialize auto-save when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Check for cached data but don't auto-load it
            checkForCachedData();
            
            // Initialize dark mode
            initializeDarkMode();
            
            // Start auto-save interval
            startAutoSave();
            
            // Save on page unload
            window.addEventListener('beforeunload', function() {
                saveFormDataToCache();
            });
        });

        // Dark Mode Functions
        function initializeDarkMode() {
            // Check for saved theme preference
            const savedTheme = localStorage.getItem('silverFoxTheme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.getElementById('darkModeToggle').checked = true;
            }
        }

        function toggleDarkMode() {
            const isDarkMode = document.getElementById('darkModeToggle').checked;
            if (isDarkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('silverFoxTheme', 'dark');
            } else {
                document.documentElement.removeAttribute('data-theme');
                localStorage.setItem('silverFoxTheme', 'light');
            }
        }
        
        function startAutoSave() {
            // Clear any existing interval
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            
            // Save every 5 seconds
            autoSaveInterval = setInterval(function() {
                saveFormDataToCache();
            }, 5000);
        }
        
        function saveFormDataToCache() {
            try {
                // Only save if there's meaningful data (order type selected or form inputs filled)
                if (!currentOrderType && document.querySelectorAll('input[value!=""], select[value!=""], textarea[value!=""]').length === 0) {
                    return; // Don't save empty forms
                }
                
                const formData = {
                    timestamp: new Date().getTime(),
                    orderType: currentOrderType,
                    productType: currentProductType,
                    multipleItemsData: multipleItemsData,
                    selectedWindshieldSize: selectedWindshieldSize,
                    selectedBodySidesSize: selectedBodySidesSize,
                    selectedWindshieldsSize: selectedWindshieldsSize,
                    selectedComplementsSize: selectedComplementsSize,
                    selectedWindshieldType: selectedWindshieldType,
                    selectedBodySideType: selectedBodySideType,
                    selectedComplementType: selectedComplementType,
                    formInputs: {}
                };
                
                // Capture all form inputs
                const inputs = document.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.id && input.id !== 'searchBox') {
                        if (input.type === 'radio' || input.type === 'checkbox') {
                            formData.formInputs[input.id] = input.checked;
                        } else {
                            formData.formInputs[input.id] = input.value;
                        }
                    }
                });
                
                // Save to localStorage
                localStorage.setItem(CACHE_KEY, JSON.stringify(formData));
                
                // Update last saved indicator
                updateLastSavedIndicator();
                
            } catch (e) {
                console.error('Error saving form data to cache:', e);
            }
        }
        
        function loadCachedFormData() {
            // This function is no longer called automatically
            // Form starts clear, user must click restore to load cached data
            try {
                const cached = localStorage.getItem(CACHE_KEY);
                if (!cached) return false;
                
                const formData = JSON.parse(cached);
                
                // Check if cache is expired (older than 24 hours)
                const now = new Date().getTime();
                const cacheAge = (now - formData.timestamp) / (1000 * 60 * 60); // Age in hours
                
                if (cacheAge > CACHE_EXPIRY_HOURS) {
                    localStorage.removeItem(CACHE_KEY);
                    return false;
                }
                
                return true; // Cache exists and is valid
                
            } catch (e) {
                console.error('Error checking cached form data:', e);
                return false;
            }
        }
        
        function checkForCachedData() {
            try {
                const cached = localStorage.getItem(CACHE_KEY);
                if (!cached) return;
                
                const formData = JSON.parse(cached);
                const cacheDate = new Date(formData.timestamp);
                const timeAgo = getTimeAgo(cacheDate);
                
                // Show restore notification
                const notification = document.createElement('div');
                notification.className = 'cache-notification';
                notification.innerHTML = `
                    <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; padding: 12px; margin: 10px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>Unsaved form data found</strong> from ${timeAgo}
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="restoreCachedData()" class="btn btn-sm" style="background: #28a745; color: white; padding: 5px 15px; border: none; border-radius: 3px; cursor: pointer;">Restore</button>
                            <button onclick="clearCachedData()" class="btn btn-sm" style="background: #dc3545; color: white; padding: 5px 15px; border: none; border-radius: 3px; cursor: pointer;">Discard</button>
                        </div>
                    </div>
                `;
                
                // Insert between action buttons and export settings
                const actionButtons = document.querySelector('.action-buttons');
                if (actionButtons) {
                    actionButtons.parentNode.insertBefore(notification, actionButtons.nextSibling);
                }
                
            } catch (e) {
                console.error('Error checking for cached data:', e);
            }
        }
        
        function restoreCachedData() {
            try {
                const cached = localStorage.getItem(CACHE_KEY);
                if (!cached) return;
                
                const formData = JSON.parse(cached);
                
                // Restore order type and product type
                if (formData.orderType) {
                    const orderTypeSelect = document.getElementById('orderTypeSelect');
                    if (orderTypeSelect) {
                        orderTypeSelect.value = formData.orderType;
                        currentOrderType = formData.orderType;
                        selectOrderTypeFromDropdown();
                    }
                }
                
                if (formData.productType) {
                    setTimeout(() => {
                        currentProductType = formData.productType;
                        const productTypeSelect = document.getElementById('vm_productType');
                        if (productTypeSelect) {
                            productTypeSelect.value = formData.productType;
                            handleVehicleMerchandisingProductType();
                        }
                    }, 200);
                }
                
                // Restore form inputs
                setTimeout(() => {
                    Object.keys(formData.formInputs).forEach(inputId => {
                        const input = document.getElementById(inputId);
                        if (input) {
                            if (input.type === 'radio' || input.type === 'checkbox') {
                                input.checked = formData.formInputs[inputId];
                            } else {
                                input.value = formData.formInputs[inputId];
                            }
                        }
                    });
                    
                    // Restore multiple items data and all selected sizes/types
                    if (formData.multipleItemsData && formData.multipleItemsData.length > 0) {
                        multipleItemsData = formData.multipleItemsData;
                    }
                    
                    if (formData.selectedWindshieldSize) {
                        selectedWindshieldSize = formData.selectedWindshieldSize;
                    }
                    
                    if (formData.selectedBodySidesSize) {
                        selectedBodySidesSize = formData.selectedBodySidesSize;
                    }
                    
                    if (formData.selectedWindshieldsSize) {
                        selectedWindshieldsSize = formData.selectedWindshieldsSize;
                    }
                    
                    if (formData.selectedComplementsSize) {
                        selectedComplementsSize = formData.selectedComplementsSize;
                    }
                    
                    if (formData.selectedWindshieldType) {
                        selectedWindshieldType = formData.selectedWindshieldType;
                    }
                    
                    if (formData.selectedBodySideType) {
                        selectedBodySideType = formData.selectedBodySideType;
                    }
                    
                    if (formData.selectedComplementType) {
                        selectedComplementType = formData.selectedComplementType;
                    }
                    
                    // Update summary
                    updateSummary();
                    
                    // Remove notification
                    const notification = document.querySelector('.cache-notification');
                    if (notification) {
                        notification.remove();
                    }
                    
                    showNotification('Form data restored successfully', 'success');
                    
                }, 200);
                
            } catch (e) {
                console.error('Error restoring cached data:', e);
                showNotification('Error restoring form data', 'error');
            }
        }
        
        function clearCachedData() {
            try {
                localStorage.removeItem(CACHE_KEY);
                
                // Remove notification
                const notification = document.querySelector('.cache-notification');
                if (notification) {
                    notification.remove();
                }
                
                showNotification('Cached data discarded', 'info');
                
            } catch (e) {
                console.error('Error clearing cached data:', e);
            }
        }
        
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            let interval = Math.floor(seconds / 31536000);
            if (interval > 1) return interval + ' years ago';
            if (interval === 1) return '1 year ago';
            
            interval = Math.floor(seconds / 2592000);
            if (interval > 1) return interval + ' months ago';
            if (interval === 1) return '1 month ago';
            
            interval = Math.floor(seconds / 86400);
            if (interval > 1) return interval + ' days ago';
            if (interval === 1) return '1 day ago';
            
            interval = Math.floor(seconds / 3600);
            if (interval > 1) return interval + ' hours ago';
            if (interval === 1) return '1 hour ago';
            
            interval = Math.floor(seconds / 60);
            if (interval > 1) return interval + ' minutes ago';
            if (interval === 1) return '1 minute ago';
            
            return 'just now';
        }
        
        function updateLastSavedIndicator() {
            // Optional: Add a small indicator showing when form was last saved
            let indicator = document.getElementById('autoSaveIndicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'autoSaveIndicator';
                indicator.style.cssText = 'position: fixed; bottom: 10px; left: 10px; color: #666; font-size: 12px; z-index: 1000;';
                document.body.appendChild(indicator);
            }
            indicator.textContent = 'Auto-saved at ' + new Date().toLocaleTimeString();
            
            // Fade out after 2 seconds
            setTimeout(() => {
                indicator.style.opacity = '0.3';
            }, 2000);
        }

        // ============================================
        // ORDER HISTORY FUNCTIONS (48-hour storage)
        // ============================================

        function saveOrderToHistory() {
            try {
                // Check if there's meaningful data to save
                if (!currentOrderType) {
                    return false;
                }

                // Get current form data
                const orderData = {
                    id: 'order_' + Date.now(),
                    timestamp: Date.now(),
                    orderType: currentOrderType,
                    orderTypeLabel: ORDER_TYPE_LABELS[currentOrderType] || currentOrderType,
                    productType: currentProductType,
                    multipleItemsData: [...multipleItemsData],
                    selectedSizes: {
                        windshield: selectedWindshieldSize,
                        bodySides: selectedBodySidesSize,
                        windshields: selectedWindshieldsSize,
                        complements: selectedComplementsSize
                    },
                    selectedTypes: {
                        windshield: selectedWindshieldType,
                        bodySide: selectedBodySideType,
                        complement: selectedComplementType
                    },
                    formInputs: {}
                };

                // Capture all form inputs
                const inputs = document.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.id && input.id !== 'searchBox') {
                        if (input.type === 'radio' || input.type === 'checkbox') {
                            orderData.formInputs[input.id] = input.checked;
                        } else {
                            orderData.formInputs[input.id] = input.value;
                        }
                    }
                });

                // Get existing history
                let history = getOrderHistory();

                // Add new order to beginning
                history.unshift(orderData);

                // Limit to MAX_STORED_ORDERS
                if (history.length > MAX_STORED_ORDERS) {
                    history = history.slice(0, MAX_STORED_ORDERS);
                }

                // Save to localStorage
                localStorage.setItem(ORDER_HISTORY_KEY, JSON.stringify({ orders: history }));

                return true;
            } catch (e) {
                console.error('Error saving order to history:', e);
                return false;
            }
        }

        function getOrderHistory() {
            try {
                const stored = localStorage.getItem(ORDER_HISTORY_KEY);
                if (!stored) return [];

                const data = JSON.parse(stored);
                const now = Date.now();
                const expiryMs = ORDER_HISTORY_EXPIRY_HOURS * 60 * 60 * 1000;

                // Filter out expired orders
                const validOrders = (data.orders || []).filter(order => {
                    return (now - order.timestamp) < expiryMs;
                });

                // Update storage if we removed expired orders
                if (validOrders.length !== (data.orders || []).length) {
                    localStorage.setItem(ORDER_HISTORY_KEY, JSON.stringify({ orders: validOrders }));
                }

                return validOrders;
            } catch (e) {
                console.error('Error getting order history:', e);
                return [];
            }
        }

        function deleteFromHistory(orderId) {
            try {
                let history = getOrderHistory();
                history = history.filter(order => order.id !== orderId);
                localStorage.setItem(ORDER_HISTORY_KEY, JSON.stringify({ orders: history }));
                return true;
            } catch (e) {
                console.error('Error deleting from history:', e);
                return false;
            }
        }

        function clearOrderHistory() {
            if (confirm('Are you sure you want to clear all order history? This cannot be undone.')) {
                localStorage.removeItem(ORDER_HISTORY_KEY);
                showNotification('Order history cleared', 'info');
                // Refresh modal if open
                const modal = document.getElementById('orderHistoryModal');
                if (modal && modal.style.display === 'block') {
                    showOrderHistoryModal();
                }
            }
        }

        function formatHistoryTimestamp(timestamp) {
            const date = new Date(timestamp);
            const options = {
                month: 'short',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            };
            return date.toLocaleDateString('en-US', options);
        }

        function isFormEmpty() {
            // Check if form has any meaningful data
            if (!currentOrderType) return true;

            // Check if any inputs have values
            const inputs = document.querySelectorAll('#order-details input, #order-details select, #order-details textarea');
            for (let input of inputs) {
                if (input.type === 'radio' || input.type === 'checkbox') {
                    if (input.checked) return false;
                } else if (input.value && input.value.trim() !== '') {
                    return false;
                }
            }

            // Check if multiple items has data
            if (multipleItemsData && multipleItemsData.length > 0) return false;

            return true;
        }

        function showOrderHistoryModal() {
            const history = getOrderHistory();
            const modal = document.getElementById('orderHistoryModal');
            const listContainer = document.getElementById('orderHistoryList');

            if (!modal || !listContainer) return;

            // Build history list HTML
            if (history.length === 0) {
                listContainer.innerHTML = `
                    <div class="order-history-empty">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <p>No orders in history</p>
                        <span>Orders are saved when you clear the form or switch order types</span>
                    </div>
                `;
            } else {
                listContainer.innerHTML = history.map((order, index) => `
                    <div class="order-history-item" data-order-id="${order.id}">
                        <input type="radio" name="historySelection" id="history_${index}" value="${order.id}" ${index === 0 ? 'checked' : ''}>
                        <label for="history_${index}" class="order-history-label">
                            <div class="order-history-info">
                                <span class="order-history-time">${formatHistoryTimestamp(order.timestamp)}</span>
                                <span class="order-history-type">${order.orderTypeLabel}</span>
                                ${order.productType ? `<span class="order-history-subtype">${order.productType}</span>` : ''}
                            </div>
                            <button class="order-history-delete" onclick="event.stopPropagation(); deleteHistoryItem('${order.id}')" title="Delete this order">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                </svg>
                            </button>
                        </label>
                    </div>
                `).join('');
            }

            // Update button states
            const restoreBtn = document.getElementById('restoreHistoryBtn');
            const clearBtn = document.getElementById('clearHistoryBtn');
            if (restoreBtn) restoreBtn.disabled = history.length === 0;
            if (clearBtn) clearBtn.disabled = history.length === 0;

            // Show modal
            modal.style.display = 'block';
        }

        function closeOrderHistoryModal() {
            const modal = document.getElementById('orderHistoryModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function handleOrderHistoryModalBackdropClick(event) {
            // Close modal when clicking on the backdrop (outside the modal content)
            if (event.target.id === 'orderHistoryModal') {
                closeOrderHistoryModal();
            }
        }

        function deleteHistoryItem(orderId) {
            if (deleteFromHistory(orderId)) {
                showOrderHistoryModal(); // Refresh the list
                showNotification('Order removed from history', 'info');
            }
        }

        function restoreSelectedOrder() {
            const selected = document.querySelector('input[name="historySelection"]:checked');
            if (!selected) {
                showNotification('Please select an order to restore', 'warning');
                return;
            }

            const orderId = selected.value;

            // Check if current form has data
            if (!isFormEmpty()) {
                showSaveBeforeRestoreDialog(orderId);
            } else {
                performRestore(orderId);
            }
        }

        function showSaveBeforeRestoreDialog(orderId) {
            const dialog = document.getElementById('saveBeforeRestoreDialog');
            if (dialog) {
                dialog.dataset.pendingRestoreId = orderId;
                dialog.style.display = 'block';
            }
        }

        function closeSaveBeforeRestoreDialog() {
            const dialog = document.getElementById('saveBeforeRestoreDialog');
            if (dialog) {
                dialog.style.display = 'none';
                delete dialog.dataset.pendingRestoreId;
            }
        }

        function saveAndRestore() {
            const dialog = document.getElementById('saveBeforeRestoreDialog');
            const orderId = dialog?.dataset.pendingRestoreId;

            if (saveOrderToHistory()) {
                showNotification('Current order saved to history', 'success');
            }

            closeSaveBeforeRestoreDialog();
            if (orderId) {
                performRestore(orderId);
            }
        }

        function restoreWithoutSaving() {
            const dialog = document.getElementById('saveBeforeRestoreDialog');
            const orderId = dialog?.dataset.pendingRestoreId;

            closeSaveBeforeRestoreDialog();
            if (orderId) {
                performRestore(orderId);
            }
        }

        function performRestore(orderId) {
            const history = getOrderHistory();
            const order = history.find(o => o.id === orderId);

            if (!order) {
                showNotification('Order not found in history', 'error');
                return;
            }

            // Store the data we need to restore (handlers will clear these during form generation)
            const savedMultipleItemsData = order.multipleItemsData ? [...order.multipleItemsData] : [];
            const savedProductType = order.productType || '';
            const savedSizes = order.selectedSizes || {};
            const savedTypes = order.selectedTypes || {};

            try {
                // First, generate the base form (this resets state, so we do it first)
                const orderTypeSelect = document.getElementById('orderTypeSelect');
                if (orderTypeSelect) {
                    orderTypeSelect.value = order.orderType;
                    // Use performOrderTypeSwitch directly to avoid save prompts
                    performOrderTypeSwitch(order.orderType);
                }

                // Wait for form to render, then restore inputs and trigger nested fields
                setTimeout(() => {
                    // Restore form inputs (set values first, without triggering events)
                    if (order.formInputs) {
                        Object.entries(order.formInputs).forEach(([id, value]) => {
                            const element = document.getElementById(id);
                            if (element) {
                                if (element.type === 'radio' || element.type === 'checkbox') {
                                    element.checked = value;
                                } else {
                                    element.value = value;
                                }
                            }
                        });

                        // Now trigger change/input events to activate conditional logic
                        // Do this in a second pass after all values are set
                        Object.entries(order.formInputs).forEach(([id, value]) => {
                            const element = document.getElementById(id);
                            if (element) {
                                if (element.type === 'radio' || element.type === 'checkbox') {
                                    if (element.checked) {
                                        element.dispatchEvent(new Event('change', { bubbles: true }));
                                    }
                                } else if (element.tagName === 'SELECT') {
                                    element.dispatchEvent(new Event('change', { bubbles: true }));
                                } else {
                                    element.dispatchEvent(new Event('input', { bubbles: true }));
                                }
                            }
                        });
                    }

                    // After nested fields are generated, wait a bit more and restore their values
                    setTimeout(() => {
                        // Restore nested field values that were generated by the conditional logic
                        if (order.formInputs) {
                            Object.entries(order.formInputs).forEach(([id, value]) => {
                                const element = document.getElementById(id);
                                if (element) {
                                    if (element.type === 'radio' || element.type === 'checkbox') {
                                        element.checked = value;
                                    } else {
                                        element.value = value;
                                    }
                                }
                            });
                        }

                        // NOW restore the state variables AFTER all events have fired
                        // (the event handlers clear these, so we must restore them last)
                        currentProductType = savedProductType;
                        multipleItemsData = savedMultipleItemsData;

                        // Restore size and type selections
                        selectedWindshieldSize = savedSizes.windshield || '';
                        selectedBodySidesSize = savedSizes.bodySides || '';
                        selectedWindshieldsSize = savedSizes.windshields || '';
                        selectedComplementsSize = savedSizes.complements || '';
                        selectedWindshieldType = savedTypes.windshield || '';
                        selectedBodySideType = savedTypes.bodySide || '';
                        selectedComplementType = savedTypes.complement || '';

                        // Update summary (this will now reflect the restored multipleItemsData)
                        updateSummary();

                        // Close modal
                        closeOrderHistoryModal();

                        showNotification('Order restored successfully', 'success');
                    }, 300);

                }, 200);

            } catch (e) {
                console.error('Error restoring order:', e);
                showNotification('Error restoring order', 'error');
            }
        }

        // ============================================
        // END ORDER HISTORY FUNCTIONS
        // ============================================

        // Initialize Google API
        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }

        async function initializeGapiClient() {
            try {
                await gapi.client.init({
                    apiKey: API_KEY,
                    discoveryDocs: DISCOVERY_DOCS,
                });
                gapiInited = true;
                maybeEnableButtons();
            } catch (error) {
                console.error('Error initializing GAPI client:', error);
                showNotification('Failed to initialize Google API', 'error');
            }
        }

        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: '', // defined later
            });
            gisInited = true;
            maybeEnableButtons();
        }

        function maybeEnableButtons() {
            if (gapiInited && gisInited) {
                document.getElementById('authButton').style.display = 'inline-block';
            }
        }

        function handleAuthClick() {
            tokenClient.callback = async (resp) => {
                if (resp.error !== undefined) {
                    throw (resp);
                }
                isSignedIn = true;
                updateSigninStatus();
                showNotification('Successfully connected to Google Drive!');
            };

            if (gapi.client.getToken() === null) {
                tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
                tokenClient.requestAccessToken({prompt: ''});
            }
        }

        function handleSignoutClick() {
            const token = gapi.client.getToken();
            if (token !== null) {
                google.accounts.oauth2.revoke(token.access_token);
                gapi.client.setToken('');
                isSignedIn = false;
                updateSigninStatus();
            }
        }

        function updateSigninStatus() {
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            const authButton = document.getElementById('authButton');
            const driveStatus = document.getElementById('driveStatus');
            
            // Modal elements
            const modalStatusIndicator = document.getElementById('modalStatusIndicator');
            const modalStatusText = document.getElementById('modalStatusText');
            const modalAuthButton = document.getElementById('modalAuthButton');
            const modalDriveStatus = document.getElementById('modalDriveStatus');

            if (isSignedIn) {
                // Update header
                statusIndicator.classList.add('connected');
                driveStatus.classList.add('connected');
                statusText.textContent = 'Google Drive: Connected';
                authButton.textContent = 'Disconnect';
                authButton.onclick = handleSignoutClick;
                
                // Update modal
                if (modalStatusIndicator) modalStatusIndicator.classList.add('connected');
                if (modalDriveStatus) modalDriveStatus.classList.add('connected');
                if (modalStatusText) modalStatusText.textContent = 'Google Drive: Connected';
                if (modalAuthButton) {
                    modalAuthButton.textContent = 'Disconnect';
                    modalAuthButton.onclick = handleSignoutClick;
                }
            } else {
                // Update header
                statusIndicator.classList.remove('connected');
                driveStatus.classList.remove('connected');
                statusText.textContent = 'Google Drive: Not Connected';
                authButton.textContent = 'Connect';
                authButton.onclick = handleAuthClick;
                
                // Update modal
                if (modalStatusIndicator) modalStatusIndicator.classList.remove('connected');
                if (modalDriveStatus) modalDriveStatus.classList.remove('connected');
                if (modalStatusText) modalStatusText.textContent = 'Google Drive: Not Connected';
                if (modalAuthButton) {
                    modalAuthButton.textContent = 'Connect';
                    modalAuthButton.onclick = handleAuthClick;
                }
            }
        }

        async function uploadToDrive(csvContent, filename) {
            if (!isSignedIn) {
                console.log('Not signed in to Google Drive');
                return null;
            }

            try {
                // Use the specific Silver Fox Marketing Google Drive folder
                const SILVER_FOX_FOLDER_ID = '1Z4MwG3vW7ABcZ3_VIPJpgISSemEm4Jwe';
                let parentId = SILVER_FOX_FOLDER_ID;

                // Create the file
                const boundary = '-------314159265358979323846';
                const delimiter = "\r\n--" + boundary + "\r\n";
                const close_delim = "\r\n--" + boundary + "--";

                const metadata = {
                    'name': filename,
                    'mimeType': 'text/csv',
                    'parents': [parentId]
                };

                const multipartRequestBody =
                    delimiter +
                    'Content-Type: application/json\r\n\r\n' +
                    JSON.stringify(metadata) +
                    delimiter +
                    'Content-Type: text/csv\r\n\r\n' +
                    csvContent +
                    close_delim;

                const response = await gapi.client.request({
                    'path': '/upload/drive/v3/files',
                    'method': 'POST',
                    'params': {'uploadType': 'multipart'},
                    'headers': {
                        'Content-Type': 'multipart/related; boundary="' + boundary + '"'
                    },
                    'body': multipartRequestBody
                });

                console.log('File uploaded successfully:', response.result);
                return response.result;
            } catch (error) {
                console.error('Error uploading to Drive:', error);
                throw error;
            }
        }

        async function getOrCreateFolder(folderName, parentId) {
            try {
                // Search for existing folder
                const response = await gapi.client.drive.files.list({
                    q: `name='${folderName}' and mimeType='application/vnd.google-apps.folder' and '${parentId}' in parents and trashed=false`,
                    fields: 'files(id, name)',
                    spaces: 'drive'
                });

                if (response.result.files && response.result.files.length > 0) {
                    return response.result.files[0].id;
                }

                // Create new folder if not found
                const fileMetadata = {
                    'name': folderName,
                    'mimeType': 'application/vnd.google-apps.folder',
                    'parents': [parentId]
                };

                const createResponse = await gapi.client.drive.files.create({
                    resource: fileMetadata,
                    fields: 'id'
                });

                return createResponse.result.id;
            } catch (error) {
                console.error('Error creating folder:', error);
                throw error;
            }
        }

        function saveDriveSettings() {
            const autoUpload = document.getElementById('autoUploadToDrive').checked;
            localStorage.setItem('autoUploadToDrive', autoUpload);
            showNotification('Drive settings saved!');
        }

        // Load saved settings
        window.addEventListener('load', () => {
            const savedAutoUpload = localStorage.getItem('autoUploadToDrive');
            
            if (savedAutoUpload !== null) {
                document.getElementById('autoUploadToDrive').checked = savedAutoUpload === 'true';
            }
        });

        // Pending order type for save-before-switch dialog
        let pendingOrderType = '';

        // Original form functions
        function selectOrderTypeFromDropdown() {
            const select = document.getElementById('orderTypeSelect');
            const newOrderType = select.value;

            // If switching from an order type that has data, prompt to save
            if (currentOrderType && newOrderType !== currentOrderType && !isFormEmpty()) {
                pendingOrderType = newOrderType;
                // Revert the select to current value while dialog is shown
                select.value = currentOrderType;
                const dialog = document.getElementById('saveBeforeSwitchDialog');
                if (dialog) {
                    dialog.style.display = 'block';
                    return;
                }
            }

            performOrderTypeSwitch(newOrderType);
        }

        function closeSaveBeforeSwitchDialog() {
            const dialog = document.getElementById('saveBeforeSwitchDialog');
            if (dialog) {
                dialog.style.display = 'none';
            }
            pendingOrderType = '';
            // Revert select to current order type
            const select = document.getElementById('orderTypeSelect');
            if (select && currentOrderType) {
                select.value = currentOrderType;
            }
        }

        function saveAndSwitch() {
            if (saveOrderToHistory()) {
                showNotification('Order saved to history', 'success');
            }
            const newType = pendingOrderType;
            closeSaveBeforeSwitchDialog();
            performOrderTypeSwitch(newType);
        }

        function switchWithoutSaving() {
            const newType = pendingOrderType;
            closeSaveBeforeSwitchDialog();
            performOrderTypeSwitch(newType);
        }

        function performOrderTypeSwitch(newOrderType) {
            const select = document.getElementById('orderTypeSelect');
            select.value = newOrderType;
            currentOrderType = newOrderType;
            pendingOrderType = '';

            if (!currentOrderType) {
                document.getElementById('order-details').classList.add('hidden');
                return;
            }

            // Reset form state for new order
            currentProductType = '';
            multipleItemsData = [];
            selectedWindshieldSize = '';
            selectedWindshieldsSize = '';
            selectedBodySidesSize = '';
            selectedComplementsSize = '';
            selectedWindshieldType = '';
            selectedBodySideType = '';
            selectedComplementType = '';

            // Show order details section
            const detailsDiv = document.getElementById('order-details');
            detailsDiv.classList.remove('hidden');

            // Generate form based on type
            if (currentOrderType === 'vehicle') {
                generateVehicleForm();
            } else if (currentOrderType === 'dealership') {
                generateDealershipForm();
            } else if (currentOrderType === 'custom') {
                generateCustomForm();
            } else if (currentOrderType === 'template') {
                generateTemplateForm();
            } else if (currentOrderType === 'business-cards') {
                generateBusinessCardsForm();
            } else if (currentOrderType === 'banners') {
                generateBannersForm();
            }

            updateSummary();
        }

        function generateVehicleForm() {
            const html = `
                <h3>Vehicle Merchandising Details</h3>
                
                <div class="form-group">
                    <label for="vm_productType">Product Type <span class="required">*</span></label>
                    <select id="vm_productType" onchange="handleVehicleMerchandisingProductType()" required>
                        <option value="">Please Select:</option>
                        <option value="windshields">Windshields</option>
                        <option value="body-sides">Body Sides</option>
                        <option value="complements">Complements</option>
                    </select>
                </div>
                
                <div id="vm_nestedFields"></div>

                <!-- Multiple Items Button Container -->
                <div id="multipleItemsContainer" class="multiple-items-container hidden">
                    <button class="btn btn-multiple" onclick="openMultipleItemsModal()">
                        Enter Multiple Items
                    </button>
                </div>
            `;
            
            document.getElementById('order-details').innerHTML = html;
            currentProductType = '';
        }

        // Global variables to store selected sizes (static for VersaWorks)
        let selectedWindshieldSize = ''; // Legacy - will be replaced by selectedWindshieldsSize
        let selectedWindshieldsSize = ''; // New windshields size variable
        let selectedBodySidesSize = '';
        let selectedComplementsSize = '';
        
        // Global variables to store locked types
        let selectedWindshieldType = '';
        let selectedBodySideType = '';
        let selectedComplementType = '';
        
        function handleVehicleMerchandisingProductType() {
            const select = document.getElementById('vm_productType');
            const productType = select.value;
            currentProductType = productType;
            
            const container = document.getElementById('vm_nestedFields');
            container.innerHTML = '';
            
            // Reset sizes when switching product types
            if (productType !== 'windshields') {
                selectedWindshieldSize = '';
                selectedWindshieldsSize = '';
                selectedWindshieldType = '';
            }
            if (productType !== 'body-sides') {
                selectedBodySidesSize = '';
                selectedBodySideType = '';
            }
            if (productType !== 'complements') {
                selectedComplementsSize = '';
                selectedComplementType = '';
            }
            
            if (!productType) {
                // Hide Multiple Items button when no product type selected
                setTimeout(() => {
                    const multipleItemsContainer = document.getElementById('multipleItemsContainer');
                    if (multipleItemsContainer) {
                        multipleItemsContainer.classList.add('hidden');
                    }
                }, 100);
                updateSummary();
                return;
            }
            
            // Generate fields based on product type
            let fieldsHTML = '';
            
            if (productType === 'windshields') {
                // New Windshields structure with windshield types and nested triangle logic
                fieldsHTML = `
                    <div class="windshield-fields">
                        <div class="form-group">
                            <label for="ws_windshieldType">Windshield Type <span class="required">*</span></label>
                            <div class="field-container">
                                <select id="ws_windshieldType" onchange="handleWindshieldTypeChange()" required>
                                    <option value="">Please Select:</option>
                                    <option value="Flyout">Flyout</option>
                                    <option value="Oval">Oval</option>
                                    <option value="Trigon">Trigon</option>
                                    <option value="Upper-Triangle">Upper-Triangle</option>
                                </select>
                                <div class="lock-icon" id="ws_type_lock_icon" onclick="unlockWindshieldType()">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <div id="ws_size_container" style="display: none;">
                            <div class="form-group">
                                <label for="windshields_size">Size <span class="required">*</span></label>
                                <div class="field-container">
                                    <select id="windshields_size" onchange="handleWindshieldsSizeChange()" required>
                                        <option value="">Please Select:</option>
                                        <option value="Small">Small</option>
                                        <option value="Medium">Medium</option>
                                        <option value="Large">Large</option>
                                    </select>
                                    <div class="lock-icon" id="windshields_size_lock_icon" onclick="unlockWindshieldsSize()">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="ws_material_container" style="display: none;">
                            <div class="form-group">
                                <label for="windshields_material">Material <span class="required">*</span></label>
                                <div class="field-container">
                                    <select id="windshields_material" onchange="handleWindshieldsMaterialChange()" required>
                                        <option value="">Please Select:</option>
                                        <option value="Winter">Winter</option>
                                        <option value="Summer">Summer</option>
                                        <option value="Perf">Perf</option>
                                    </select>
                                    <div class="lock-icon" id="windshields_material_lock_icon" onclick="unlockWindshieldsMaterial()">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="ws_text_fields_container" style="display: none;">
                            <!-- Standard text fields for non-Flyout types -->
                            <div id="ws_standard_fields" style="display: none;">
                                <div class="form-group">
                                    <label for="ws_mainline1">Mainline 1</label>
                                    <input type="text" id="ws_mainline1" name="ws_mainline1" onchange="updateSummary()" oninput="checkCharacterLimit(this, 20)" placeholder="20 chars recommended">
                                    <small class="char-warning" style="color: #dc3545; display: none; margin-top: 5px;"> Over 20 character recommendation</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="ws_mainline2">Mainline 2</label>
                                    <input type="text" id="ws_mainline2" name="ws_mainline2" onchange="updateSummary()" oninput="checkCharacterLimit(this, 20)" placeholder="20 chars recommended">
                                    <small class="char-warning" style="color: #dc3545; display: none; margin-top: 5px;"> Over 20 character recommendation</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="ws_misc">Misc</label>
                                    <textarea id="ws_misc" name="ws_misc" onchange="updateSummary()" oninput="checkCharacterLimit(this, 120)" placeholder="120 chars recommended"></textarea>
                                    <small class="char-warning" style="color: #dc3545; display: none; margin-top: 5px;"> Over 120 character recommendation</small>
                                </div>
                            </div>
                            
                            <!-- Flyout-specific fields (Flyout, Mainline 1, Mainline 2, Misc) -->
                            <div id="ws_flyout_fields" style="display: none;">
                                <div class="form-group">
                                    <label for="ws_flyout1">Flyout</label>
                                    <input type="text" id="ws_flyout1" name="ws_flyout1" onchange="updateSummary()" oninput="checkCharacterLimit(this, 6)" placeholder="6 chars recommended">
                                    <small class="char-warning" style="color: #dc3545; display: none; margin-top: 5px;"> Over 6 character recommendation</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="ws_flyout_mainline1">Mainline 1</label>
                                    <input type="text" id="ws_flyout_mainline1" name="ws_flyout_mainline1" onchange="updateSummary()" oninput="checkCharacterLimit(this, 20)" placeholder="20 chars recommended">
                                    <small class="char-warning" style="color: #dc3545; display: none; margin-top: 5px;"> Over 20 character recommendation</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="ws_flyout_mainline2">Mainline 2</label>
                                    <input type="text" id="ws_flyout_mainline2" name="ws_flyout_mainline2" onchange="updateSummary()" oninput="checkCharacterLimit(this, 20)" placeholder="20 chars recommended">
                                    <small class="char-warning" style="color: #dc3545; display: none; margin-top: 5px;"> Over 20 character recommendation</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="ws_flyout_misc">Misc</label>
                                    <textarea id="ws_flyout_misc" name="ws_flyout_misc" onchange="updateSummary()" oninput="checkCharacterLimit(this, 120)" placeholder="120 chars recommended"></textarea>
                                    <small class="char-warning" style="color: #dc3545; display: none; margin-top: 5px;"> Over 120 character recommendation</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (productType === 'body-sides') {
                // Body Sides with conditional logic and size-locking for VersaWorks
                fieldsHTML = `
                    <div class="body-sides-fields">
                        <div class="form-group">
                            <label for="bs_bodysideType">Bodyside Type <span class="required">*</span></label>
                            <div class="field-container">
                                <select id="bs_bodysideType" onchange="handleBodysideTypeChange()" required>
                                    <option value="">Please Select:</option>
                                    <option value="Standard-Bodyside">Standard-Bodyside</option>
                                    <option value="Oval-Bodyside">Oval-Bodyside</option>
                                </select>
                                <div class="lock-icon" id="bs_type_lock_icon" onclick="unlockBodySideType()">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <div id="bs_size_container" style="display: none;">
                            <div class="form-group">
                                <label for="body_sides_size">Size <span class="required">*</span></label>
                                <div class="field-container">
                                    <select id="body_sides_size" onchange="handleBodySidesSizeChange()" required>
                                        <option value="">Please Select:</option>
                                        <option value="Small">Small</option>
                                        <option value="Medium (STD)">Medium (STD)</option>
                                        <option value="Large">Large</option>
                                        <option value="X-Large">X-Large</option>
                                    </select>
                                    <div class="lock-icon" id="body_sides_size_lock_icon" onclick="unlockBodySidesSize()">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="bs_material_container" style="display: none;">
                            <div class="form-group">
                                <label for="body_sides_material">Material <span class="required">*</span></label>
                                <div class="field-container">
                                    <select id="body_sides_material" onchange="handleBodySidesMaterialChange()" required>
                                        <option value="">Please Select:</option>
                                        <option value="Winter">Winter</option>
                                        <option value="Summer">Summer</option>
                                        <option value="Perf">Perf</option>
                                    </select>
                                    <div class="lock-icon" id="body_sides_material_lock_icon" onclick="unlockBodySidesMaterial()">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="bs_text_layout_container" style="display: none;">
                            <div class="form-group">
                                <label for="bs_mainline1">Mainline 1</label>
                                <input type="text" id="bs_mainline1" name="bs_mainline1" onchange="updateSummary()" oninput="checkCharacterLimit(this, 20)" placeholder="20 chars recommended">
                                <small class="char-warning" style="color: #dc3545; display: none; margin-top: 5px;"> Over 20 character recommendation</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="bs_mainline2">Mainline 2</label>
                                <input type="text" id="bs_mainline2" name="bs_mainline2" onchange="updateSummary()" oninput="checkCharacterLimit(this, 20)" placeholder="20 chars recommended">
                                <small class="char-warning" style="color: #dc3545; display: none; margin-top: 5px;"> Over 20 character recommendation</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="bs_misc">Misc</label>
                                <textarea id="bs_misc" name="bs_misc" onchange="updateSummary()" oninput="checkCharacterLimit(this, 120)" placeholder="120 chars recommended"></textarea>
                                <small class="char-warning" style="color: #dc3545; display: none; margin-top: 5px;"> Over 120 character recommendation</small>
                            </div>
                            
                            <div id="body_sides_material_container" style="display: none;">
                                <div class="form-group">
                                    <label for="body_sides_material">Material</label>
                                    <select id="body_sides_material" onchange="updateSummary()">
                                        <option value="">Please Select:</option>
                                        <option value="Winter">Winter</option>
                                        <option value="Summer">Summer</option>
                                        <option value="Perf">Perf</option>
                                    </select>
                                </div>
                                
                                <div id="body_sides_size_locked" style="display: none; background: #e8f5e8; border: 1px solid #4CAF50; border-radius: 4px; padding: 10px; margin: 10px 0;">
                                    <strong> Size Locked:</strong> <span id="locked_body_sides_size_display"></span>
                                    <br><small>All bulk entry items will use this size. <a href="#" onclick="unlockBodySidesSize()" style="color: #2196F3;">Change size</a></small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (productType === 'complements') {
                // Complements with fixed 3 text columns and size-locking for VersaWorks
                fieldsHTML = `
                    <div class="complements-fields">
                        <div class="form-group">
                            <label for="comp_complementType">Complement Type <span class="required">*</span></label>
                            <div class="field-container">
                                <select id="comp_complementType" onchange="handleComplementTypeChange()" required>
                                    <option value="">Please Select:</option>
                                    <option value="Inverted-Triangle">Inverted-Triangle</option>
                                    <option value="Oval-Comp">Oval-Comp</option>
                                </select>
                                <div class="lock-icon" id="comp_type_lock_icon" onclick="unlockComplementType()">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <div id="comp_size_container" style="display: none;">
                            <div class="form-group">
                                <label for="complements_size">Size <span class="required">*</span></label>
                                <div class="field-container">
                                    <select id="complements_size" onchange="handleComplementsSizeChange()" required>
                                        <option value="">Please Select:</option>
                                        <option value="Small">Small</option>
                                        <option value="Medium">Medium</option>
                                        <option value="Large">Large</option>
                                    </select>
                                    <div class="lock-icon" id="complements_size_lock_icon" onclick="unlockComplementsSize()">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="comp_material_container" style="display: none;">
                            <div class="form-group">
                                <label for="complements_material">Material <span class="required">*</span></label>
                                <div class="field-container">
                                    <select id="complements_material" onchange="handleComplementsMaterialChange()" required>
                                        <option value="">Please Select:</option>
                                        <option value="Winter">Winter</option>
                                        <option value="Summer">Summer</option>
                                        <option value="Perf">Perf</option>
                                    </select>
                                    <div class="lock-icon" id="complements_material_lock_icon" onclick="unlockComplementsMaterial()">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="comp_text_fields_container" style="display: none;">
                            <div class="form-group">
                                <label for="comp_mainline1">Mainline 1</label>
                                <input type="text" id="comp_mainline1" name="comp_mainline1" onchange="updateSummary()" oninput="checkCharacterLimit(this, 14)" placeholder="14 chars recommended">
                                <small class="char-warning" style="color: #dc3545; display: none; margin-top: 5px;"> Over 14 character recommendation</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="comp_mainline2">Mainline 2</label>
                                <input type="text" id="comp_mainline2" name="comp_mainline2" onchange="updateSummary()" oninput="checkCharacterLimit(this, 14)" placeholder="14 chars recommended">
                                <small class="char-warning" style="color: #dc3545; display: none; margin-top: 5px;"> Over 14 character recommendation</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="comp_misc">Misc</label>
                                <textarea id="comp_misc" name="comp_misc" onchange="updateSummary()" oninput="checkCharacterLimit(this, 60)" placeholder="60 chars recommended"></textarea>
                                <small class="char-warning" style="color: #dc3545; display: none; margin-top: 5px;"> Over 60 character recommendation</small>
                            </div>
                                </div>
                                
                                <div id="complements_size_locked" style="display: none; background: #e8f5e8; border: 1px solid #4CAF50; border-radius: 4px; padding: 10px; margin: 10px 0;">
                                    <strong> Size Locked:</strong> <span id="locked_complements_size_display"></span>
                                    <br><small>All bulk entry items will use this size. <a href="#" onclick="unlockComplementsSize()" style="color: #2196F3;">Change size</a></small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (productType === 'Windshield Banners') {
                fieldsHTML = `
                    <div class="nested-conditional-fields">
                        <div class="form-group">
                            <label for="vm_wb_productSize">Product Size <span class="required">*</span></label>
                            <select id="vm_wb_productSize" name="vm_wb_productSize" onchange="updateSummary()" required>
                                <option value="">Please Select:</option>
                                <option value="Small">Small</option>
                                <option value="Medium">Medium</option>
                                <option value="Large">Large</option>
                                <option value="X-Large">X-Large</option>
                                <option value="XXL">XXL</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="vm_wb_materialType">Material Type <span class="required">*</span></label>
                            <select id="vm_wb_materialType" name="vm_wb_materialType" onchange="updateSummary()" required>
                                <option value="">Please Select:</option>
                                <option value="Winter Vinyl">Winter Vinyl</option>
                                <option value="Summer Vinyl">Summer Vinyl</option>
                                <option value="Perforated Vinyl">Perforated Vinyl</option>
                                <option value="Poly Vinyl">Poly Vinyl</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="vm_wb_text">Text <span class="required">*</span></label>
                            <textarea id="vm_wb_text" name="vm_wb_text" oninput="updateSummary()" required placeholder="Enter banner text..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="vm_wb_designDetails">Design/Layout Details</label>
                            <textarea id="vm_wb_designDetails" name="vm_wb_designDetails" oninput="updateSummary()" placeholder="Describe design requirements, layout preferences, colors, etc..."></textarea>
                        </div>
                    </div>
                `;
            } else if (productType === 'Side Banners') {
                fieldsHTML = `
                    <div class="nested-conditional-fields">
                        <div class="form-group">
                            <label for="vm_sb_productSize">Product Size <span class="required">*</span></label>
                            <select id="vm_sb_productSize" name="vm_sb_productSize" onchange="updateSummary()" required>
                                <option value="">Please Select:</option>
                                <option value="Small">Small</option>
                                <option value="Medium">Medium</option>
                                <option value="Large">Large</option>
                                <option value="X-Large">X-Large</option>
                                <option value="XXL">XXL</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="vm_sb_materialType">Material Type <span class="required">*</span></label>
                            <select id="vm_sb_materialType" name="vm_sb_materialType" onchange="updateSummary()" required>
                                <option value="">Please Select:</option>
                                <option value="Winter Vinyl">Winter Vinyl</option>
                                <option value="Summer Vinyl">Summer Vinyl</option>
                                <option value="Perforated Vinyl">Perforated Vinyl</option>
                                <option value="Poly Vinyl">Poly Vinyl</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="vm_sb_text">Text <span class="required">*</span></label>
                            <textarea id="vm_sb_text" name="vm_sb_text" oninput="updateSummary()" required placeholder="Enter banner text..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="vm_sb_designDetails">Design/Layout Details</label>
                            <textarea id="vm_sb_designDetails" name="vm_sb_designDetails" oninput="updateSummary()" placeholder="Describe design requirements, layout preferences, colors, etc..."></textarea>
                        </div>
                    </div>
                `;
            } else if (productType === 'Complement Graphics') {
                fieldsHTML = `
                    <div class="nested-conditional-fields">
                        <div class="form-group">
                            <label for="vm_cg_productSize">Product Size <span class="required">*</span></label>
                            <select id="vm_cg_productSize" name="vm_cg_productSize" onchange="updateSummary()" required>
                                <option value="">Please Select:</option>
                                <option value="Small">Small</option>
                                <option value="Medium">Medium</option>
                                <option value="Large">Large</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="vm_cg_materialType">Material Type <span class="required">*</span></label>
                            <select id="vm_cg_materialType" name="vm_cg_materialType" onchange="updateSummary()" required>
                                <option value="">Select</option>
                                <option value="Winter Vinyl">Winter Vinyl</option>
                                <option value="Summer Vinyl">Summer Vinyl</option>
                                <option value="Perforated Vinyl">Perforated Vinyl</option>
                                <option value="Poly Vinyl">Poly Vinyl</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="vm_cg_text">Text</label>
                            <textarea id="vm_cg_text" name="vm_cg_text" oninput="updateSummary()" placeholder="Enter any text elements..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="vm_cg_designDetails">Design/Layout Details <span class="required">*</span></label>
                            <textarea id="vm_cg_designDetails" name="vm_cg_designDetails" oninput="updateSummary()" required placeholder="Describe graphic design requirements, layout, colors, style preferences..."></textarea>
                        </div>
                    </div>
                `;
            } else if (productType === 'Specially Sized Graphics') {
                fieldsHTML = `
                    <div class="nested-conditional-fields">
                        <div class="form-group">
                            <label for="vm_ssg_sizeDetails">Size Details <span class="required">*</span></label>
                            <textarea id="vm_ssg_sizeDetails" name="vm_ssg_sizeDetails" oninput="updateSummary()" required placeholder="Provide exact dimensions, measurements, and size specifications..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="vm_ssg_materialType">Material Type <span class="required">*</span></label>
                            <select id="vm_ssg_materialType" name="vm_ssg_materialType" onchange="updateSummary()" required>
                                <option value="">Select</option>
                                <option value="Winter Vinyl">Winter Vinyl</option>
                                <option value="Summer Vinyl">Summer Vinyl</option>
                                <option value="Perforated Vinyl">Perforated Vinyl</option>
                                <option value="Poly Vinyl">Poly Vinyl</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="vm_ssg_text">Text</label>
                            <textarea id="vm_ssg_text" name="vm_ssg_text" oninput="updateSummary()" placeholder="Enter any text elements..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="vm_ssg_designDetails">Design/Layout Details <span class="required">*</span></label>
                            <textarea id="vm_ssg_designDetails" name="vm_ssg_designDetails" oninput="updateSummary()" required placeholder="Describe design requirements, layout preferences, colors, application details..."></textarea>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = fieldsHTML;
            
            // Handle Multiple Items button visibility
            setTimeout(() => {
                const multipleItemsContainer = document.getElementById('multipleItemsContainer');
                if (multipleItemsContainer) {
                    if (productType === 'windshields' || productType === 'body-sides' || productType === 'complements' || productType === 'Windshield Banners' || productType === 'Side Banners' || productType === 'Complement Graphics' || productType === 'Specially Sized Graphics') {
                        // For products with size-locking, show only if size is selected (VersaWorks requirement)
                        if (productType === 'windshields') {
                            if (selectedWindshieldsSize) {
                                multipleItemsContainer.classList.remove('hidden');
                            } else {
                                multipleItemsContainer.classList.add('hidden');
                            }
                        } else if (productType === 'body-sides') {
                            if (selectedBodySidesSize) {
                                multipleItemsContainer.classList.remove('hidden');
                            } else {
                                multipleItemsContainer.classList.add('hidden');
                            }
                        } else if (productType === 'complements') {
                            if (selectedComplementsSize) {
                                multipleItemsContainer.classList.remove('hidden');
                            } else {
                                multipleItemsContainer.classList.add('hidden');
                            }
                        } else {
                            // For original form products (Windshield Banners, Side Banners, etc.) - show immediately
                            multipleItemsContainer.classList.remove('hidden');
                        }
                    } else {
                        multipleItemsContainer.classList.add('hidden');
                    }
                }
            }, 100);
            
            updateSummary();
        }
        
        function handleWindshieldSizeChange() {
            const sizeSelect = document.getElementById('windshield_size');
            const materialContainer = document.getElementById('windshield_material_container');
            const multipleItemsContainer = document.getElementById('multipleItemsContainer');
            const sizeLockedDiv = document.getElementById('windshield_size_locked');
            const lockedSizeDisplay = document.getElementById('locked_size_display');
            
            if (sizeSelect.value) {
                selectedWindshieldSize = sizeSelect.value;
                
                // Show material field
                materialContainer.style.display = 'block';
                
                // Show size locked indicator
                sizeLockedDiv.style.display = 'block';
                lockedSizeDisplay.textContent = selectedWindshieldSize;
                
                // Disable size dropdown to prevent accidental changes
                sizeSelect.disabled = true;
                
                // Show Multiple Items button
                if (multipleItemsContainer) {
                    multipleItemsContainer.classList.remove('hidden');
                }
            } else {
                selectedWindshieldSize = '';
                materialContainer.style.display = 'none';
                sizeLockedDiv.style.display = 'none';
                
                if (multipleItemsContainer) {
                    multipleItemsContainer.classList.add('hidden');
                }
            }
            
            updateSummary();
        }
        
        // Unified unlock handler - prompts user to clear form to change locked fields
        function promptClearFormToUnlock(fieldType) {
            const fieldName = fieldType.charAt(0).toUpperCase() + fieldType.slice(1);
            if (confirm(`To change the ${fieldName} field, you must clear the form and start over.\n\nWould you like to clear the form now?`)) {
                // Use the existing clear form logic which will prompt to save to history
                clearForm();
            }
        }

        function unlockWindshieldSize() {
            promptClearFormToUnlock('size');
        }
        
        function handleBodySidesSizeChange() {
            const sizeSelect = document.getElementById('body_sides_size');
            const materialContainer = document.getElementById('bs_material_container');
            const sizeLockedDiv = document.getElementById('body_sides_size_locked');
            const lockedSizeDisplay = document.getElementById('locked_body_sides_size_display');
            
            if (sizeSelect.value) {
                selectedBodySidesSize = sizeSelect.value;
                
                // Show lock icon and disable dropdown
                const lockIcon = document.getElementById('body_sides_size_lock_icon');
                lockIcon.classList.add('visible');
                sizeSelect.disabled = true;
                sizeSelect.classList.add('field-locked');
            } else {
                selectedBodySidesSize = '';
                const lockIcon = document.getElementById('body_sides_size_lock_icon');
                lockIcon.classList.remove('visible');
                sizeSelect.disabled = false;
                sizeSelect.classList.remove('field-locked');
            }
            
            updateSummary();
        }
        
        function handleBodySidesMaterialChange() {
            const materialSelect = document.getElementById('body_sides_material');
            const textLayoutContainer = document.getElementById('bs_text_layout_container');
            const materialLockedDiv = document.getElementById('body_sides_material_locked');
            const lockedMaterialDisplay = document.getElementById('locked_body_sides_material_display');
            const multipleItemsContainer = document.getElementById('multipleItemsContainer');
            
            if (materialSelect.value) {
                selectedBodySidesMaterial = materialSelect.value;
                
                // Show lock icon and disable dropdown
                const lockIcon = document.getElementById('body_sides_material_lock_icon');
                lockIcon.classList.add('visible');
                materialSelect.disabled = true;
                materialSelect.classList.add('field-locked');
                
                // Show text fields (final step)
                textLayoutContainer.style.display = 'block';
                
                // Show Multiple Items button (all three fields are now locked)
                if (multipleItemsContainer) {
                    multipleItemsContainer.classList.remove('hidden');
                }
            } else {
                selectedBodySidesMaterial = '';
                const lockIcon = document.getElementById('body_sides_material_lock_icon');
                lockIcon.classList.remove('visible');
                materialSelect.disabled = false;
                materialSelect.classList.remove('field-locked');
                textLayoutContainer.style.display = 'none';
                
                if (multipleItemsContainer) {
                    multipleItemsContainer.classList.add('hidden');
                }
            }
            
            updateSummary();
        }
        
        function unlockBodySideType() {
            promptClearFormToUnlock('type');
        }
        
        function unlockBodySidesSize() {
            promptClearFormToUnlock('size');
        }
        
        function handleBodysideTypeChange() {
            const bodysideTypeSelect = document.getElementById('bs_bodysideType');
            const sizeContainer = document.getElementById('bs_size_container');
            const textLayoutContainer = document.getElementById('bs_text_layout_container');
            const typeLockedDiv = document.getElementById('bs_type_locked');
            const lockedTypeDisplay = document.getElementById('locked_bs_type_display');
            
            if (bodysideTypeSelect.value) {
                // Lock the type
                selectedBodySideType = bodysideTypeSelect.value;
                
                // Show lock icon and disable dropdown
                const lockIcon = document.getElementById('bs_type_lock_icon');
                lockIcon.classList.add('visible');
                bodysideTypeSelect.disabled = true;
                bodysideTypeSelect.classList.add('field-locked');
                
                // Show both size and material containers at once
                sizeContainer.style.display = 'block';
                const materialContainer = document.getElementById('bs_material_container');
                materialContainer.style.display = 'block';
            } else {
                // Reset type lock
                selectedBodySideType = '';
                const lockIcon = document.getElementById('bs_type_lock_icon');
                lockIcon.classList.remove('visible');
                bodysideTypeSelect.disabled = false;
                bodysideTypeSelect.classList.remove('field-locked');
                
                // Hide size container and all subsequent fields
                sizeContainer.style.display = 'none';
                textLayoutContainer.style.display = 'none';
                // Clear text fields when bodyside type is cleared
                const mainline1 = document.getElementById('bs_mainline1');
                const mainline2 = document.getElementById('bs_mainline2');
                const misc = document.getElementById('bs_misc');
                
                if (mainline1) mainline1.value = '';
                if (mainline2) mainline2.value = '';
                if (misc) misc.value = '';
            }
            
            updateSummary();
        }
        
        // Complements handlers
        function handleComplementTypeChange() {
            const complementTypeSelect = document.getElementById('comp_complementType');
            const sizeContainer = document.getElementById('comp_size_container');
            const textFieldsContainer = document.getElementById('comp_text_fields_container');
            const typeLockedDiv = document.getElementById('comp_type_locked');
            const lockedTypeDisplay = document.getElementById('locked_comp_type_display');
            
            if (complementTypeSelect.value) {
                // Lock the type
                selectedComplementType = complementTypeSelect.value;
                
                // Show lock icon and disable dropdown
                const lockIcon = document.getElementById('comp_type_lock_icon');
                lockIcon.classList.add('visible');
                complementTypeSelect.disabled = true;
                complementTypeSelect.classList.add('field-locked');
                
                // Show both size and material containers at once
                sizeContainer.style.display = 'block';
                const materialContainer = document.getElementById('comp_material_container');
                materialContainer.style.display = 'block';
            } else {
                // Reset type lock
                selectedComplementType = '';
                const lockIcon = document.getElementById('comp_type_lock_icon');
                lockIcon.classList.remove('visible');
                complementTypeSelect.disabled = false;
                complementTypeSelect.classList.remove('field-locked');
                
                // Hide size container and all subsequent fields
                sizeContainer.style.display = 'none';
                
                textFieldsContainer.style.display = 'none';
                // Clear text fields when complement type is cleared
                const mainline1 = document.getElementById('comp_mainline1');
                const mainline2 = document.getElementById('comp_mainline2');
                const misc = document.getElementById('comp_misc');
                
                if (mainline1) mainline1.value = '';
                if (mainline2) mainline2.value = '';
                if (misc) misc.value = '';
            }
            
            updateSummary();
        }
        
        function handleComplementsSizeChange() {
            const sizeSelect = document.getElementById('complements_size');
            const materialContainer = document.getElementById('comp_material_container');
            const sizeLockedDiv = document.getElementById('complements_size_locked');
            const lockedSizeDisplay = document.getElementById('locked_complements_size_display');
            
            if (sizeSelect.value) {
                selectedComplementsSize = sizeSelect.value;
                
                // Material container already shown by type selection
                
                // Show lock icon and disable dropdown
                const lockIcon = document.getElementById('complements_size_lock_icon');
                lockIcon.classList.add('visible');
                sizeSelect.disabled = true;
                sizeSelect.classList.add('field-locked');
            } else {
                selectedComplementsSize = '';
                const lockIcon = document.getElementById('complements_size_lock_icon');
                lockIcon.classList.remove('visible');
                sizeSelect.disabled = false;
                sizeSelect.classList.remove('field-locked');
                materialContainer.style.display = 'none';
                sizeLockedDiv.style.display = 'none';
                
                if (multipleItemsContainer) {
                    multipleItemsContainer.classList.add('hidden');
                }
            }
            
            updateSummary();
        }
        
        function handleComplementsMaterialChange() {
            const materialSelect = document.getElementById('complements_material');
            const textFieldsContainer = document.getElementById('comp_text_fields_container');
            const materialLockedDiv = document.getElementById('complements_material_locked');
            const lockedMaterialDisplay = document.getElementById('locked_complements_material_display');
            const multipleItemsContainer = document.getElementById('multipleItemsContainer');
            
            if (materialSelect.value) {
                selectedComplementsMaterial = materialSelect.value;
                
                // Show lock icon and disable dropdown
                const lockIcon = document.getElementById('complements_material_lock_icon');
                lockIcon.classList.add('visible');
                materialSelect.disabled = true;
                materialSelect.classList.add('field-locked');
                
                // Show text fields (final step)
                textFieldsContainer.style.display = 'block';
                
                // Show Multiple Items button (all three fields are now locked)
                if (multipleItemsContainer) {
                    multipleItemsContainer.classList.remove('hidden');
                }
            } else {
                selectedComplementsMaterial = '';
                const lockIcon = document.getElementById('complements_material_lock_icon');
                lockIcon.classList.remove('visible');
                materialSelect.disabled = false;
                materialSelect.classList.remove('field-locked');
                textFieldsContainer.style.display = 'none';
                
                if (multipleItemsContainer) {
                    multipleItemsContainer.classList.add('hidden');
                }
            }
            
            updateSummary();
        }
        
        function unlockComplementType() {
            promptClearFormToUnlock('type');
        }

        function unlockComplementsSize() {
            promptClearFormToUnlock('size');
        }
        
        // New Windshields handlers
        function handleWindshieldTypeChange() {
            const windshieldTypeSelect = document.getElementById('ws_windshieldType');
            const sizeContainer = document.getElementById('ws_size_container');
            const textFieldsContainer = document.getElementById('ws_text_fields_container');
            const typeLockedDiv = document.getElementById('ws_type_locked');
            const lockedTypeDisplay = document.getElementById('locked_ws_type_display');
            const standardFields = document.getElementById('ws_standard_fields');
            const flyoutFields = document.getElementById('ws_flyout_fields');
            
            if (windshieldTypeSelect.value) {
                // Lock the type
                selectedWindshieldType = windshieldTypeSelect.value;
                
                // Show lock icon and disable dropdown
                const lockIcon = document.getElementById('ws_type_lock_icon');
                lockIcon.classList.add('visible');
                windshieldTypeSelect.disabled = true;
                windshieldTypeSelect.classList.add('field-locked');
                
                // Show both size and material containers at once
                sizeContainer.style.display = 'block';
                const materialContainer = document.getElementById('ws_material_container');
                materialContainer.style.display = 'block';
                
                // Prepare text fields based on type but don't show yet
                if (selectedWindshieldType === 'Flyout') {
                    // Prepare Flyout-specific fields (4 text boxes)
                    standardFields.style.display = 'none';
                    flyoutFields.style.display = 'block';
                } else {
                    // Prepare standard fields (Mainline 1, Mainline 2, Misc)
                    standardFields.style.display = 'block';
                    flyoutFields.style.display = 'none';
                }
            } else {
                // Reset type lock
                selectedWindshieldType = '';
                const lockIcon = document.getElementById('ws_type_lock_icon');
                lockIcon.classList.remove('visible');
                windshieldTypeSelect.disabled = false;
                windshieldTypeSelect.classList.remove('field-locked');
                
                // Hide size container and all subsequent fields
                sizeContainer.style.display = 'none';
                textFieldsContainer.style.display = 'none';
                standardFields.style.display = 'none';
                flyoutFields.style.display = 'none';
                clearWindshieldTextFields();
            }
            
            updateSummary();
        }
        
        
        function handleWindshieldsSizeChange() {
            const sizeSelect = document.getElementById('windshields_size');
            const materialContainer = document.getElementById('ws_material_container');
            const sizeLockedDiv = document.getElementById('windshields_size_locked');
            const lockedSizeDisplay = document.getElementById('locked_windshields_size_display');
            
            if (sizeSelect.value) {
                selectedWindshieldsSize = sizeSelect.value;
                
                // Show lock icon and disable dropdown
                const lockIcon = document.getElementById('windshields_size_lock_icon');
                lockIcon.classList.add('visible');
                sizeSelect.disabled = true;
                sizeSelect.classList.add('field-locked');
            } else {
                selectedWindshieldsSize = '';
                const lockIcon = document.getElementById('windshields_size_lock_icon');
                lockIcon.classList.remove('visible');
                sizeSelect.disabled = false;
                sizeSelect.classList.remove('field-locked');
            }
            
            updateSummary();
        }
        
        function handleWindshieldsMaterialChange() {
            const materialSelect = document.getElementById('windshields_material');
            const textFieldsContainer = document.getElementById('ws_text_fields_container');
            const multipleItemsContainer = document.getElementById('multipleItemsContainer');
            
            if (materialSelect.value) {
                selectedWindshieldsMaterial = materialSelect.value;
                
                // Show lock icon and disable dropdown
                const lockIcon = document.getElementById('windshields_material_lock_icon');
                lockIcon.classList.add('visible');
                materialSelect.disabled = true;
                materialSelect.classList.add('field-locked');
                
                // Show text fields (final step)
                textFieldsContainer.style.display = 'block';
                
                // Show Multiple Items button (all three fields are now locked)
                if (multipleItemsContainer) {
                    multipleItemsContainer.classList.remove('hidden');
                }
            } else {
                selectedWindshieldsMaterial = '';
                const lockIcon = document.getElementById('windshields_material_lock_icon');
                lockIcon.classList.remove('visible');
                materialSelect.disabled = false;
                materialSelect.classList.remove('field-locked');
                textFieldsContainer.style.display = 'none';
                
                if (multipleItemsContainer) {
                    multipleItemsContainer.classList.add('hidden');
                }
            }
            
            updateSummary();
        }
        
        function unlockWindshieldType() {
            promptClearFormToUnlock('type');
        }

        function unlockWindshieldsSize() {
            promptClearFormToUnlock('size');
        }

        function unlockWindshieldsMaterial() {
            promptClearFormToUnlock('material');
        }

        function unlockBodySidesMaterial() {
            promptClearFormToUnlock('material');
        }

        function unlockComplementsMaterial() {
            promptClearFormToUnlock('material');
        }

        function clearWindshieldTextFields() {
            // Clear standard fields
            const mainline1 = document.getElementById('ws_mainline1');
            const mainline2 = document.getElementById('ws_mainline2');
            const misc = document.getElementById('ws_misc');
            
            if (mainline1) mainline1.value = '';
            if (mainline2) mainline2.value = '';
            if (misc) misc.value = '';
            
            // Clear Flyout fields
            const flyout1 = document.getElementById('ws_flyout1');
            const flyoutMainline1 = document.getElementById('ws_flyout_mainline1');
            const flyoutMainline2 = document.getElementById('ws_flyout_mainline2');
            const flyoutMisc = document.getElementById('ws_flyout_misc');
            
            if (flyout1) flyout1.value = '';
            if (flyoutMainline1) flyoutMainline1.value = '';
            if (flyoutMainline2) flyoutMainline2.value = '';
            if (flyoutMisc) flyoutMisc.value = '';
        }
        
        // Character limit checking functions
        function checkCharacterLimit(element, recommendedLimit) {
            const currentLength = element.value.length;
            const warningElement = element.nextElementSibling;
            
            if (currentLength > recommendedLimit) {
                // Show red border and warning
                element.style.borderColor = '#dc3545';
                element.style.borderWidth = '2px';
                if (warningElement && warningElement.classList.contains('char-warning')) {
                    warningElement.style.display = 'block';
                }
            } else {
                // Reset to normal styling
                element.style.borderColor = '';
                element.style.borderWidth = '';
                if (warningElement && warningElement.classList.contains('char-warning')) {
                    warningElement.style.display = 'none';
                }
            }
        }
        
        function checkCharacterLimitModal(element, recommendedLimit) {
            const currentLength = element.value.length;
            
            if (currentLength > recommendedLimit) {
                // Add character limit exceeded class for styling
                element.classList.add('char-limit-exceeded');
                
                // Show modal notification
                showModalNotification(
                    ` Character limit exceeded: ${currentLength}/${recommendedLimit} characters`,
                    'warning'
                );
                
                // Add tooltip for additional context
                element.title = ` Over ${recommendedLimit} character recommendation (${currentLength} chars)`;
            } else {
                // Reset to normal styling
                element.classList.remove('char-limit-exceeded');
                element.title = '';
            }
        }

        // Modal-specific notification system
        function showModalNotification(message, type = 'error') {
            // Remove any existing modal notifications
            const existingNotifications = document.querySelectorAll('.modal-notification');
            existingNotifications.forEach(notification => notification.remove());
            
            const notification = document.createElement('div');
            notification.className = `modal-notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Trigger animation
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }
        

        // ... (Include all other form generation functions here - generateDealershipForm, generateCustomForm, etc.)

        function autoScaleQuantityInput(input) {
            // Calculate width based on value length with some padding
            const value = input.value;
            const minWidth = 60; // Minimum width in pixels
            const charWidth = 12; // Approximate character width in pixels
            const padding = 20; // Extra padding for input styling
            
            const calculatedWidth = Math.max(minWidth, (value.length * charWidth) + padding);
            
            // Update both the input and its parent cell
            input.style.width = calculatedWidth + 'px';
            const parentCell = input.closest('td');
            if (parentCell) {
                parentCell.style.width = calculatedWidth + 'px';
                parentCell.style.minWidth = calculatedWidth + 'px';
            }
        }

        function autoResizeTextarea(textarea) {
            // Store the current scroll position
            const scrollPos = textarea.scrollTop;
            
            // Reset height to recalculate
            textarea.style.height = 'auto';
            
            // Get the computed styles
            const computed = window.getComputedStyle(textarea);
            const minHeight = parseInt(computed.minHeight) || 40;
            const maxHeight = parseInt(computed.maxHeight) || 150;
            
            // Calculate the new height based on scrollHeight
            let newHeight = textarea.scrollHeight;
            
            // Apply min/max constraints
            newHeight = Math.max(minHeight, Math.min(newHeight, maxHeight));
            
            // Set the new height
            textarea.style.height = newHeight + 'px';
            
            // Show/hide scrollbar based on content
            if (textarea.scrollHeight > maxHeight) {
                textarea.style.overflowY = 'auto';
            } else {
                textarea.style.overflowY = 'hidden';
            }
            
            // Restore scroll position
            textarea.scrollTop = scrollPos;
        }
        
        function initializeTextareaAutoResize(textarea) {
            // Set initial height
            autoResizeTextarea(textarea);
            
            // Add event listeners for auto-resize
            textarea.addEventListener('input', function() {
                autoResizeTextarea(this);
            });
            
            // Also resize on focus to ensure proper initial state
            textarea.addEventListener('focus', function() {
                autoResizeTextarea(this);
            });
        }

        function openMultipleItemsModal() {
            const modal = document.getElementById('multipleItemsModal');
            modal.style.display = 'block';
            
            // First initialize the spreadsheet with default row
            initializeSpreadsheet();
            
            // Setup keyboard shortcuts and drag-and-drop
            setupKeyboardShortcuts();
            setupDragAndDrop();
            makeDragHandlesDraggable();
            
            // Check if there's saved data to restore
            // Only restore if data exists for the same product type
            setTimeout(() => {
                const restored = restoreModalData();
                // If no data was restored, the default row from initializeSpreadsheet remains
                focusFirstEditableCell();
            }, 100);
            
            // Add global Enter key listener for when modal first opens
            setupModalEntryShortcut();
        }

        function focusFirstEditableCell() {
            const table = document.getElementById('spreadsheetTable');
            if (!table) return;
            
            // Find the first row with editable cells
            const firstRow = table.querySelector('tbody tr');
            if (!firstRow) return;
            
            // Find the first editable cell (skip drag handle and readonly fields)
            const editableInputs = firstRow.querySelectorAll('input, select, textarea');
            const firstEditable = Array.from(editableInputs).find(input => {
                if (input.closest('.drag-handle') || input.disabled || input.readOnly) {
                    return false;
                }
                // Check for readonly styling (cursor: not-allowed)
                const styles = window.getComputedStyle(input);
                if (styles.cursor === 'not-allowed') {
                    return false;
                }
                // Additional check for style attribute with cursor: not-allowed
                if (input.style.cursor === 'not-allowed') {
                    return false;
                }
                return true;
            });
            
            if (firstEditable) {
                firstEditable.focus();
                // For text inputs, select all content for easy replacement
                if (firstEditable.type === 'text' || firstEditable.tagName === 'TEXTAREA') {
                    firstEditable.select();
                }
            }
        }

        function setupModalEntryShortcut() {
            const modal = document.getElementById('multipleItemsModal');
            
            // Remove any existing listeners to prevent duplicates
            modal.removeEventListener('keydown', modalEntryHandler);
            
            // Add listener for initial modal entry
            modal.addEventListener('keydown', modalEntryHandler);
        }

        function modalEntryHandler(e) {
            const modal = document.getElementById('multipleItemsModal');
            if (modal.style.display !== 'block') return;
            
            // Only handle if no input is currently focused (modal just opened)
            const activeElement = document.activeElement;
            const isInTable = activeElement.closest('#spreadsheetTable');
            
            // If user presses Enter and is not in a table input, focus first cell
            if (e.key === 'Enter' && !isInTable) {
                focusFirstEditableCell();
                e.preventDefault();
                return;
            }
            
            // If user starts typing and is not in an input, focus first cell and insert the character
            if (!isInTable && e.key.length === 1 && !e.ctrlKey && !e.altKey && !e.metaKey) {
                focusFirstEditableCell();
                // Let the character be inserted into the newly focused input
                setTimeout(() => {
                    const focusedElement = document.activeElement;
                    if (focusedElement && (focusedElement.tagName === 'INPUT' || focusedElement.tagName === 'TEXTAREA')) {
                        // Clear any existing content and insert the typed character
                        focusedElement.value = e.key;
                        // Position cursor at the end
                        focusedElement.setSelectionRange(1, 1);
                    }
                }, 0);
                e.preventDefault();
            }
        }

        function closeModal() {
            const modal = document.getElementById('multipleItemsModal');
            modal.style.display = 'none';
            
            // Clean up event listeners
            modal.removeEventListener('keydown', modalEntryHandler);
        }

        function openExportSettingsModal() {
            const modal = document.getElementById('exportSettingsModal');
            modal.style.display = 'block';
            
            // Sync the Google Drive status from header to modal
            syncGoogleDriveStatus();
        }

        function closeExportSettingsModal() {
            const modal = document.getElementById('exportSettingsModal');
            modal.style.display = 'none';
        }

        function openSettingsModal() {
            const modal = document.getElementById('settingsModal');
            modal.style.display = 'block';
        }

        function closeSettingsModal() {
            const modal = document.getElementById('settingsModal');
            modal.style.display = 'none';
        }

        function syncGoogleDriveStatus() {
            // Get status from header
            const headerStatus = document.getElementById('statusText');
            const headerIndicator = document.getElementById('statusIndicator');
            const headerButton = document.getElementById('authButton');
            
            // Update modal elements
            const modalStatus = document.getElementById('modalStatusText');
            const modalIndicator = document.getElementById('modalStatusIndicator');
            const modalButton = document.getElementById('modalAuthButton');
            
            if (headerStatus && modalStatus) {
                modalStatus.textContent = headerStatus.textContent;
            }
            
            if (headerIndicator && modalIndicator) {
                modalIndicator.className = headerIndicator.className;
            }
            
            if (headerButton && modalButton) {
                modalButton.textContent = headerButton.textContent;
                modalButton.onclick = headerButton.onclick;
            }
        }

        function initializeSpreadsheet() {
            let headers, modalTitle;
            
            if (currentProductType === 'windshields') {
                // Windshields with conditional columns based on type (Material is locked, not shown in modal)
                if (selectedWindshieldType === 'Flyout') {
                    headers = ['QTY', 'Windshield Type', 'Flyout', 'Mainline 1', 'Mainline 2', 'Misc'];
                } else {
                    headers = ['QTY', 'Windshield Type', 'Mainline 1', 'Mainline 2', 'Misc'];
                }
                modalTitle = `Windshields - Size: ${selectedWindshieldsSize}, Material: ${selectedWindshieldsMaterial}`;
            } else if (currentProductType === 'body-sides') {
                // Fixed headers with 3 text columns (Material is locked, not shown in modal)
                headers = ['QTY', 'Bodyside Type', 'Mainline 1', 'Mainline 2', 'Misc'];
                modalTitle = `Body Sides - Size: ${selectedBodySidesSize}, Material: ${selectedBodySidesMaterial}`;
            } else if (currentProductType === 'complements') {
                // Fixed headers with 3 text columns (Material is locked, not shown in modal)
                headers = ['QTY', 'Complement Type', 'Mainline 1', 'Mainline 2', 'Misc'];
                modalTitle = `Complements - Size: ${selectedComplementsSize}, Material: ${selectedComplementsMaterial}`;
            } else {
                // Default headers for other product types
                headers = ['QTY', 'Vehicle Type', 'Message Line 1', 'Message Line 2', 'Price', 'Color', 'Size'];
                modalTitle = 'Multiple Items Entry';
            }
            
            // Update modal title
            const modalTitleElement = document.querySelector('#multipleItemsModal .modal-header h2');
            if (modalTitleElement) {
                modalTitleElement.textContent = modalTitle;
            }
            
            const headerRow = document.getElementById('spreadsheetHeader');
            headerRow.innerHTML = `<th style="width: 30px;" title="Drag to reorder rows"></th>` + headers.map(h => `<th>${h}</th>`).join('');
            
            const tbody = document.getElementById('spreadsheetBody');
            tbody.innerHTML = '';
            addSpreadsheetRow();
        }

        function clearTable() {
            const tbody = document.getElementById('spreadsheetBody');
            const rowCount = tbody.querySelectorAll('tr').length;
            
            // Check if there's data to clear
            if (rowCount === 0) {
                showModalNotification('Table is already empty', 'info');
                return;
            }
            
            // Show confirmation dialog
            const message = rowCount === 1 
                ? 'Are you sure you want to clear the table? This will remove the current row.'
                : `Are you sure you want to clear the table? This will remove all ${rowCount} rows.`;
            
            if (confirm(message + '\n\nThis action cannot be undone.')) {
                // Clear the table
                tbody.innerHTML = '';
                
                // Add a single empty row
                addSpreadsheetRow();
                
                // Clear the auto-saved data as well
                sessionStorage.removeItem('modalDataAutoSave');
                sessionStorage.removeItem('modalProductType');
                modalDataAutoSave = [];
                
                // Show notification
                showModalNotification('Table cleared successfully', 'info');
                
                // Focus the first input in the new row
                setTimeout(() => {
                    focusFirstEditableCell();
                }, 100);
            }
        }

        function addSpreadsheetRow() {
            const tbody = document.getElementById('spreadsheetBody');
            
            const row = document.createElement('tr');
            
            if (currentProductType === 'windshields') {
                // Windshields with conditional columns based on type
                const defaultWindshieldType = selectedWindshieldType || '';
                const defaultMaterial = document.getElementById('windshields_material') ? 
                    document.getElementById('windshields_material').value : '';
                
                if (selectedWindshieldType === 'Flyout') {
                    // Flyout type with Flyout, Mainline 1, Mainline 2, Misc
                    const defaultFlyout1 = document.getElementById('ws_flyout1') ? 
                        document.getElementById('ws_flyout1').value : '';
                    const defaultMainline1 = document.getElementById('ws_flyout_mainline1') ? 
                        document.getElementById('ws_flyout_mainline1').value : '';
                    const defaultMainline2 = document.getElementById('ws_flyout_mainline2') ? 
                        document.getElementById('ws_flyout_mainline2').value : '';
                    const defaultMisc = document.getElementById('ws_flyout_misc') ? 
                        document.getElementById('ws_flyout_misc').value : '';
                    
                    row.innerHTML = `
                        <td class="drag-handle" draggable="true"></td>
                        <td class="qty-cell"><input type="number" min="1" value="1" data-field="quantity" oninput="autoScaleQuantityInput(this)"></td>
                        <td>
                            <input type="text" data-field="windshieldType" value="${defaultWindshieldType}" readonly style="background: #f0f0f0; cursor: not-allowed;" title="Type is locked. Unlock to change.">
                        </td>
                        <td><input type="text" data-field="flyout1" placeholder="Flyout" oninput="checkCharacterLimitModal(this, 6)" value="${defaultFlyout1}"></td>
                        <td><textarea data-field="mainline1" placeholder="Mainline 1" oninput="checkCharacterLimitModal(this, 20)" >${defaultMainline1}</textarea></td>
                        <td><textarea data-field="mainline2" placeholder="Mainline 2" oninput="checkCharacterLimitModal(this, 20)" >${defaultMainline2}</textarea></td>
                        <td><textarea data-field="misc" placeholder="Misc" oninput="checkCharacterLimitModal(this, 120)">${defaultMisc}</textarea></td>
                    `;
                } else {
                    // Standard type with Mainline 1, Mainline 2, Misc
                    const defaultMainline1 = document.getElementById('ws_mainline1') ? 
                        document.getElementById('ws_mainline1').value : '';
                    const defaultMainline2 = document.getElementById('ws_mainline2') ? 
                        document.getElementById('ws_mainline2').value : '';
                    const defaultMisc = document.getElementById('ws_misc') ? 
                        document.getElementById('ws_misc').value : '';
                    
                    row.innerHTML = `
                        <td class="drag-handle" draggable="true"></td>
                        <td class="qty-cell"><input type="number" min="1" value="1" data-field="quantity" oninput="autoScaleQuantityInput(this)"></td>
                        <td>
                            <input type="text" data-field="windshieldType" value="${defaultWindshieldType}" readonly style="background: #f0f0f0; cursor: not-allowed;" title="Type is locked. Unlock to change.">
                        </td>
                        <td><textarea data-field="mainline1" placeholder="Mainline 1" oninput="checkCharacterLimitModal(this, 20)" >${defaultMainline1}</textarea></td>
                        <td><textarea data-field="mainline2" placeholder="Mainline 2" oninput="checkCharacterLimitModal(this, 20)" >${defaultMainline2}</textarea></td>
                        <td><textarea data-field="misc" placeholder="Misc" oninput="checkCharacterLimitModal(this, 120)">${defaultMisc}</textarea></td>
                    `;
                }
            } else if (currentProductType === 'body-sides') {
                // Body sides with fixed 3 text columns
                const defaultBodysideType = selectedBodySideType || '';
                const defaultMainline1 = document.getElementById('bs_mainline1') ? 
                    document.getElementById('bs_mainline1').value : '';
                const defaultMainline2 = document.getElementById('bs_mainline2') ? 
                    document.getElementById('bs_mainline2').value : '';
                const defaultMisc = document.getElementById('bs_misc') ? 
                    document.getElementById('bs_misc').value : '';
                const defaultMaterial = document.getElementById('body_sides_material') ? 
                    document.getElementById('body_sides_material').value : '';
                
                row.innerHTML = `
                    <td class="drag-handle" draggable="true"></td>
                    <td class="qty-cell"><input type="number" min="1" value="1" data-field="quantity" oninput="autoScaleQuantityInput(this)"></td>
                    <td>
                        <input type="text" data-field="bodysideType" value="${defaultBodysideType}" readonly style="background: #f0f0f0; cursor: not-allowed;" title="Type is locked. Unlock to change.">
                    </td>
                    <td><textarea data-field="mainline1" placeholder="Mainline 1" oninput="checkCharacterLimitModal(this, 20)" >${defaultMainline1}</textarea></td>
                    <td><textarea data-field="mainline2" placeholder="Mainline 2" oninput="checkCharacterLimitModal(this, 20)" >${defaultMainline2}</textarea></td>
                    <td><textarea data-field="misc" placeholder="Misc" oninput="checkCharacterLimitModal(this, 120)">${defaultMisc}</textarea></td>
                `;
            } else if (currentProductType === 'complements') {
                // Complements with fixed 3 text columns
                const defaultComplementType = selectedComplementType || '';
                const defaultMainline1 = document.getElementById('comp_mainline1') ? 
                    document.getElementById('comp_mainline1').value : '';
                const defaultMainline2 = document.getElementById('comp_mainline2') ? 
                    document.getElementById('comp_mainline2').value : '';
                const defaultMisc = document.getElementById('comp_misc') ? 
                    document.getElementById('comp_misc').value : '';
                const defaultMaterial = document.getElementById('complements_material') ? 
                    document.getElementById('complements_material').value : '';
                
                row.innerHTML = `
                    <td class="drag-handle" draggable="true"></td>
                    <td class="qty-cell"><input type="number" min="1" value="1" data-field="quantity" oninput="autoScaleQuantityInput(this)"></td>
                    <td>
                        <input type="text" data-field="complementType" value="${defaultComplementType}" readonly style="background: #f0f0f0; cursor: not-allowed;" title="Type is locked. Unlock to change.">
                    </td>
                    <td><textarea data-field="mainline1" placeholder="Mainline 1" oninput="checkCharacterLimitModal(this, 14)">${defaultMainline1}</textarea></td>
                    <td><textarea data-field="mainline2" placeholder="Mainline 2" oninput="checkCharacterLimitModal(this, 14)">${defaultMainline2}</textarea></td>
                    <td><textarea data-field="misc" placeholder="Misc" oninput="checkCharacterLimitModal(this, 60)">${defaultMisc}</textarea></td>
                `;
            } else {
                // Default fields for other product types
                row.innerHTML = `
                    <td class="drag-handle" draggable="true"></td>
                    <td class="qty-cell"><input type="number" min="1" value="1" data-field="quantity" oninput="autoScaleQuantityInput(this)"></td>
                    <td><input type="text" data-field="vehicleType" placeholder="e.g., SUV"></td>
                    <td><input type="text" data-field="message1" placeholder="Main message"></td>
                    <td><input type="text" data-field="message2" placeholder="Secondary message"></td>
                    <td><input type="text" data-field="price" placeholder="$29,999"></td>
                    <td><input type="text" data-field="color" placeholder="Red"></td>
                    <td><input type="text" data-field="size" placeholder="Large"></td>
                `;
            }
            
            tbody.appendChild(row);
            
            // Initialize auto-resize for all textareas in the new row
            row.querySelectorAll('textarea').forEach(textarea => {
                initializeTextareaAutoResize(textarea);
            });
            
            // Create and add delete button as a new cell
            const deleteCell = document.createElement('td');
            deleteCell.style.position = 'relative';
            deleteCell.style.width = '1px';
            deleteCell.style.padding = '0';
            deleteCell.style.border = 'none';
            deleteCell.style.background = 'transparent';
            
            const deleteBtn = document.createElement('button');
            deleteBtn.type = 'button';
            deleteBtn.className = 'delete-row-btn';
            deleteBtn.title = 'Delete row';
            deleteBtn.onclick = function() { deleteSpreadsheetRow(this); };
            deleteBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
            `;
            
            deleteCell.appendChild(deleteBtn);
            row.appendChild(deleteCell);
            
            // Make new drag handle draggable
            const dragHandle = row.querySelector('.drag-handle');
            if (dragHandle) {
                dragHandle.setAttribute('draggable', 'true');
            }
        }
        
        function deleteSpreadsheetRow(button) {
            const row = button.closest('tr');
            const tbody = document.getElementById('spreadsheetBody');
            
            // Don't delete if it's the last row
            if (tbody.children.length > 1) {
                row.remove();
            } else {
                // If it's the last row, just clear its contents instead of deleting
                const inputs = row.querySelectorAll('input, select');
                inputs.forEach(input => {
                    if (input.type === 'number') {
                        input.value = '1';
                    } else {
                        input.value = '';
                    }
                });
            }
        }

        function applyMultipleItems() {
            multipleItemsData = [];
            const rows = document.querySelectorAll('#spreadsheetBody tr');
            
            rows.forEach(row => {
                const rowData = {};
                
                // Handle input, select, and textarea elements
                row.querySelectorAll('input, select, textarea').forEach(element => {
                    if (element.dataset.field) {
                        rowData[element.dataset.field] = element.value;
                    }
                });
                
                // For size-locked products, add the static size and material
                if (currentProductType === 'windshields') {
                    rowData.size = selectedWindshieldsSize;
                    rowData.material = selectedWindshieldsMaterial;
                } else if (currentProductType === 'body-sides') {
                    rowData.size = selectedBodySidesSize;
                    rowData.material = selectedBodySidesMaterial;
                } else if (currentProductType === 'complements') {
                    rowData.size = selectedComplementsSize;
                    rowData.material = selectedComplementsMaterial;
                }
                
                // Check if we have required data
                const hasRequiredData = rowData.quantity && 
                    (rowData.message1 || rowData.mainline1 || rowData.vehicleType);
                
                if (hasRequiredData) {
                    multipleItemsData.push(rowData);
                }
            });
            
            // Clear saved modal data after successful apply
            sessionStorage.removeItem('modalDataAutoSave');
            sessionStorage.removeItem('modalProductType');
            modalDataAutoSave = [];
            
            closeModal();
            updateSummary();
        }
        
        function createSingleItemFromForm() {
            if (!currentProductType) {
                return null;
            }
            
            const singleItem = {
                quantity: '1'
            };
            
            if (currentProductType === 'windshields') {
                // Windshields fields
                singleItem.vehicleType = document.getElementById('vehicleType')?.value || '';
                singleItem.message1 = document.getElementById('message1')?.value || '';
                singleItem.message2 = document.getElementById('message2')?.value || '';
                singleItem.price = document.getElementById('price')?.value || '';
                singleItem.material = document.querySelector('input[name="windshieldMaterial"]:checked')?.value || '';
                singleItem.size = selectedWindshieldSize || '';
                
            } else if (currentProductType === 'body-sides') {
                // Body Sides fields
                singleItem.bodysideType = document.querySelector('input[name="bodySideType"]:checked')?.value || '';
                singleItem.mainline1 = document.getElementById('mainline1')?.value || '';
                singleItem.mainline2 = document.getElementById('mainline2')?.value || '';
                singleItem.misc = document.getElementById('misc')?.value || '';
                singleItem.material = document.querySelector('input[name="bodySideMaterial"]:checked')?.value || '';
                singleItem.size = selectedBodySidesSize || '';
                
            } else if (currentProductType === 'complements') {
                // Complements fields
                singleItem.complementType = document.querySelector('input[name="complementType"]:checked')?.value || '';
                singleItem.mainline1 = document.getElementById('complementMainline1')?.value || '';
                singleItem.mainline2 = document.getElementById('complementMainline2')?.value || '';
                singleItem.misc = document.getElementById('complementMisc')?.value || '';
                singleItem.material = document.querySelector('input[name="complementMaterial"]:checked')?.value || '';
                singleItem.size = selectedComplementsSize || '';
            }
            
            // Check if we have required data
            const hasRequiredData = singleItem.message1 || singleItem.mainline1 || singleItem.vehicleType;
            
            return hasRequiredData ? singleItem : null;
        }

        async function exportToCSV() {
            if (document.getElementById('multipleItemsModal').style.display === 'block') {
                applyMultipleItems();
            }
            
            // If no multiple items data, try to create from single form
            if (multipleItemsData.length === 0) {
                const singleItem = createSingleItemFromForm();
                if (singleItem) {
                    multipleItemsData = [singleItem];
                } else {
                    alert('Please enter data in the form fields or use "Enter Multiple Items" before exporting');
                    return;
                }
            }
            
            // Create CSV content - expand quantities into individual rows for VersaWorks
            let headers, expandedRows = [];
            
            if (currentProductType === 'windshields') {
                // Check if Flyout type to determine headers
                if (selectedWindshieldType === 'Flyout') {
                    // Flyout windshields use: Flyout, Mainline 1, Mainline 2, Misc
                    headers = ['Quantity', 'Windshield Type', 'Flyout', 'Mainline 1', 'Mainline 2', 'Misc', 'Material', 'Size'];
                    
                    multipleItemsData.forEach(row => {
                        const quantity = parseInt(row.quantity) || 1;
                        for (let i = 0; i < quantity; i++) {
                            expandedRows.push([
                                '1',
                                row.windshieldType || selectedWindshieldType || '',
                                row.flyout1 || '',
                                row.mainline1 || '',
                                row.mainline2 || '',
                                row.misc || '',
                                row.material || '',
                                selectedWindshieldsSize || row.size || '' // Use static windshield size
                            ].map(val => `"${val}"`).join(','));
                        }
                    });
                } else {
                    // Standard windshields use: Mainline 1, Mainline 2, Misc
                    headers = ['Quantity', 'Windshield Type', 'Mainline 1', 'Mainline 2', 'Misc', 'Material', 'Size'];
                    
                    multipleItemsData.forEach(row => {
                        const quantity = parseInt(row.quantity) || 1;
                        for (let i = 0; i < quantity; i++) {
                            expandedRows.push([
                                '1',
                                row.windshieldType || selectedWindshieldType || '',
                                row.mainline1 || '',
                                row.mainline2 || '',
                                row.misc || '',
                                row.material || '',
                                selectedWindshieldsSize || row.size || '' // Use static windshield size
                            ].map(val => `"${val}"`).join(','));
                        }
                    });
                }
            } else if (currentProductType === 'body-sides') {
                // Body sides-specific headers (fixed 3 text columns)
                headers = ['Quantity', 'Bodyside Type', 'Mainline 1', 'Mainline 2', 'Misc', 'Material', 'Size'];
                
                multipleItemsData.forEach(row => {
                    const quantity = parseInt(row.quantity) || 1;
                    for (let i = 0; i < quantity; i++) {
                        expandedRows.push([
                            '1',
                            row.bodysideType || '',
                            row.mainline1 || '',
                            row.mainline2 || '',
                            row.misc || '',
                            row.material || '',
                            selectedBodySidesSize || row.size || '' // Use static body sides size
                        ].map(val => `"${val}"`).join(','));
                    }
                });
            } else if (currentProductType === 'complements') {
                // Complements-specific headers (fixed 3 text columns)
                headers = ['Quantity', 'Complement Type', 'Mainline 1', 'Mainline 2', 'Misc', 'Material', 'Size'];
                
                multipleItemsData.forEach(row => {
                    const quantity = parseInt(row.quantity) || 1;
                    for (let i = 0; i < quantity; i++) {
                        expandedRows.push([
                            '1',
                            row.complementType || '',
                            row.mainline1 || '',
                            row.mainline2 || '',
                            row.misc || '',
                            row.material || '',
                            selectedComplementsSize || row.size || '' // Use static complements size
                        ].map(val => `"${val}"`).join(','));
                    }
                });
            } else {
                // Default headers for other product types
                headers = ['Quantity', 'Vehicle Type', 'Message Line 1', 'Message Line 2', 'Price', 'Color', 'Size'];
                
                multipleItemsData.forEach(row => {
                    const quantity = parseInt(row.quantity) || 1;
                    for (let i = 0; i < quantity; i++) {
                        expandedRows.push([
                            '1',
                            row.vehicleType || '',
                            row.message1 || '',
                            row.message2 || '',
                            row.price || '',
                            row.color || '',
                            row.size || ''
                        ].map(val => `"${val}"`).join(','));
                    }
                });
            }
            
            const csvContent = [headers.join(','), ...expandedRows].join('\n');
            
            // Generate filename with timestamp
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            const filename = `silver-fox-order-${timestamp}.csv`;
            
            // Download CSV locally
            const blob = new Blob([csvContent], { type: 'text/csv; charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
            
            // Upload to Google Drive if enabled
            if (document.getElementById('autoUploadToDrive').checked && isSignedIn) {
                try {
                    await uploadToDrive(csvContent, filename);
                    showNotification(`CSV exported and uploaded to Google Drive!`);
                } catch (error) {
                    showNotification('CSV downloaded locally but failed to upload to Drive', 'error');
                }
            } else {
                showNotification('CSV file exported successfully!');
            }
        }
        
        function exportAllToCSV() {
            if (multipleItemsData.length === 0) {
                alert('No multiple items data to export. Please use "Enter Multiple Items" button first.');
                return;
            }
            exportToCSV();
        }

        function updateSummary() {
            const summary = document.getElementById('summary-content');
            const warningElement = document.getElementById('character-limit-warning');
            let content = `<div style="font-family: monospace; line-height: 1.4; white-space: pre-wrap;"><strong>ORDER SUMMARY</strong><br>`;
            content += `<strong>Order Type:</strong> ${currentOrderType.replace('-', ' ').toUpperCase()}<br>`;
            
            if (currentProductType) {
                content += `<strong>Product Type:</strong> ${currentProductType.replace('-', ' ').toUpperCase()}<br>`;
            }
            
            content += `<strong>Date:</strong> ${new Date().toLocaleDateString()}<br>`;
            content += `<strong>Time:</strong> ${new Date().toLocaleTimeString()}<br><br>`;
            
            // Add form-specific details based on order type first, then product type
            if (currentOrderType === 'custom') {
                // Custom Special Products
                const installLocation = document.getElementById('csp_installLocation')?.value;
                const productType = document.getElementById('csp_productType')?.value;
                const materialType = document.getElementById('csp_materialType')?.value;
                const otherMaterial = document.getElementById('csp_otherMaterial')?.value;
                const sizeDetails = document.getElementById('csp_sizeDetails')?.value;
                const text = document.getElementById('csp_text')?.value;
                const designNotes = document.getElementById('csp_designNotes')?.value;
                
                content += `<strong>CUSTOM SPECIAL PRODUCTS DETAILS:</strong><br><br>`;
                if (installLocation) content += `<strong>Install Location:</strong> ${installLocation}<br>`;
                if (productType) content += `<strong>Product Type:</strong> ${productType}<br>`;
                if (materialType) content += `<strong>Material Type:</strong> ${materialType}<br>`;
                if (materialType === 'Other' && otherMaterial) content += `<strong>Other Material:</strong> ${otherMaterial}<br>`;
                if (sizeDetails) content += `<strong>Size Details:</strong> ${sizeDetails}<br>`;
                if (text) content += `<strong>Text:</strong> ${text}<br>`;
                if (designNotes) content += `<strong>Design Notes:</strong> ${designNotes}<br>`;
                
            } else if (currentOrderType === 'dealership') {
                // Dealership Merchandising
                const installLocation = document.getElementById('dm_installLocation')?.value;
                const productType = document.getElementById('dm_productType')?.value;

                content += `<strong>DEALERSHIP MERCHANDISING DETAILS:</strong><br><br>`;
                if (installLocation) content += `<strong>Install Location:</strong> ${installLocation}<br>`;
                if (productType) content += `<strong>Product Type:</strong> ${productType}<br>`;
                
                // Add dealership-specific product details based on product type
                if (productType === 'Custom Designed Interior Showroom Graphics') {
                    const surfaceType = document.getElementById('dm_isg_surfaceType')?.value;
                    const customSurface = document.getElementById('dm_isg_customSurface')?.value;
                    const materialType = document.getElementById('dm_isg_materialType')?.value;
                    const maxWidth = document.getElementById('dm_isg_maxWidth')?.value;
                    const maxHeight = document.getElementById('dm_isg_maxHeight')?.value;
                    const graphicWidth = document.getElementById('dm_isg_graphicWidth')?.value;
                    const graphicHeight = document.getElementById('dm_isg_graphicHeight')?.value;
                    const text = document.getElementById('dm_isg_text')?.value;
                    const designDetails = document.getElementById('dm_isg_designDetails')?.value;
                    
                    if (surfaceType) content += `<strong>Surface Type:</strong> ${surfaceType}<br>`;
                    if (customSurface) content += `<strong>Custom Surface Type:</strong> ${customSurface}<br>`;
                    if (materialType) content += `<strong>Material Type:</strong> ${materialType}<br>`;
                    if (maxWidth) content += `<strong>Max Width:</strong> ${maxWidth}<br>`;
                    if (maxHeight) content += `<strong>Max Height:</strong> ${maxHeight}<br>`;
                    if (graphicWidth) content += `<strong>Graphic Width:</strong> ${graphicWidth}<br>`;
                    if (graphicHeight) content += `<strong>Graphic Height:</strong> ${graphicHeight}<br>`;
                    if (text) content += `<strong>Text:</strong> ${text}<br>`;
                    if (designDetails) content += `<strong>Design/Layout Details:</strong> ${designDetails}<br>`;
                    
                } else if (productType === 'Custom Designed Showroom Graphics') {
                    const materialType = document.getElementById('dm_sg_materialType')?.value;
                    const addLamination = document.querySelector('input[name="dm_sg_addLamination"]:checked')?.value;
                    const windowType = document.getElementById('dm_sg_windowType')?.value;
                    const totalWindows = document.getElementById('dm_sg_totalWindows')?.value;
                    const mullions = document.querySelector('input[name="dm_sg_mullions"]:checked')?.value;
                    const mullionWidth = document.getElementById('dm_sg_mullionWidth')?.value;
                    const sizeDetails = document.getElementById('dm_sg_sizeDetails')?.value;
                    const text = document.getElementById('dm_sg_text')?.value;
                    const designDetails = document.getElementById('dm_sg_designDetails')?.value;

                    if (materialType) content += `<strong>Material Type:</strong> ${materialType}<br>`;
                    if (addLamination) content += `<strong>Add Lamination:</strong> ${addLamination}<br>`;
                    if (windowType) content += `<strong>Window Type:</strong> ${windowType}<br>`;
                    if (totalWindows) content += `<strong>Total Number of Windows:</strong> ${totalWindows}<br>`;
                    if (mullions) content += `<strong>Mullions:</strong> ${mullions}<br>`;
                    if (mullionWidth) content += `<strong>Mullion Width:</strong> ${mullionWidth}<br>`;
                    if (sizeDetails) content += `<strong>Size Details:</strong> ${sizeDetails}<br>`;
                    if (text) content += `<strong>Text:</strong> ${text}<br>`;
                    if (designDetails) content += `<strong>Design Details:</strong> ${designDetails}<br>`;
                }
                
            } else if (currentOrderType === 'template') {
                // New Template Request
                const requestType = document.getElementById('ntr_requestType')?.value;
                
                content += `<strong>NEW TEMPLATE REQUEST DETAILS:</strong><br><br>`;
                if (requestType) content += `<strong>Request Type:</strong> ${requestType}<br>`;
                
                // Add template-specific details based on request type
                if (requestType === 'New Standard Graphic') {
                    const templateName = document.getElementById('ntr_nsg_templateName')?.value;
                    const details = document.getElementById('ntr_nsg_details')?.value;
                    
                    if (templateName) content += `<strong>Template Name:</strong> ${templateName}<br>`;
                    if (details) content += `<strong>Details:</strong> ${details}<br>`;
                    
                } else if (requestType === 'ShortCut Template') {
                    const templateName = document.getElementById('ntr_sct_templateName')?.value;
                    const orderType = document.querySelector('input[name="ntr_sct_orderType"]:checked')?.value;
                    const newCarCoverage = document.querySelector('input[name="ntr_sct_newCarCoverage"]:checked')?.value;
                    const usedCarCoverage = document.querySelector('input[name="ntr_sct_usedCarCoverage"]:checked')?.value;
                    const orderEntryMethod = document.querySelector('input[name="ntr_sct_orderEntryMethod"]:checked')?.value;
                    const startupOrder = document.querySelector('input[name="ntr_sct_startupOrder"]:checked')?.value;
                    const desiredShape = document.querySelector('input[name="ntr_sct_desiredShape"]:checked')?.value;
                    const details = document.getElementById('ntr_sct_details')?.value;
                    
                    if (templateName) content += `<strong>Template Name:</strong> ${templateName}<br>`;
                    if (orderType) content += `<strong>SCP Order Type:</strong> ${orderType}<br>`;
                    if (newCarCoverage) content += `<strong>New Car Coverage:</strong> ${newCarCoverage}<br>`;
                    if (usedCarCoverage) content += `<strong>Used Car Coverage:</strong> ${usedCarCoverage}<br>`;
                    if (orderEntryMethod) content += `<strong>Order Entry Method:</strong> ${orderEntryMethod}<br>`;
                    if (startupOrder) content += `<strong>Startup Order:</strong> ${startupOrder}<br>`;
                    if (desiredShape) content += `<strong>Desired Shape:</strong> ${desiredShape}<br>`;
                    if (details) content += `<strong>Details:</strong> ${details}<br>`;
                    
                } else if (requestType === 'Flyout Template') {
                    const templateName = document.getElementById('ntr_ft_templateName')?.value;
                    const details = document.getElementById('ntr_ft_details')?.value;
                    
                    if (templateName) content += `<strong>Template Name:</strong> ${templateName}<br>`;
                    if (details) content += `<strong>Details:</strong> ${details}<br>`;
                }
                
            } else if (currentOrderType === 'business-cards') {
                // Business Cards
                const singleOrDouble = document.getElementById('bc_singleOrDouble')?.value;
                const quantity = document.getElementById('bc_quantity')?.value;
                const text = document.getElementById('bc_text')?.value;
                const description = document.getElementById('bc_description')?.value;
                
                content += `<strong>BUSINESS CARDS DETAILS:</strong><br><br>`;
                if (singleOrDouble) content += `<strong>Single or Double Sided:</strong> ${singleOrDouble}<br>`;
                if (quantity) content += `<strong>Quantity:</strong> ${quantity}<br>`;
                if (text) content += `<strong>Text:</strong> ${text}<br>`;
                if (description) content += `<strong>Description:</strong> ${description}<br>`;
                
            } else if (currentOrderType === 'banners') {
                // Custom Banners
                const bannerType = document.getElementById('cb_bannerType')?.value;
                
                content += `<strong>CUSTOM BANNERS DETAILS:</strong><br><br>`;
                if (bannerType) content += `<strong>Banner Type:</strong> ${bannerType}<br>`;
                
                // Add banner-specific details based on banner type
                if (bannerType === 'Standard Banner') {
                    const materialType = document.getElementById('cb_sb_materialType')?.value;
                    const width = document.getElementById('cb_sb_width')?.value;
                    const height = document.getElementById('cb_sb_height')?.value;
                    const text = document.getElementById('cb_sb_text')?.value;
                    const designNotes = document.getElementById('cb_sb_designNotes')?.value;
                    const finishing = document.getElementById('cb_sb_finishing')?.value;
                    const customFinishing = document.getElementById('cb_sb_customFinishing')?.value;
                    const powerTape = document.querySelector('input[name="cb_sb_powerTape"]:checked')?.value;
                    const bravoTabs = document.querySelector('input[name="cb_sb_bravoTabs"]:checked')?.value;
                    const grommets = document.querySelector('input[name="cb_sb_grommets"]:checked')?.value;
                    const grommetPattern = document.getElementById('cb_sb_grommetPattern')?.value;
                    const customGrommet = document.getElementById('cb_sb_customGrommet')?.value;
                    
                    if (materialType) content += `<strong>Material Type:</strong> ${materialType}<br>`;
                    if (width) content += `<strong>Width:</strong> ${width}<br>`;
                    if (height) content += `<strong>Height:</strong> ${height}<br>`;
                    if (text) content += `<strong>Text:</strong> ${text}<br>`;
                    if (designNotes) content += `<strong>Design Notes:</strong> ${designNotes}<br>`;
                    if (finishing) content += `<strong>Finishing:</strong> ${finishing}<br>`;
                    if (customFinishing) content += `<strong>Custom Finishing:</strong> ${customFinishing}<br>`;
                    if (powerTape) content += `<strong>Power Tape:</strong> ${powerTape}<br>`;
                    if (bravoTabs) content += `<strong>Bravo Tabs:</strong> ${bravoTabs}<br>`;
                    if (grommets) content += `<strong>Grommets:</strong> ${grommets}<br>`;
                    if (grommetPattern) content += `<strong>Grommet Pattern:</strong> ${grommetPattern}<br>`;
                    if (customGrommet) content += `<strong>Custom Grommet Pattern:</strong> ${customGrommet}<br>`;
                } else if (bannerType === 'Pole Banner') {
                    // Pole Banner fields are handled separately - add if needed
                    const size = document.getElementById('cb_pb_size')?.value;
                    const materialType = document.getElementById('cb_pb_materialType')?.value;
                    const pocketSize = document.getElementById('cb_pb_pocketSize')?.value;
                    const customPocket = document.getElementById('cb_pb_customPocket')?.value;
                    const side1Design = document.getElementById('cb_pb_side1Design')?.value;
                    const side2Design = document.getElementById('cb_pb_side2Design')?.value;
                    
                    if (size) content += `<strong>Size:</strong> ${size}<br>`;
                    if (materialType) content += `<strong>Material Type:</strong> ${materialType}<br>`;
                    if (pocketSize) content += `<strong>Pocket Size:</strong> ${pocketSize}<br>`;
                    if (customPocket) content += `<strong>Custom Pocket Size:</strong> ${customPocket}<br>`;
                    if (side1Design) content += `<strong>Side 1 Design/Layout Details:</strong> ${side1Design}<br>`;
                    if (side2Design) content += `<strong>Side 2 Design/Layout Details:</strong> ${side2Design}<br>`;
                }
            }
            
            // Add form-specific details based on product type (for Vehicle Merchandising)
            if (currentProductType === 'body-sides') {
                // Body Sides specific fields (simplified - fixed 3 columns)
                const bodysideType = document.getElementById('bs_bodysideType')?.value;
                const mainline1 = document.getElementById('bs_mainline1')?.value;
                const mainline2 = document.getElementById('bs_mainline2')?.value;
                const misc = document.getElementById('bs_misc')?.value;
                const size = selectedBodySidesSize || document.getElementById('body_sides_size')?.value;
                const material = document.getElementById('body_sides_material')?.value;
                
                content += `<strong>BODY SIDES DETAILS:</strong><br><br>`;
                if (bodysideType) content += `<strong>Bodyside Type:</strong> ${bodysideType}<br>`;
                if (mainline1) content += `<strong>Mainline 1:</strong> ${mainline1}<br>`;
                if (mainline2) content += `<strong>Mainline 2:</strong> ${mainline2}<br>`;
                if (misc) content += `<strong>Misc:</strong> ${misc}<br>`;
                if (size) content += `<strong>Size:</strong> ${size}<br>`;
                if (material) content += `<strong>Material:</strong> ${material}<br>`;
                
            } else if (currentProductType === 'windshields') {
                // New Windshields specific fields with nested conditional logic
                const windshieldType = document.getElementById('ws_windshieldType')?.value;
                const size = selectedWindshieldsSize || document.getElementById('windshields_size')?.value;
                const material = document.getElementById('windshields_material')?.value;
                
                content += `<strong>WINDSHIELDS DETAILS:</strong><br><br>`;
                if (windshieldType) content += `<strong>Windshield Type:</strong> ${windshieldType}<br>`;
                
                // Check if Flyout type is selected
                if (windshieldType === 'Flyout') {
                    // Display Flyout fields (Flyout, Mainline 1, Mainline 2, Misc)
                    const flyout1 = document.getElementById('ws_flyout1')?.value;
                    const flyoutMainline1 = document.getElementById('ws_flyout_mainline1')?.value;
                    const flyoutMainline2 = document.getElementById('ws_flyout_mainline2')?.value;
                    const flyoutMisc = document.getElementById('ws_flyout_misc')?.value;
                    
                    if (flyout1) content += `<strong>Flyout:</strong> ${flyout1}<br>`;
                    if (flyoutMainline1) content += `<strong>Mainline 1:</strong> ${flyoutMainline1}<br>`;
                    if (flyoutMainline2) content += `<strong>Mainline 2:</strong> ${flyoutMainline2}<br>`;
                    if (flyoutMisc) content += `<strong>Misc:</strong> ${flyoutMisc}<br>`;
                } else {
                    // Display standard fields
                    const mainline1 = document.getElementById('ws_mainline1')?.value;
                    const mainline2 = document.getElementById('ws_mainline2')?.value;
                    const misc = document.getElementById('ws_misc')?.value;
                    
                    if (mainline1) content += `<strong>Mainline 1:</strong> ${mainline1}<br>`;
                    if (mainline2) content += `<strong>Mainline 2:</strong> ${mainline2}<br>`;
                    if (misc) content += `<strong>Misc:</strong> ${misc}<br>`;
                }
                
                if (size) content += `<strong>Size:</strong> ${size}<br>`;
                if (material) content += `<strong>Material:</strong> ${material}<br>`;
                
            } else if (currentProductType === 'complements') {
                // Complements specific fields (simplified - fixed 3 columns)
                const complementType = document.getElementById('comp_complementType')?.value;
                const mainline1 = document.getElementById('comp_mainline1')?.value;
                const mainline2 = document.getElementById('comp_mainline2')?.value;
                const misc = document.getElementById('comp_misc')?.value;
                const size = selectedComplementsSize || document.getElementById('complements_size')?.value;
                const material = document.getElementById('complements_material')?.value;
                
                content += `<strong>COMPLEMENTS DETAILS:</strong><br><br>`;
                if (complementType) content += `<strong>Complement Type:</strong> ${complementType}<br>`;
                if (mainline1) content += `<strong>Mainline 1:</strong> ${mainline1}<br>`;
                if (mainline2) content += `<strong>Mainline 2:</strong> ${mainline2}<br>`;
                if (misc) content += `<strong>Misc:</strong> ${misc}<br>`;
                if (size) content += `<strong>Size:</strong> ${size}<br>`;
                if (material) content += `<strong>Material:</strong> ${material}<br>`;
                
            } else if (currentProductType === 'Windshield Banners') {
                // Windshield Banners specific fields
                const productSize = document.getElementById('vm_wb_productSize')?.value;
                const materialType = document.getElementById('vm_wb_materialType')?.value;
                const text = document.getElementById('vm_wb_text')?.value;
                const designDetails = document.getElementById('vm_wb_designDetails')?.value;
                
                content += `<strong>WINDSHIELD BANNERS DETAILS:</strong><br><br>`;
                if (productSize) content += `<strong>Product Size:</strong> ${productSize}<br>`;
                if (materialType) content += `<strong>Material Type:</strong> ${materialType}<br>`;
                if (text) content += `<strong>Text:</strong> ${text}<br>`;
                if (designDetails) content += `<strong>Design/Layout Details:</strong> ${designDetails}<br>`;
                
            } else if (currentProductType === 'Side Banners') {
                // Side Banners specific fields
                const productSize = document.getElementById('vm_sb_productSize')?.value;
                const materialType = document.getElementById('vm_sb_materialType')?.value;
                const text = document.getElementById('vm_sb_text')?.value;
                const designDetails = document.getElementById('vm_sb_designDetails')?.value;
                
                content += `<strong>SIDE BANNERS DETAILS:</strong><br><br>`;
                if (productSize) content += `<strong>Product Size:</strong> ${productSize}<br>`;
                if (materialType) content += `<strong>Material Type:</strong> ${materialType}<br>`;
                if (text) content += `<strong>Text:</strong> ${text}<br>`;
                if (designDetails) content += `<strong>Design/Layout Details:</strong> ${designDetails}<br>`;
                
            } else if (currentProductType === 'Complement Graphics') {
                // Complement Graphics specific fields
                const productSize = document.getElementById('vm_cg_productSize')?.value;
                const materialType = document.getElementById('vm_cg_materialType')?.value;
                const text = document.getElementById('vm_cg_text')?.value;
                const designDetails = document.getElementById('vm_cg_designDetails')?.value;
                
                content += `<strong>COMPLEMENT GRAPHICS DETAILS:</strong><br><br>`;
                if (productSize) content += `<strong>Product Size:</strong> ${productSize}<br>`;
                if (materialType) content += `<strong>Material Type:</strong> ${materialType}<br>`;
                if (text) content += `<strong>Text:</strong> ${text}<br>`;
                if (designDetails) content += `<strong>Design/Layout Details:</strong> ${designDetails}<br>`;
                
            } else if (currentProductType === 'Specially Sized Graphics') {
                // Specially Sized Graphics specific fields
                const sizeDetails = document.getElementById('vm_ssg_sizeDetails')?.value;
                const materialType = document.getElementById('vm_ssg_materialType')?.value;
                const text = document.getElementById('vm_ssg_text')?.value;
                const designDetails = document.getElementById('vm_ssg_designDetails')?.value;
                
                content += `<strong>SPECIALLY SIZED GRAPHICS DETAILS:</strong><br><br>`;
                if (sizeDetails) content += `<strong>Size Details:</strong> ${sizeDetails}<br>`;
                if (materialType) content += `<strong>Material Type:</strong> ${materialType}<br>`;
                if (text) content += `<strong>Text:</strong> ${text}<br>`;
                if (designDetails) content += `<strong>Design/Layout Details:</strong> ${designDetails}<br>`;
            }
            
            // Add multiple items data if present
            if (multipleItemsData.length > 0) {
                    content += `<strong>MULTIPLE ITEMS (${multipleItemsData.length} entries):</strong><br><br>`;
                multipleItemsData.forEach((item, index) => {
                    content += `<strong>Item ${index + 1}:</strong><br>`;
                    content += `  <strong>Quantity:</strong> ${item.quantity}<br>`;
                    
                    if (currentProductType === 'body-sides') {
                        // Body Sides specific item display (simplified - fixed 3 columns)
                        if (item.bodysideType) content += `  <strong>Bodyside Type:</strong> ${item.bodysideType}<br>`;
                        if (item.mainline1) content += `  <strong>Mainline 1:</strong> ${item.mainline1}<br>`;
                        if (item.mainline2) content += `  <strong>Mainline 2:</strong> ${item.mainline2}<br>`;
                        if (item.misc) content += `  <strong>Misc:</strong> ${item.misc}<br>`;
                        if (item.material) content += `  <strong>Material:</strong> ${item.material}<br>`;
                        if (item.size) content += `  <strong>Size:</strong> ${item.size}<br>`;
                    } else if (currentProductType === 'complements') {
                        // Complements specific item display (simplified - fixed 3 columns)
                        if (item.complementType) content += `  <strong>Complement Type:</strong> ${item.complementType}<br>`;
                        if (item.mainline1) content += `  <strong>Mainline 1:</strong> ${item.mainline1}<br>`;
                        if (item.mainline2) content += `  <strong>Mainline 2:</strong> ${item.mainline2}<br>`;
                        if (item.misc) content += `  <strong>Misc:</strong> ${item.misc}<br>`;
                        if (item.material) content += `  <strong>Material:</strong> ${item.material}<br>`;
                        if (item.size) content += `  <strong>Size:</strong> ${item.size}<br>`;
                    } else if (currentProductType === 'windshields') {
                        // New Windshields specific item display (fixed 3 columns)
                        if (item.windshieldType) content += `  <strong>Windshield Type:</strong> ${item.windshieldType}<br>`;
                        if (item.mainline1) content += `  <strong>Mainline 1:</strong> ${item.mainline1}<br>`;
                        if (item.mainline2) content += `  <strong>Mainline 2:</strong> ${item.mainline2}<br>`;
                        if (item.misc) content += `  <strong>Misc:</strong> ${item.misc}<br>`;
                        if (item.material) content += `  <strong>Material:</strong> ${item.material}<br>`;
                        if (item.size) content += `  <strong>Size:</strong> ${item.size}<br>`;
                    } else {
                        // Default item display
                        if (item.vehicleType) content += `  <strong>Vehicle Type:</strong> ${item.vehicleType}<br>`;
                        if (item.message1) content += `  <strong>Message 1:</strong> ${item.message1}<br>`;
                        if (item.message2) content += `  <strong>Message 2:</strong> ${item.message2}<br>`;
                        if (item.price) content += `  <strong>Price:</strong> ${item.price}<br>`;
                        if (item.color) content += `  <strong>Color:</strong> ${item.color}<br>`;
                        if (item.size) content += `  <strong>Size:</strong> ${item.size}<br>`;
                    }
                    content += `<br>`;
                });
            }
            
            content += `</div>`; // Close the main div
            summary.innerHTML = content;
            
            // Force the container to recalculate its height with timeout for DOM update
            setTimeout(() => {
                summary.style.height = 'auto';
                summary.style.maxHeight = 'none';
                
                // Wait for text to render, then calculate actual height needed
                requestAnimationFrame(() => {
                    const actualHeight = summary.scrollHeight;
                    
                    // Set minimum height to accommodate content
                    summary.style.minHeight = Math.max(300, actualHeight) + 'px';
                    
                    // Also ensure the parent section expands
                    const summarySection = document.querySelector('.summary-section');
                    if (summarySection) {
                        summarySection.style.height = 'auto';
                        summarySection.style.minHeight = 'auto';
                        summarySection.style.overflow = 'visible';
                    }
                    
                    // Ensure main content container expands
                    const mainContent = document.querySelector('.main-content');
                    if (mainContent) {
                        mainContent.style.height = 'auto';
                        mainContent.style.minHeight = Math.max(600, actualHeight + 200) + 'px';
                    }
                    
                    // Ensure the container div also expands
                    const container = document.querySelector('.container');
                    if (container) {
                        container.style.height = 'auto';
                        container.style.minHeight = 'auto';
                    }
                });
            }, 10);
            
            // Check character limit (2,000 characters)
            const characterCount = content.length;
            if (characterCount > 2000) {
                summary.classList.add('character-limit-exceeded');
                warningElement.style.display = 'block';
            } else {
                summary.classList.remove('character-limit-exceeded');
                warningElement.style.display = 'none';
            }
            
            // Manage left column scrollbar based on height comparison
            manageColumnScrollbars();
            
            // Update progress bar
            updateProgressBar();
        }
        
        function updateProgressBar() {
            const progressBar = document.querySelector('.summary-header::after');
            const summaryHeader = document.querySelector('.summary-header');
            
            if (!summaryHeader) return;
            
            let totalFields = 0;
            let filledFields = 0;
            
            // Count basic order type selection
            if (currentOrderType) {
                totalFields++;
                filledFields++;
            } else {
                totalFields++;
            }
            
            // Count product type selection for vehicle merchandising
            if (currentOrderType === 'vehicle') {
                totalFields++;
                if (currentProductType) {
                    filledFields++;
                }
                
                // Count specific product type fields
                if (currentProductType === 'windshields') {
                    const windshieldType = document.getElementById('ws_windshieldType')?.value || '';
                    const size = document.getElementById('windshields_size')?.value || '';
                    const material = document.getElementById('windshields_material')?.value || '';
                    
                    if (windshieldType === 'Flyout') {
                        // Flyout has Flyout + Mainline 1 + Mainline 2 + Misc + size + material
                        const flyout1 = document.getElementById('ws_flyout1')?.value || '';
                        const flyoutMainline1 = document.getElementById('ws_flyout_mainline1')?.value || '';
                        const flyoutMainline2 = document.getElementById('ws_flyout_mainline2')?.value || '';
                        const flyoutMisc = document.getElementById('ws_flyout_misc')?.value || '';
                        
                        totalFields += 7; // Type, Flyout, Mainline 1, Mainline 2, Misc, Size, Material
                        if (windshieldType) filledFields++;
                        if (flyout1) filledFields++;
                        if (flyoutMainline1) filledFields++;
                        if (flyoutMainline2) filledFields++;
                        if (flyoutMisc) filledFields++;
                        if (size) filledFields++;
                        if (material) filledFields++;
                    } else {
                        // Standard has Mainline1, Mainline2, Misc + size + material
                        const mainline1 = document.getElementById('ws_mainline1')?.value || '';
                        const mainline2 = document.getElementById('ws_mainline2')?.value || '';
                        const misc = document.getElementById('ws_misc')?.value || '';
                        
                        totalFields += 6; // Type, Mainline1, Mainline2, Misc, Size, Material
                        if (windshieldType) filledFields++;
                        if (mainline1) filledFields++;
                        if (mainline2) filledFields++;
                        if (misc) filledFields++;
                        if (size) filledFields++;
                        if (material) filledFields++;
                    }
                    
                } else if (currentProductType === 'body-sides') {
                    // Bodyside Type, Mainline1, Mainline2, Size, Material
                    const bodysideType = document.getElementById('bs_bodysideType')?.value || '';
                    const mainline1 = document.getElementById('bs_mainline1')?.value || '';
                    const mainline2 = document.getElementById('bs_mainline2')?.value || '';
                    const size = document.getElementById('body_sides_size')?.value || '';
                    const material = document.getElementById('body_sides_material')?.value || '';
                    
                    totalFields += 5;
                    if (bodysideType) filledFields++;
                    if (mainline1) filledFields++;
                    if (mainline2) filledFields++;
                    if (size) filledFields++;
                    if (material) filledFields++;
                    
                } else if (currentProductType === 'complements') {
                    // Complement Type, Mainline1, Mainline2, Size, Material
                    const complementType = document.getElementById('comp_complementType')?.value || '';
                    const mainline1 = document.getElementById('comp_mainline1')?.value || '';
                    const mainline2 = document.getElementById('comp_mainline2')?.value || '';
                    const size = document.getElementById('complements_size')?.value || '';
                    const material = document.getElementById('complements_material')?.value || '';
                    
                    totalFields += 5;
                    if (complementType) filledFields++;
                    if (mainline1) filledFields++;
                    if (mainline2) filledFields++;
                    if (size) filledFields++;
                    if (material) filledFields++;
                    
                } else if (currentProductType === 'Windshield Banners') {
                    // Product Size, Material Type, Text
                    const productSize = document.getElementById('vm_wb_productSize')?.value || '';
                    const materialType = document.getElementById('vm_wb_materialType')?.value || '';
                    const text = document.getElementById('vm_wb_text')?.value || '';
                    
                    totalFields += 3;
                    if (productSize) filledFields++;
                    if (materialType) filledFields++;
                    if (text) filledFields++;
                    
                } else if (currentProductType === 'Side Banners') {
                    // Product Size, Material Type, Text
                    const productSize = document.getElementById('vm_sb_productSize')?.value || '';
                    const materialType = document.getElementById('vm_sb_materialType')?.value || '';
                    const text = document.getElementById('vm_sb_text')?.value || '';
                    
                    totalFields += 3;
                    if (productSize) filledFields++;
                    if (materialType) filledFields++;
                    if (text) filledFields++;
                    
                } else if (currentProductType === 'Complement Graphics') {
                    // Product Size, Material Type, Text
                    const productSize = document.getElementById('vm_cg_productSize')?.value || '';
                    const materialType = document.getElementById('vm_cg_materialType')?.value || '';
                    const text = document.getElementById('vm_cg_text')?.value || '';
                    
                    totalFields += 3;
                    if (productSize) filledFields++;
                    if (materialType) filledFields++;
                    if (text) filledFields++;
                    
                } else if (currentProductType === 'Specially Sized Graphics') {
                    // Custom Size, Material Type, Text
                    const customSize = document.getElementById('vm_ssg_customSize')?.value || '';
                    const materialType = document.getElementById('vm_ssg_materialType')?.value || '';
                    const text = document.getElementById('vm_ssg_text')?.value || '';
                    
                    totalFields += 3;
                    if (customSize) filledFields++;
                    if (materialType) filledFields++;
                    if (text) filledFields++;
                }
            } else if (currentOrderType === 'dealership') {
                // Dealership Merchandising - typically has basic description fields
                const description = document.getElementById('dm_description')?.value || '';
                const specifications = document.getElementById('dm_specifications')?.value || '';
                
                totalFields += 2;
                if (description) filledFields++;
                if (specifications) filledFields++;
                
            } else if (currentOrderType === 'custom') {
                // Custom Special Products - typically has description and specifications
                const productDescription = document.getElementById('csp_productDescription')?.value || '';
                const specifications = document.getElementById('csp_specifications')?.value || '';
                const specialRequirements = document.getElementById('csp_specialRequirements')?.value || '';
                
                totalFields += 3;
                if (productDescription) filledFields++;
                if (specifications) filledFields++;
                if (specialRequirements) filledFields++;
                
            } else if (currentOrderType === 'template') {
                // New Template Request - has template details
                const templateName = document.getElementById('ntr_templateName')?.value || '';
                const description = document.getElementById('ntr_description')?.value || '';
                const specifications = document.getElementById('ntr_specifications')?.value || '';
                
                totalFields += 3;
                if (templateName) filledFields++;
                if (description) filledFields++;
                if (specifications) filledFields++;
                
            } else if (currentOrderType === 'business-cards') {
                // Business Cards - has 4 fields
                const singleOrDouble = document.getElementById('bc_singleOrDouble')?.value || '';
                const quantity = document.getElementById('bc_quantity')?.value || '';
                const text = document.getElementById('bc_text')?.value || '';
                const description = document.getElementById('bc_description')?.value || '';
                
                totalFields += 4;
                if (singleOrDouble) filledFields++;
                if (quantity) filledFields++;
                if (text) filledFields++;
                if (description) filledFields++;
                
            } else if (currentOrderType === 'banners') {
                // Custom Banners - has size, material, and text
                const bannerSize = document.getElementById('cb_bannerSize')?.value || '';
                const material = document.getElementById('cb_material')?.value || '';
                const text = document.getElementById('cb_text')?.value || '';
                
                totalFields += 3;
                if (bannerSize) filledFields++;
                if (material) filledFields++;
                if (text) filledFields++;
            }
            
            // Calculate progress percentage
            const progressPercentage = totalFields > 0 ? Math.round((filledFields / totalFields) * 100) : 0;
            
            // Update progress bar width using CSS custom property
            summaryHeader.style.setProperty('--progress-width', progressPercentage + '%');
        }
        
        function manageColumnScrollbars() {
            // Function removed - no longer needed since we're not managing scrollbars
            // Both columns now expand naturally with content
        }
        
        // Handle window resize events
        window.addEventListener('resize', () => {
            manageColumnScrollbars();
        });

        function copyToClipboard() {
            const summaryElement = document.getElementById('summary-content');
            
            // Create a blob with HTML content
            const htmlContent = summaryElement.innerHTML;
            
            // Use the modern Clipboard API to copy both plain text and HTML
            if (navigator.clipboard && window.ClipboardItem) {
                // Create both HTML and plain text versions
                const textContent = summaryElement.textContent;
                
                const htmlBlob = new Blob([htmlContent], { type: 'text/html' });
                const textBlob = new Blob([textContent], { type: 'text/plain' });
                
                const clipboardItem = new ClipboardItem({
                    'text/html': htmlBlob,
                    'text/plain': textBlob
                });
                
                navigator.clipboard.write([clipboardItem]).then(() => {
                    showNotification('Order summary copied to clipboard with formatting!');
                }).catch(err => {
                    // Fallback to copying just HTML if ClipboardItem fails
                    fallbackCopyToClipboard(summaryElement);
                });
            } else {
                // Fallback for browsers that don't support ClipboardItem
                fallbackCopyToClipboard(summaryElement);
            }
        }
        
        function fallbackCopyToClipboard(element) {
            // Create a temporary element to select and copy
            const selection = window.getSelection();
            const range = document.createRange();
            
            // Select the content
            range.selectNodeContents(element);
            selection.removeAllRanges();
            selection.addRange(range);
            
            try {
                // Execute the copy command
                document.execCommand('copy');
                showNotification('Order summary copied to clipboard!');
            } catch (err) {
                console.error('Failed to copy:', err);
                showNotification('Failed to copy to clipboard', 'error');
            } finally {
                // Clear the selection
                selection.removeAllRanges();
            }
        }

        function clearForm() {
            // Check if form has data worth saving
            if (!isFormEmpty()) {
                // Show save before clear dialog
                const dialog = document.getElementById('saveBeforeClearDialog');
                if (dialog) {
                    dialog.style.display = 'block';
                    return;
                }
            }
            // If form is empty, just clear directly
            performClearForm();
        }

        function closeSaveBeforeClearDialog() {
            const dialog = document.getElementById('saveBeforeClearDialog');
            if (dialog) {
                dialog.style.display = 'none';
            }
        }

        function saveAndClear() {
            if (saveOrderToHistory()) {
                showNotification('Order saved to history', 'success');
            }
            closeSaveBeforeClearDialog();
            performClearForm();
        }

        function clearWithoutSaving() {
            closeSaveBeforeClearDialog();
            performClearForm();
        }

        function performClearForm() {
            document.getElementById('order-details').innerHTML = '';
            document.getElementById('order-details').classList.add('hidden');
            document.getElementById('summary-content').textContent = 'Order details will appear here as you fill out the form...';
            document.getElementById('orderTypeSelect').value = '';
            currentOrderType = '';
            currentProductType = '';
            multipleItemsData = [];
            selectedWindshieldSize = '';
            selectedWindshieldsSize = '';
            selectedBodySidesSize = '';
            selectedComplementsSize = '';
            selectedWindshieldType = '';
            selectedBodySideType = '';
            selectedComplementType = '';
            localStorage.removeItem('orderDraft');

            // Clear cached form data
            localStorage.removeItem(CACHE_KEY);

            // Clear auto-save indicator
            const indicator = document.getElementById('autoSaveIndicator');
            if (indicator) {
                indicator.remove();
            }

            showNotification('Form cleared successfully', 'info');
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type === 'error' ? 'error' : ''}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // Initialize Google API on load
        window.addEventListener('load', () => {
            // Load Google API
            const script = document.createElement('script');
            script.src = 'https://apis.google.com/js/api.js';
            script.onload = gapiLoaded;
            document.body.appendChild(script);
            
            // Initialize GIS
            gisLoaded();
        });

        // Keyboard shortcuts and navigation for multiple items modal
        function keyboardShortcutsHandler(e) {
            const modal = document.getElementById('multipleItemsModal');
            // Only handle shortcuts when modal is visible
            if (modal.style.display !== 'block') return;

            const activeElement = document.activeElement;
            const isInTable = activeElement.closest('#spreadsheetTable');

            if (!isInTable) return;

            switch(e.key) {
                case 'Enter':
                    if (e.ctrlKey) {
                        // Ctrl+Enter: Apply and close modal
                        applyMultipleItems();
                    } else if (e.shiftKey) {
                        // Shift+Enter: Move to previous row
                        navigateToRow(activeElement, -1);
                    } else {
                        // Enter: Move to next row (create new if at bottom)
                        navigateToRow(activeElement, 1);
                    }
                    e.preventDefault();
                    break;

                case 'Tab':
                    if (e.shiftKey) {
                        // Shift+Tab: Move to previous cell
                        navigateToCell(activeElement, -1);
                    } else {
                        // Tab: Move to next cell
                        navigateToCell(activeElement, 1);
                    }
                    e.preventDefault();
                    break;

                case 'Delete':
                case 'Backspace':
                    if (e.ctrlKey) {
                        // Ctrl+Delete: Delete current row
                        deleteCurrentRow(activeElement);
                        e.preventDefault();
                    }
                    break;

                case 'd':
                    if (e.ctrlKey) {
                        // Ctrl+D: Duplicate current row
                        duplicateCurrentRow(activeElement);
                        e.preventDefault();
                    }
                    break;

                case 'Escape':
                    // Escape: Close modal
                    closeModal();
                    e.preventDefault();
                    break;
            }
        }

        function setupKeyboardShortcuts() {
            const modal = document.getElementById('multipleItemsModal');

            // Remove any existing listener to prevent duplicates
            modal.removeEventListener('keydown', keyboardShortcutsHandler);

            // Add the listener
            modal.addEventListener('keydown', keyboardShortcutsHandler);
        }
        
        function navigateToRow(currentElement, direction) {
            const currentRow = currentElement.closest('tr');
            // Find current cell index among editable cells
            const allCells = Array.from(currentRow.cells);
            const editableCells = allCells.filter(cell => {
                const input = cell.querySelector('input, select, textarea');
                if (!input || cell.classList.contains('drag-handle')) {
                    return false;
                }
                // Check for readonly/disabled attributes and styles
                if (input.readOnly || input.disabled) {
                    return false;
                }
                // Check for readonly styling (cursor: not-allowed)
                const styles = window.getComputedStyle(input);
                if (styles.cursor === 'not-allowed') {
                    return false;
                }
                // Additional check for style attribute with cursor: not-allowed
                if (input.style.cursor === 'not-allowed') {
                    return false;
                }
                return true;
            });
            const currentCellIndex = editableCells.findIndex(cell => cell.contains(currentElement));
            
            let targetRow;
            if (direction > 0) {
                // Moving down
                targetRow = currentRow.nextElementSibling;
                if (!targetRow) {
                    // Create new row if at bottom
                    addSpreadsheetRow();
                    targetRow = currentRow.nextElementSibling;
                }
            } else {
                // Moving up
                targetRow = currentRow.previousElementSibling;
            }
            
            if (targetRow && currentCellIndex >= 0) {
                // Get the corresponding cell in the target row (skip drag handle and delete button)
                const targetAllCells = Array.from(targetRow.cells);
                const targetEditableCells = targetAllCells.slice(1, -1);
                if (currentCellIndex < targetEditableCells.length) {
                    const targetCell = targetEditableCells[currentCellIndex];
                    const targetInput = targetCell.querySelector('input, select, textarea');
                    if (targetInput) {
                        targetInput.focus();
                        if (targetInput.select) targetInput.select();
                    }
                }
            }
        }
        
        function navigateToCell(currentElement, direction) {
            const currentRow = currentElement.closest('tr');
            const allCells = Array.from(currentRow.cells);
            
            // Find all editable cells (those with input, select, or textarea that are not readonly/disabled)
            const editableCells = allCells.filter(cell => {
                const input = cell.querySelector('input, select, textarea');
                if (!input || cell.classList.contains('drag-handle')) {
                    return false;
                }
                // Check for readonly/disabled attributes and styles
                if (input.readOnly || input.disabled) {
                    return false;
                }
                // Check for readonly styling (cursor: not-allowed)
                const styles = window.getComputedStyle(input);
                if (styles.cursor === 'not-allowed') {
                    return false;
                }
                // Additional check for style attribute with cursor: not-allowed
                if (input.style.cursor === 'not-allowed') {
                    return false;
                }
                return true;
            });
            
            // Find current cell index among editable cells
            const currentCellIndex = editableCells.findIndex(cell => cell.contains(currentElement));
            
            let targetIndex = currentCellIndex + direction;
            if (targetIndex >= 0 && targetIndex < editableCells.length) {
                const targetCell = editableCells[targetIndex];
                const targetInput = targetCell.querySelector('input, select, textarea');
                if (targetInput) {
                    targetInput.focus();
                    if (targetInput.select) targetInput.select();
                }
            }
        }
        
        function deleteCurrentRow(currentElement) {
            const row = currentElement.closest('tr');
            const deleteBtn = row.querySelector('.delete-row-btn');
            if (deleteBtn) {
                deleteSpreadsheetRow(deleteBtn);
            }
        }
        
        function duplicateCurrentRow(currentElement) {
            const row = currentElement.closest('tr');
            const newRow = row.cloneNode(true);
            
            // Clear values in the new row but keep selections
            newRow.querySelectorAll('input[type="text"], input[type="number"], textarea').forEach(input => {
                if (input.type === 'number') {
                    input.value = '1'; // Reset quantity to 1
                } else {
                    input.value = '';
                }
            });
            
            row.parentNode.insertBefore(newRow, row.nextSibling);
            
            // Focus first input in new row
            const firstInput = newRow.querySelector('input, select, textarea');
            if (firstInput) {
                firstInput.focus();
            }
        }
        
        // Drag and drop functionality
        function setupDragAndDrop() {
            let draggedRow = null;
            
            document.addEventListener('dragstart', function(e) {
                if (e.target.classList.contains('drag-handle')) {
                    draggedRow = e.target.closest('tr');
                    draggedRow.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                }
            });
            
            document.addEventListener('dragend', function(e) {
                if (draggedRow) {
                    draggedRow.classList.remove('dragging');
                    // Remove drag-over class and animations from all rows
                    document.querySelectorAll('.drag-over').forEach(row => {
                        row.classList.remove('drag-over');
                        row.style.animation = '';
                    });
                    draggedRow = null;
                }
            });
            
            document.addEventListener('dragover', function(e) {
                e.preventDefault();
                const targetRow = e.target.closest('tr');
                if (targetRow && targetRow !== draggedRow && targetRow.parentNode.tagName === 'TBODY') {
                    // Remove drag-over from all rows
                    document.querySelectorAll('.drag-over').forEach(row => {
                        row.classList.remove('drag-over');
                    });
                    
                    // Add visual indicator with enhanced feedback
                    targetRow.classList.add('drag-over');
                    
                    // Add a subtle pulse effect for better visibility
                    targetRow.style.animation = 'dragPulse 0.6s ease-in-out infinite alternate';
                }
            });
            
            document.addEventListener('drop', function(e) {
                e.preventDefault();
                const targetRow = e.target.closest('tr');
                
                if (targetRow && draggedRow && targetRow !== draggedRow && 
                    targetRow.parentNode.tagName === 'TBODY') {
                    
                    const tbody = targetRow.parentNode;
                    const draggedIndex = Array.from(tbody.children).indexOf(draggedRow);
                    const targetIndex = Array.from(tbody.children).indexOf(targetRow);
                    
                    if (draggedIndex < targetIndex) {
                        tbody.insertBefore(draggedRow, targetRow.nextSibling);
                    } else {
                        tbody.insertBefore(draggedRow, targetRow);
                    }
                }
                
                // Clean up
                document.querySelectorAll('.drag-over').forEach(row => {
                    row.classList.remove('drag-over');
                    row.style.animation = '';
                });
            });
        }
        
        // Initialize drag handles as draggable
        function makeDragHandlesDraggable() {
            setTimeout(() => {
                document.querySelectorAll('.drag-handle').forEach(handle => {
                    handle.setAttribute('draggable', 'true');
                });
            }, 100);
        }
        
        // Track if user is currently resizing a textarea
        let isResizingTextarea = false;
        let modalDataAutoSave = [];
        
        // Detect when user starts resizing a textarea
        document.addEventListener('mousedown', function(e) {
            if (e.target.tagName === 'TEXTAREA' && e.target.closest('.spreadsheet-table')) {
                // Check if mousedown is near the resize handle (bottom-right corner)
                const rect = e.target.getBoundingClientRect();
                const isNearResizeHandle = (
                    e.clientX > rect.right - 20 &&
                    e.clientY > rect.bottom - 20
                );
                if (isNearResizeHandle) {
                    isResizingTextarea = true;
                }
            }
        });
        
        // Clear resize flag when mouse is released
        document.addEventListener('mouseup', function() {
            isResizingTextarea = false;
        });
        
        // Auto-save modal data on any input change
        function autoSaveModalData() {
            const modal = document.getElementById('multipleItemsModal');
            if (modal.style.display === 'block') {
                const tbody = document.getElementById('spreadsheetBody');
                if (tbody) {
                    modalDataAutoSave = [];
                    tbody.querySelectorAll('tr').forEach(row => {
                        const rowData = {};
                        row.querySelectorAll('input, select, textarea').forEach(input => {
                            const field = input.getAttribute('data-field');
                            if (field) {
                                rowData[field] = input.value;
                            }
                        });
                        if (Object.keys(rowData).length > 0) {
                            modalDataAutoSave.push(rowData);
                        }
                    });
                    // Store in sessionStorage for the current session
                    sessionStorage.setItem('modalDataAutoSave', JSON.stringify(modalDataAutoSave));
                    sessionStorage.setItem('modalProductType', currentProductType);
                }
            }
        }
        
        // Restore modal data if it exists
        function restoreModalData() {
            const savedData = sessionStorage.getItem('modalDataAutoSave');
            const savedProductType = sessionStorage.getItem('modalProductType');
            
            if (savedData && savedProductType === currentProductType) {
                try {
                    const data = JSON.parse(savedData);
                    if (data && data.length > 0) {
                        // Clear existing rows
                        const tbody = document.getElementById('spreadsheetBody');
                        if (!tbody) {
                            console.error('Could not find spreadsheetBody element');
                            return false;
                        }
                        tbody.innerHTML = '';
                        
                        // Restore saved rows
                        data.forEach(rowData => {
                            addSpreadsheetRow(); // Use the correct function name
                            const lastRow = tbody.lastElementChild;
                            
                            // Restore field values
                            Object.keys(rowData).forEach(field => {
                                const input = lastRow.querySelector(`[data-field="${field}"]`);
                                if (input) {
                                    input.value = rowData[field];
                                    // Trigger auto-scale for quantity inputs
                                    if (field === 'quantity' && input.tagName === 'INPUT') {
                                        autoScaleQuantityInput(input);
                                    }
                                    // Trigger auto-resize for textareas
                                    if (input.tagName === 'TEXTAREA') {
                                        autoResizeTextarea(input);
                                    }
                                }
                            });
                        });
                        
                        // Make the restored rows draggable
                        makeDragHandlesDraggable();
                        
                        showModalNotification('Previous data restored', 'info');
                        return true; // Indicate successful restoration
                    }
                } catch (e) {
                    console.error('Error restoring modal data:', e);
                }
            }
            return false; // Indicate no restoration occurred
        }
        
        // Close modal when clicking outside (with safety checks)
        window.onclick = function(event) {
            const modal = document.getElementById('multipleItemsModal');
            const exportModal = document.getElementById('exportSettingsModal');
            const settingsModal = document.getElementById('settingsModal');
            
            // Don't close modal if user is resizing a textarea
            if (isResizingTextarea) {
                return;
            }
            
            // Don't close modal if clicking on a child element
            if (modal && event.target == modal) {
                // Auto-save data before closing
                autoSaveModalData();
                
                // Confirm before closing if there's data
                const hasData = modalDataAutoSave.length > 0;
                if (hasData) {
                    if (confirm('You have unsaved data in the modal. Do you want to close? Your data will be saved for this session.')) {
                        closeModal();
                    }
                } else {
                    closeModal();
                }
            } else if (event.target == exportModal) {
                closeExportSettingsModal();
            } else if (event.target == settingsModal) {
                closeSettingsModal();
            }
        }
        
        // Add event listener for auto-saving on input
        document.addEventListener('input', function(e) {
            if (e.target.closest('#spreadsheetTable')) {
                autoSaveModalData();
            }
        });

        function generateDealershipForm() {
            const html = `
                <h3>Dealership Merchandising Details</h3>
                
                <div class="form-group">
                    <label for="dm_installLocation">Install Location</label>
                    <input type="text" id="dm_installLocation" name="dm_installLocation" placeholder="EX: North Windows, Service Lane, etc. (Indoor/Outdoor - Permanent/Temporary)" oninput="updateSummary()">
                </div>
                
                <div class="form-group">
                    <label for="dm_productType">Product Type</label>
                    <select id="dm_productType" name="dm_productType" onchange="handleDealershipMerchandisingProductType(); updateSummary();">
                        <option value="">Please Select:</option>
                        <option value="Custom Designed Interior Showroom Graphics">Custom Designed Interior Showroom Graphics</option>
                        <option value="Custom Designed Showroom Graphics">Custom Designed Showroom Graphics</option>
                    </select>
                </div>
                
                <div id="dm_nestedFields"></div>
            `;
            
            document.getElementById('order-details').innerHTML = html;
        }

        function handleDealershipMerchandisingProductType() {
            const select = document.getElementById('dm_productType');
            const productType = select.value;
            const container = document.getElementById('dm_nestedFields');
            container.innerHTML = '';
            
            if (!productType) {
                updateSummary();
                return;
            }
            
            let nestedHTML = '';
            
            switch (productType) {
                case 'Custom Designed Interior Showroom Graphics':
                    nestedHTML = `
                        <div class="nested-conditional-fields">
                            <div class="form-group">
                                <label for="dm_isg_surfaceType">Surface Type</label>
                                <select id="dm_isg_surfaceType" name="dm_isg_surfaceType" onchange="handleSurfaceTypeChange(); updateSummary();">
                                    <option value="">Please Select:</option>
                                    <option value="Painted">Painted</option>
                                    <option value="Concrete">Concrete</option>
                                    <option value="Glass">Glass</option>
                                    <option value="Wood">Wood</option>
                                    <option value="Metal">Metal</option>
                                    <option value="Custom">Custom</option>
                                </select>
                            </div>
                            <div class="form-group" id="dm_isg_customSurfaceField" style="display: none;">
                                <label for="dm_isg_customSurface">Custom Surface Type</label>
                                <input type="text" id="dm_isg_customSurface" name="dm_isg_customSurface" placeholder="Enter custom surface type..." oninput="updateSummary()">
                            </div>
                            <div class="form-group">
                                <label for="dm_isg_materialType">Material Type</label>
                                <select id="dm_isg_materialType" name="dm_isg_materialType" oninput="updateSummary()">
                                    <option value="">Please Select:</option>
                                    <option value="Premium Indoor Poly Film">Premium Indoor Poly Film</option>
                                    <option value="Premium Perforated Vinyl">Premium Perforated Vinyl</option>
                                    <option value="Premium Cast Wrap Vinyl">Premium Cast Wrap Vinyl</option>
                                    <option value="Premium Calendared Film">Premium Calendared Film</option>
                                    <option value="Premium Contour Cut Vinyl">Premium Contour Cut Vinyl</option>
                                    <option value="Premium Intermediate Contour Cut Vinyl">Premium Intermediate Contour Cut Vinyl</option>
                                    <option value="Concrete/Floor Vinyl">Concrete/Floor Vinyl</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dm_isg_maxWidth">Max Width</label>
                                <input type="text" id="dm_isg_maxWidth" name="dm_isg_maxWidth" placeholder="Full width of the space where graphics will be installed" oninput="updateSummary()">
                            </div>
                            <div class="form-group">
                                <label for="dm_isg_maxHeight">Max Height</label>
                                <input type="text" id="dm_isg_maxHeight" name="dm_isg_maxHeight" placeholder="Full height of the space where graphics will be installed" oninput="updateSummary()">
                            </div>
                            <div class="form-group">
                                <label for="dm_isg_graphicWidth">Graphic Width</label>
                                <input type="text" id="dm_isg_graphicWidth" name="dm_isg_graphicWidth" placeholder="Desired final width (Type 'TBD' if Production should specify)" oninput="updateSummary()">
                            </div>
                            <div class="form-group">
                                <label for="dm_isg_graphicHeight">Graphic Height</label>
                                <input type="text" id="dm_isg_graphicHeight" name="dm_isg_graphicHeight" placeholder="Desired final height (Type 'TBD' if Production should specify)" oninput="updateSummary()">
                            </div>
                            <div class="form-group">
                                <label for="dm_isg_text">Text</label>
                                <textarea id="dm_isg_text" name="dm_isg_text" placeholder="Enter any text elements..." oninput="updateSummary()"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="dm_isg_designDetails">Design/Layout Details</label>
                                <textarea id="dm_isg_designDetails" name="dm_isg_designDetails" placeholder="Describe design requirements, layout preferences, colors, etc..." oninput="updateSummary()"></textarea>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'Custom Designed Showroom Graphics':
                    nestedHTML = `
                        <div class="nested-conditional-fields">
                            <div class="form-group">
                                <label for="dm_sg_materialType">Material Type</label>
                                <select id="dm_sg_materialType" name="dm_sg_materialType" onchange="updateSummary()">
                                    <option value="">Please Select:</option>
                                    <option value="Premium Solid Window Film">Premium Solid Window Film</option>
                                    <option value="Premium Perforated Window Film">Premium Perforated Window Film</option>
                                    <option value="Premium Perforated Window Mesh">Premium Perforated Window Mesh</option>
                                    <option value="Premium Contour Cut Graphic Film">Premium Contour Cut Graphic Film</option>
                                    <option value="Premium Frosted Window Film">Premium Frosted Window Film</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dm_sg_addLamination">Add Lamination</label>
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" id="dm_sg_lamination_yes" name="dm_sg_addLamination" value="Yes" onchange="updateSummary()">
                                        Yes
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="dm_sg_lamination_no" name="dm_sg_addLamination" value="No" onchange="updateSummary()">
                                        No
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="dm_sg_windowType">Window Type</label>
                                <select id="dm_sg_windowType" name="dm_sg_windowType" onchange="handleWindowTypeChange(); updateSummary();">
                                    <option value="">Please Select:</option>
                                    <option value="Single Panel">Single Panel</option>
                                    <option value="Multi Panel">Multi Panel</option>
                                </select>
                            </div>
                            <div id="dm_sg_multiPanelFields" style="display: none;">
                                <div class="form-group">
                                    <label for="dm_sg_totalWindows">Total Number of Windows</label>
                                    <input type="text" id="dm_sg_totalWindows" name="dm_sg_totalWindows" placeholder="Enter total number of windows" oninput="updateSummary()">
                                </div>
                                <div class="form-group">
                                    <label for="dm_sg_mullions">Mullions</label>
                                    <small>Does your project have mullions?</small>
                                    <div class="radio-group">
                                        <label class="radio-option">
                                            <input type="radio" id="dm_sg_mullions_yes" name="dm_sg_mullions" value="Yes" onchange="handleMullionsChange(); updateSummary();">
                                            Yes
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" id="dm_sg_mullions_no" name="dm_sg_mullions" value="No" onchange="handleMullionsChange(); updateSummary();">
                                            No
                                        </label>
                                    </div>
                                </div>
                                <div id="dm_sg_mullionWidthField" style="display: none;">
                                    <div class="form-group">
                                        <label for="dm_sg_mullionWidth">Mullion Width</label>
                                        <input type="text" id="dm_sg_mullionWidth" name="dm_sg_mullionWidth" placeholder="Enter mullion width" oninput="updateSummary()">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="dm_sg_sizeDetails">Size Details</label>
                                <textarea id="dm_sg_sizeDetails" name="dm_sg_sizeDetails" placeholder="Enter Width and Height of each window (Ex. 1=24&quot; 2=25&quot; 3=24&quot; etc.)" oninput="updateSummary()"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="dm_sg_text">Text</label>
                                <textarea id="dm_sg_text" name="dm_sg_text" placeholder="Enter any text elements..." oninput="updateSummary()"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="dm_sg_designDetails">Design/Layout Details</label>
                                <textarea id="dm_sg_designDetails" name="dm_sg_designDetails" placeholder="Describe design requirements, layout preferences, colors, etc..." oninput="updateSummary()"></textarea>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            container.innerHTML = nestedHTML;
            updateSummary();
        }

        function handleWindowTypeChange() {
            const windowType = document.getElementById('dm_sg_windowType').value;
            const multiPanelFields = document.getElementById('dm_sg_multiPanelFields');
            
            if (windowType === 'Multi Panel') {
                multiPanelFields.style.display = 'block';
            } else {
                multiPanelFields.style.display = 'none';
                document.getElementById('dm_sg_totalWindows').value = '';
                document.querySelectorAll('input[name="dm_sg_mullions"]').forEach(radio => radio.checked = false);
                document.getElementById('dm_sg_mullionWidth').value = '';
                document.getElementById('dm_sg_mullionWidthField').style.display = 'none';
            }
            updateSummary();
        }

        function handleMullionsChange() {
            const mullionsYes = document.getElementById('dm_sg_mullions_yes');
            const mullionWidthField = document.getElementById('dm_sg_mullionWidthField');
            
            if (mullionsYes && mullionsYes.checked) {
                mullionWidthField.style.display = 'block';
            } else {
                mullionWidthField.style.display = 'none';
                document.getElementById('dm_sg_mullionWidth').value = '';
            }
            updateSummary();
        }
        
        function generateCustomForm() {
            const html = `
                <h3>Custom Special Products Details</h3>
                
                <div class="form-group">
                    <label for="csp_installLocation">Install Location</label>
                    <input type="text" id="csp_installLocation" name="csp_installLocation" placeholder="EX: North Windows, Service Lane, etc. (Indoor/Outdoor - Permanent/Temporary)" oninput="updateSummary()">
                </div>
                
                <div class="form-group">
                    <label for="csp_productType">Product Type</label>
                    <input type="text" id="csp_productType" name="csp_productType" placeholder="Enter product type..." oninput="updateSummary()">
                </div>
                
                <div class="form-group">
                    <label for="csp_materialType">Material Type</label>
                    <select id="csp_materialType" name="csp_materialType" onchange="handleCustomMaterialTypeChange()" oninput="updateSummary()">
                        <option value="">Please Select:</option>
                        <option value="Winter Vinyl">Winter Vinyl</option>
                        <option value="Summer Vinyl">Summer Vinyl</option>
                        <option value="Economy Vinyl">Economy Vinyl</option>
                        <option value="Perf Vinyl">Perf Vinyl</option>
                        <option value="Poly-Vinyl">Poly-Vinyl</option>
                        <option value="13oz. Banner">13oz. Banner</option>
                        <option value="18oz. Banner">18oz. Banner</option>
                        <option value="Mesh Banner">Mesh Banner</option>
                        <option value="Poster Paper">Poster Paper</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div id="csp_otherMaterialField" style="display: none;">
                    <div class="form-group">
                        <label for="csp_otherMaterial">Other Material</label>
                        <input type="text" id="csp_otherMaterial" name="csp_otherMaterial" placeholder="Please specify what material you are ordering" oninput="updateSummary()">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="csp_sizeDetails">Size Details</label>
                    <textarea id="csp_sizeDetails" name="csp_sizeDetails" placeholder="Enter size details..." oninput="updateSummary()"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="csp_text">Text</label>
                    <textarea id="csp_text" name="csp_text" placeholder="Enter text content..." oninput="updateSummary()"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="csp_designNotes">Design Notes</label>
                    <textarea id="csp_designNotes" name="csp_designNotes" placeholder="Enter design notes..." oninput="updateSummary()"></textarea>
                </div>
            `;
            
            document.getElementById('order-details').innerHTML = html;
        }
        
        function handleCustomMaterialTypeChange() {
            const materialType = document.getElementById('csp_materialType').value;
            const otherField = document.getElementById('csp_otherMaterialField');
            if (materialType === 'Other') {
                otherField.style.display = 'block';
            } else {
                otherField.style.display = 'none';
                document.getElementById('csp_otherMaterial').value = '';
            }
            updateSummary();
        }
        
        function generateTemplateForm() {
            const html = `
                <h3>New Template Request Details</h3>
                
                <div class="form-group">
                    <label for="ntr_requestType">Request Type</label>
                    <select id="ntr_requestType" name="ntr_requestType" onchange="handleNewTemplateRequestType(); updateSummary();">
                        <option value="">Please Select:</option>
                        <option value="New Standard Graphic">New Standard Graphic</option>
                        <option value="ShortCut Template">ShortCut Template</option>
                        <option value="Flyout Template">Flyout Template</option>
                    </select>
                </div>
                
                <div id="ntr_nestedFields"></div>
            `;
            
            document.getElementById('order-details').innerHTML = html;
        }
        
        function handleNewTemplateRequestType() {
            const requestType = document.getElementById('ntr_requestType').value;
            const container = document.getElementById('ntr_nestedFields');
            container.innerHTML = '';
            
            if (!requestType) {
                updateSummary();
                return;
            }
            
            let nestedHTML = '';
            
            switch (requestType) {
                case 'New Standard Graphic':
                    nestedHTML = `
                        <div class="nested-conditional-fields">
                            <div class="form-group">
                                <label for="ntr_nsg_templateName">New Template Name</label>
                                <input type="text" id="ntr_nsg_templateName" name="ntr_nsg_templateName" placeholder="Enter template name..." oninput="updateSummary()">
                            </div>

                            <div class="form-group">
                                <label for="ntr_nsg_details">Details</label>
                                <small>Color Schemes, References to Design Styles, Anything else we need to know</small>
                                <textarea id="ntr_nsg_details" name="ntr_nsg_details" placeholder="Color Schemes, References to Design Styles, Anything else we need to know" oninput="updateSummary()"></textarea>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'ShortCut Template':
                    nestedHTML = `
                        <div class="nested-conditional-fields">
                            <div class="form-group">
                                <label for="ntr_sct_templateName">New Template Name</label>
                                <input type="text" id="ntr_sct_templateName" name="ntr_sct_templateName" placeholder="Enter template name..." oninput="updateSummary()">
                            </div>

                            <div class="form-group">
                                <label for="ntr_sct_orderType">SCP Order Type</label>
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_design_consult" name="ntr_sct_orderType" value="Design Consult (No Scraper)" oninput="updateSummary()">
                                        Design Consult (No Scraper)
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_program_approval" name="ntr_sct_orderType" value="Program Approval (Scraper & Creative)" oninput="updateSummary()">
                                        Program Approval (Scraper & Creative)
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="ntr_sct_newCarCoverage">New Car Coverage</label>
                                <div class="radio-group radio-vertical">
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_new_shortcut_pack" name="ntr_sct_newCarCoverage" value="ShortCut Pack" oninput="updateSummary()">
                                        ShortCut Pack
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_new_shortcut_only" name="ntr_sct_newCarCoverage" value="ShortCut ONLY" oninput="updateSummary()">
                                        ShortCut ONLY
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_new_windshield_only" name="ntr_sct_newCarCoverage" value="Windshield ONLY" oninput="updateSummary()">
                                        Windshield ONLY
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_new_none" name="ntr_sct_newCarCoverage" value="NONE" oninput="updateSummary()">
                                        NONE
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="ntr_sct_usedCarCoverage">Used Car Coverage</label>
                                <div class="radio-group radio-vertical">
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_used_shortcut_pack" name="ntr_sct_usedCarCoverage" value="ShortCut Pack" oninput="updateSummary()">
                                        ShortCut Pack
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_used_shortcut_only" name="ntr_sct_usedCarCoverage" value="ShortCut ONLY" oninput="updateSummary()">
                                        ShortCut ONLY
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_used_windshield_only" name="ntr_sct_usedCarCoverage" value="Windshield ONLY" oninput="updateSummary()">
                                        Windshield ONLY
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_used_none" name="ntr_sct_usedCarCoverage" value="NONE" oninput="updateSummary()">
                                        NONE
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="ntr_sct_orderEntryMethod">Order Entry Method</label>
                                <div class="radio-group radio-vertical">
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_lot_walk" name="ntr_sct_orderEntryMethod" value="Lot Walk/Manual Entry" oninput="updateSummary()">
                                        Lot Walk/Manual Entry
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_automated" name="ntr_sct_orderEntryMethod" value="Automated- Every Vehicle  Difference" oninput="updateSummary()">
                                        Automated- Every Vehicle  Difference
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_cx_provided" name="ntr_sct_orderEntryMethod" value="CX Provided List" oninput="updateSummary()">
                                        CX Provided List
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_other_entry" name="ntr_sct_orderEntryMethod" value="Other" oninput="updateSummary()">
                                        Other
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="ntr_sct_startupOrder">Startup order</label>
                                <div class="radio-group radio-vertical">
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_full_coverage" name="ntr_sct_startupOrder" value="Full Coverage" oninput="updateSummary()">
                                        Full Coverage
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_transitional" name="ntr_sct_startupOrder" value="Transitional" oninput="updateSummary()">
                                        Transitional
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_cx_provided_startup" name="ntr_sct_startupOrder" value="CX Provided List" oninput="updateSummary()">
                                        CX Provided List
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_other_startup" name="ntr_sct_startupOrder" value="Other" oninput="updateSummary()">
                                        Other
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="ntr_sct_desiredShape">Desired Shape</label>
                                <div class="radio-group radio-vertical">
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_v1_rectangle" name="ntr_sct_desiredShape" value="V1  Rectangle" oninput="updateSummary()">
                                        V1  Rectangle
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_v2_tanto" name="ntr_sct_desiredShape" value="V2  Tanto" oninput="updateSummary()">
                                        V2  Tanto
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_v3_pennant" name="ntr_sct_desiredShape" value="V3  Pennant" oninput="updateSummary()">
                                        V3  Pennant
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="ntr_sct_no_preference" name="ntr_sct_desiredShape" value="No Preference" oninput="updateSummary()">
                                        No Preference
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="ntr_sct_details">Details</label>
                                <small>Color Schemes, References to Design Styles, Anything else we need to know</small>
                                <textarea id="ntr_sct_details" name="ntr_sct_details" placeholder="Color Schemes, References to Design Styles, Anything else we need to know" oninput="updateSummary()"></textarea>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'Flyout Template':
                    nestedHTML = `
                        <div class="nested-conditional-fields">
                            <div class="form-group">
                                <label for="ntr_ft_templateName">New Template Name</label>
                                <input type="text" id="ntr_ft_templateName" name="ntr_ft_templateName" placeholder="Enter template name..." oninput="updateSummary()">
                            </div>

                            <div class="form-group">
                                <label for="ntr_ft_details">Details</label>
                                <small>Color Schemes, References to Design Styles, Anything else we need to know</small>
                                <textarea id="ntr_ft_details" name="ntr_ft_details" placeholder="Color Schemes, References to Design Styles, Anything else we need to know" oninput="updateSummary()"></textarea>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            container.innerHTML = nestedHTML;
            updateSummary();
        }

        function handleTemplateTypeChange() {
            const templateType = document.getElementById('ntr_templateType').value;
            const container = document.getElementById('ntr_nestedFields');
            container.innerHTML = '';
            
            if (!templateType) {
                updateSummary();
                return;
            }
            
            let nestedHTML = '';
            
            switch (templateType) {
                case 'Windshield Banner':
                    nestedHTML = `
                        <div class="nested-conditional-fields">
                            <div class="form-group">
                                <label for="ntr_wb_size">Size</label>
                                <input type="text" id="ntr_wb_size" name="ntr_wb_size" placeholder="Enter size..." oninput="updateSummary()">
                            </div>
                            <div class="form-group">
                                <label for="ntr_wb_design">Design Requirements</label>
                                <textarea id="ntr_wb_design" name="ntr_wb_design" placeholder="Describe design requirements..." oninput="updateSummary()"></textarea>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'Flyout Template':
                    nestedHTML = `
                        <div class="nested-conditional-fields">
                            <div class="form-group">
                                <label for="ntr_ft_templateName">New Template Name</label>
                                <input type="text" id="ntr_ft_templateName" name="ntr_ft_templateName" placeholder="Enter template name..." oninput="updateSummary()">
                            </div>
                            <div class="form-group">
                                <label for="ntr_ft_details">Details</label>
                                <small>Color Schemes, References to Design Styles, Anything else we need to know</small>
                                <textarea id="ntr_ft_details" name="ntr_ft_details" placeholder="Color Schemes, References to Design Styles, Anything else we need to know" oninput="updateSummary()"></textarea>
                            </div>
                        </div>
                    `;
                    break;
                    
                default:
                    nestedHTML = `
                        <div class="nested-conditional-fields">
                            <div class="form-group">
                                <label for="ntr_generic_requirements">Template Requirements</label>
                                <textarea id="ntr_generic_requirements" name="ntr_generic_requirements" placeholder="Describe template requirements..." oninput="updateSummary()"></textarea>
                            </div>
                        </div>
                    `;
            }
            
            container.innerHTML = nestedHTML;
            updateSummary();
        }
        
        function generateBusinessCardsForm() {
            const html = `
                <h3>Business Cards Details</h3>
                
                <div class="form-group">
                    <label for="bc_singleOrDouble">Single or Double Sided</label>
                    <select id="bc_singleOrDouble" name="bc_singleOrDouble" oninput="updateSummary()">
                        <option value="">Select</option>
                        <option value="Single Sided">Single Sided</option>
                        <option value="Double Sided">Double Sided</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="bc_quantity">Quantity</label>
                    <select id="bc_quantity" name="bc_quantity" oninput="updateSummary()">
                        <option value="">Select</option>
                        <option value="250">250</option>
                        <option value="500">500</option>
                        <option value="1000">1000</option>
                        <option value="2500">2500</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="bc_text">Text</label>
                    <textarea id="bc_text" name="bc_text" placeholder="Email, Phone Number, Name, etc." oninput="updateSummary()"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="bc_description">Description</label>
                    <textarea id="bc_description" name="bc_description" placeholder="Any other additional details like design style or color." oninput="updateSummary()"></textarea>
                </div>
            `;
            
            document.getElementById('order-details').innerHTML = html;
        }
        
        function generateBannersForm() {
            const html = `
                <h3>Custom Banners Details</h3>
                
                <div class="form-group">
                    <label for="cb_bannerType">Banner Type <span class="required">*</span></label>
                    <select id="cb_bannerType" name="cb_bannerType" required onchange="handleCustomBannerType()">
                        <option value="">Please Select</option>
                        <option value="Standard Banner">Standard Banner</option>
                        <option value="Pole Banner">Pole Banner</option>
                    </select>
                </div>
                
                <div id="cb_nestedFields"></div>
            `;
            
            document.getElementById('order-details').innerHTML = html;
        }

        function handleCustomBannerType() {
            const bannerType = document.getElementById('cb_bannerType').value;
            const container = document.getElementById('cb_nestedFields');
            container.innerHTML = '';
            
            if (!bannerType) {
                updateSummary();
                return;
            }
            
            let nestedHTML = '';
            
            switch (bannerType) {
                case 'Standard Banner':
                    nestedHTML = `
                        <div class="nested-conditional-fields">
                            <div class="form-group">
                                <label for="cb_sb_materialType">Material Type</label>
                                <select id="cb_sb_materialType" name="cb_sb_materialType" oninput="updateSummary()">
                                    <option value="">Please Select:</option>
                                    <option value="13oz Banner">13oz Banner</option>
                                    <option value="18oz Banner">18oz Banner</option>
                                    <option value="Mesh Banner">Mesh Banner</option>
                                    <option value="No-Curl/Grey Back Banner">No-Curl/Grey Back Banner</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cb_sb_width">Width</label>
                                <input type="text" id="cb_sb_width" name="cb_sb_width" placeholder="Enter width..." oninput="updateSummary()">
                            </div>
                            <div class="form-group">
                                <label for="cb_sb_height">Height</label>
                                <input type="text" id="cb_sb_height" name="cb_sb_height" placeholder="Enter height..." oninput="updateSummary()">
                            </div>
                            <div class="form-group">
                                <label for="cb_sb_text">Text</label>
                                <textarea id="cb_sb_text" name="cb_sb_text" placeholder="Enter text content..." oninput="updateSummary()"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="cb_sb_designNotes">Design Notes</label>
                                <textarea id="cb_sb_designNotes" name="cb_sb_designNotes" placeholder="Enter design notes..." oninput="updateSummary()"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="cb_sb_finishing">Finishing <span class="required">*</span></label>
                                <select id="cb_sb_finishing" name="cb_sb_finishing" required onchange="handleFinishingChange()" oninput="updateSummary()">
                                    <option value="">Please Select</option>
                                    <option value="Standard 1&quot; Hems">Standard 1" Hems</option>
                                    <option value="Double Stick Edges (No Hems)">Double Stick Edges (No Hems)</option>
                                    <option value="Trimmed to Size (No Hems)">Trimmed to Size (No Hems)</option>
                                    <option value="Sewn Hems with Webbing">Sewn Hems with Webbing</option>
                                    <option value="Other/Custom">Other/Custom</option>
                                </select>
                            </div>
                            <div id="cb_sb_customFinishingField" style="display: none;">
                                <div class="form-group">
                                    <label for="cb_sb_customFinishing">Custom Finishing Description</label>
                                    <input type="text" id="cb_sb_customFinishing" name="cb_sb_customFinishing" placeholder="Describe custom finishing..." oninput="updateSummary()">
                                </div>
                            </div>
                            <div id="cb_sb_hemsOptionsField" style="display: none;">
                                <div class="form-group">
                                    <label for="cb_sb_powerTape">Power Tape</label>
                                    <div class="radio-group">
                                        <label class="radio-option">
                                            <input type="radio" id="cb_sb_powerTape_yes" name="cb_sb_powerTape" value="Yes" oninput="updateSummary()">
                                            Yes
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" id="cb_sb_powerTape_no" name="cb_sb_powerTape" value="No" oninput="updateSummary()">
                                            No
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="cb_sb_bravoTabs">Bravo Tabs</label>
                                    <div class="radio-group">
                                        <label class="radio-option">
                                            <input type="radio" id="cb_sb_bravoTabs_corner" name="cb_sb_bravoTabs" value="In Corner Only" oninput="updateSummary()">
                                            In Corner Only
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" id="cb_sb_bravoTabs_grommet" name="cb_sb_bravoTabs" value="Each Grommet" oninput="updateSummary()">
                                            Each Grommet
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" id="cb_sb_bravoTabs_no" name="cb_sb_bravoTabs" value="No Bravo Tabs" oninput="updateSummary()">
                                            No Bravo Tabs
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="cb_sb_grommets">Grommets</label>
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" id="cb_sb_grommets_yes" name="cb_sb_grommets" value="Yes" onchange="handleGrommetsChange()">
                                        Yes
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" id="cb_sb_grommets_no" name="cb_sb_grommets" value="No" onchange="handleGrommetsChange()">
                                        No
                                    </label>
                                </div>
                            </div>
                            <div id="cb_sb_grommetFields" style="display: none;">
                                <div class="form-group">
                                    <label for="cb_sb_grommetPattern">Grommet Pattern <span class="required">*</span></label>
                                    <select id="cb_sb_grommetPattern" name="cb_sb_grommetPattern" onchange="handleGrommetPatternChange()">
                                        <option value="">Please Select:</option>
                                        <option value="3 Pole Mounting (Corners & Middle)">3 Pole Mounting (Corners & Middle)</option>
                                        <option value="4 Pole Mounting (Corners & 2 Interior)">4 Pole Mounting (Corners & 2 Interior)</option>
                                        <option value="Corners Only">Corners Only</option>
                                        <option value='Every 12" (Approximate)'>Every 12" (Approximate)</option>
                                        <option value='Every 24" (Approximate)'>Every 24" (Approximate)</option>
                                        <option value="Custom">Custom</option>
                                    </select>
                                </div>
                            </div>
                            <div id="cb_sb_customGrommetField" style="display: none;">
                                <div class="form-group">
                                    <label for="cb_sb_customGrommet">Custom Grommet Pattern Description</label>
                                    <input type="text" id="cb_sb_customGrommet" name="cb_sb_customGrommet" placeholder="Describe custom grommet pattern..." oninput="updateSummary()">
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'Pole Banner':
                    nestedHTML = `
                        <div class="nested-conditional-fields">
                            <div class="form-group">
                                <label for="cb_pb_size">Size <span class="required">*</span></label>
                                <select id="cb_pb_size" name="cb_pb_size" required oninput="updateSummary()">
                                    <option value="">Please Select</option>
                                    <option value="24\" x 36\"">24" x 36"</option>
                                    <option value="24\" x 48\"">24" x 48"</option>
                                    <option value="24\" x 60\"">24" x 60"</option>
                                    <option value="24\" x 72\"">24" x 72"</option>
                                    <option value="24\" x 96\"">24" x 96"</option>
                                    <option value="30\" x 48\"">30" x 48"</option>
                                    <option value="30\" x 60\"">30" x 60"</option>
                                    <option value="30\" x 72\"">30" x 72"</option>
                                    <option value="30\" x 84\"">30" x 84"</option>
                                    <option value="30\" x 96\"">30" x 96"</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cb_pb_materialType">Material Type</label>
                                <select id="cb_pb_materialType" name="cb_pb_materialType" oninput="updateSummary()">
                                    <option value="13oz Banner">13oz Banner</option>
                                    <option value="18oz Banner" selected>18oz Banner</option>
                                    <option value="Mesh Banner">Mesh Banner</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cb_pb_pocketSize">Pocket Size <span class="required">*</span></label>
                                <select id="cb_pb_pocketSize" name="cb_pb_pocketSize" required onchange="handlePocketSizeChange()" oninput="updateSummary()">
                                    <option value="">Please Select</option>
                                    <option value="Standard">Standard</option>
                                    <option value="Custom">Custom</option>
                                </select>
                            </div>
                            <div class="form-group" id="cb_pb_customPocketField" style="display: none;">
                                <label for="cb_pb_customPocket">Custom Pocket Size Details</label>
                                <input type="text" id="cb_pb_customPocket" name="cb_pb_customPocket" placeholder="Enter custom pocket size details..." oninput="updateSummary()">
                            </div>
                            <div class="form-group">
                                <label for="cb_pb_side1Design">Side 1 Design/Layout Details</label>
                                <textarea id="cb_pb_side1Design" name="cb_pb_side1Design" placeholder="Enter Side 1 design and layout details..." oninput="updateSummary()"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="cb_pb_side2Design">Side 2 Design/Layout Details</label>
                                <textarea id="cb_pb_side2Design" name="cb_pb_side2Design" placeholder="Enter Side 2 design and layout details..." oninput="updateSummary()"></textarea>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            container.innerHTML = nestedHTML;
            updateSummary();
        }

        function handleFinishingChange() {
            const finishing = document.getElementById('cb_sb_finishing').value;
            const customField = document.getElementById('cb_sb_customFinishingField');
            const hemsOptionsField = document.getElementById('cb_sb_hemsOptionsField');
            
            console.log('Finishing selected:', finishing); // Debug log
            console.log('Hems field element:', hemsOptionsField); // Debug log
            
            // Handle custom finishing field
            if (finishing === 'Other/Custom') {
                if (customField) customField.style.display = 'block';
            } else {
                if (customField) customField.style.display = 'none';
                const customInput = document.getElementById('cb_sb_customFinishing');
                if (customInput) customInput.value = '';
            }
            
            // Handle hems options field (Power Tape and Bravo Tabs)
            // Check for both possible encodings of the quote character
            if (finishing === 'Standard 1&quot; Hems' || finishing === 'Standard 1" Hems' || finishing.includes('Standard 1') && finishing.includes('Hems')) {
                console.log('Showing hems options field'); // Debug log
                if (hemsOptionsField) hemsOptionsField.style.display = 'block';
            } else {
                if (hemsOptionsField) hemsOptionsField.style.display = 'none';
                // Clear radio button selections when hidden
                document.querySelectorAll('input[name="cb_sb_powerTape"]').forEach(radio => radio.checked = false);
                document.querySelectorAll('input[name="cb_sb_bravoTabs"]').forEach(radio => radio.checked = false);
            }
            
            updateSummary();
        }

        function handlePocketSizeChange() {
            const pocketSize = document.getElementById('cb_pb_pocketSize').value;
            const customField = document.getElementById('cb_pb_customPocketField');
            
            if (pocketSize === 'Custom') {
                customField.style.display = 'block';
            } else {
                customField.style.display = 'none';
                const customInput = document.getElementById('cb_pb_customPocket');
                if (customInput) customInput.value = '';
            }
            updateSummary();
        }

        function handleGrommetsChange() {
            const grommetsYes = document.getElementById('cb_sb_grommets_yes');
            const grommetFields = document.getElementById('cb_sb_grommetFields');
            const customGrommetField = document.getElementById('cb_sb_customGrommetField');
            
            if (grommetsYes && grommetsYes.checked) {
                grommetFields.style.display = 'block';
            } else {
                grommetFields.style.display = 'none';
                customGrommetField.style.display = 'none';
                const grommetPattern = document.getElementById('cb_sb_grommetPattern');
                if (grommetPattern) grommetPattern.value = '';
                const customGrommet = document.getElementById('cb_sb_customGrommet');
                if (customGrommet) customGrommet.value = '';
            }
            updateSummary();
        }

        function handleSurfaceTypeChange() {
            const surfaceType = document.getElementById('dm_isg_surfaceType').value;
            const customField = document.getElementById('dm_isg_customSurfaceField');
            
            if (surfaceType === 'Custom') {
                customField.style.display = 'block';
            } else {
                customField.style.display = 'none';
                const customInput = document.getElementById('dm_isg_customSurface');
                if (customInput) customInput.value = '';
            }
            updateSummary();
        }

        function handleGrommetPatternChange() {
            const pattern = document.getElementById('cb_sb_grommetPattern').value;
            const customField = document.getElementById('cb_sb_customGrommetField');
            
            if (pattern === 'Custom') {
                customField.style.display = 'block';
            } else {
                customField.style.display = 'none';
                const customInput = document.getElementById('cb_sb_customGrommet');
                if (customInput) customInput.value = '';
            }
            updateSummary();
        }


        // Mobile-specific enhancements
        function initializeMobileEnhancements() {
            // Detect mobile device
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
            
            if (isMobile) {
                // Add mobile class to body
                document.body.classList.add('mobile-device');
                
                // Enhanced touch feedback for buttons
                const buttons = document.querySelectorAll('.btn, .add-row-btn, .clear-table-btn, .export-btn, .copy-btn');
                buttons.forEach(button => {
                    button.addEventListener('touchstart', function() {
                        this.style.transform = 'scale(0.98)';
                        this.style.transition = 'transform 0.1s ease';
                    });
                    
                    button.addEventListener('touchend', function() {
                        setTimeout(() => {
                            this.style.transform = 'scale(1)';
                        }, 100);
                    });
                });
                
                // Double-tap to edit cells in mobile
                let lastTap = 0;
                document.addEventListener('touchend', function(e) {
                    const currentTime = new Date().getTime();
                    const tapLength = currentTime - lastTap;
                    
                    if (tapLength < 500 && tapLength > 0) {
                        const target = e.target;
                        if (target.closest('.spreadsheet-table td')) {
                            const input = target.closest('td').querySelector('input, textarea, select');
                            if (input) {
                                input.focus();
                                if (input.type === 'text' || input.tagName === 'TEXTAREA') {
                                    input.select();
                                }
                            }
                        }
                    }
                    lastTap = currentTime;
                });
                
                // Swipe to close modal (swipe down)
                let touchStartY = 0;
                const modals = document.querySelectorAll('.modal');
                
                modals.forEach(modal => {
                    modal.addEventListener('touchstart', function(e) {
                        touchStartY = e.touches[0].clientY;
                    });
                    
                    modal.addEventListener('touchmove', function(e) {
                        const touchY = e.touches[0].clientY;
                        const diffY = touchY - touchStartY;
                        
                        // If swiping down more than 100px and starting from top area
                        if (diffY > 100 && touchStartY < 100) {
                            e.preventDefault();
                            closeModal();
                        }
                    });
                });
                
                // Improve scroll behavior for modal tables
                const modalBodies = document.querySelectorAll('.modal-body');
                modalBodies.forEach(body => {
                    body.style.webkitOverflowScrolling = 'touch';
                    body.style.overflowScrolling = 'touch';
                });
                
                // Prevent zoom on input focus for iOS
                const inputs = document.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    input.addEventListener('focus', function() {
                        this.style.fontSize = '16px';
                    });
                });
                
                // Add haptic feedback simulation
                function simulateHaptic() {
                    if (navigator.vibrate) {
                        navigator.vibrate(50);
                    }
                }
                
                // Apply haptic feedback to important actions
                const importantButtons = document.querySelectorAll('.btn-primary, .add-row-btn, .clear-table-btn');
                importantButtons.forEach(button => {
                    button.addEventListener('click', simulateHaptic);
                });
                
                // Optimize touch scrolling for horizontal tables
                const tables = document.querySelectorAll('.spreadsheet-table');
                tables.forEach(table => {
                    table.style.touchAction = 'pan-x pan-y';
                });
                
                console.log('Mobile enhancements initialized');
            }
        }

        // Initialize mobile enhancements when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeMobileEnhancements);
        
        // Re-initialize on window resize (orientation change)
        window.addEventListener('resize', function() {
            setTimeout(initializeMobileEnhancements, 250);
        });

        // Mobile Summary Modal Functions
        function openMobileSummary() {
            alert('Summary FAB tapped!'); // Immediate feedback
            console.log('openMobileSummary called'); // Debug log
            
            // Update mobile summary content with current desktop summary
            const desktopSummary = document.getElementById('summary-content');
            const mobileSummary = document.getElementById('mobile-summary-content');
            
            console.log('Desktop summary found:', !!desktopSummary); // Debug log
            console.log('Mobile summary found:', !!mobileSummary); // Debug log
            
            if (desktopSummary && mobileSummary) {
                mobileSummary.innerHTML = desktopSummary.innerHTML;
            }
            
            // Show modal
            const modal = document.getElementById('mobileSummaryModal');
            console.log('Modal found:', !!modal); // Debug log
            
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
                console.log('Modal display set to block'); // Debug log
                
                // Add haptic feedback for mobile
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
            } else {
                console.error('mobileSummaryModal not found!');
            }
        }

        function closeMobileSummary() {
            const modal = document.getElementById('mobileSummaryModal');
            if (modal) {
                modal.style.display = 'none';
                // Restore background scrolling with a small delay to prevent issues
                setTimeout(() => {
                    document.body.style.overflow = '';
                }, 10);
            }
        }
        
        // Clear form function for FAB
        function confirmClearForm() {
            if (confirm('Are you sure you want to clear all form data? This action cannot be undone.')) {
                // Clear all form inputs
                const form = document.querySelector('form');
                if (form) {
                    form.reset();
                }
                
                // Clear any data tables
                const summaryTable = document.querySelector('#data-table tbody');
                if (summaryTable) {
                    summaryTable.innerHTML = '';
                }
                
                // Reset global variables
                currentOrderType = '';
                currentProductType = '';
                multipleItemsData = [];
                selectedWindshieldSize = '';
                selectedBodySidesSize = '';
                selectedWindshieldsSize = '';
                selectedComplementsSize = '';
                selectedWindshieldType = '';
                selectedBodySideType = '';
                selectedComplementType = '';
                
                // Hide order details
                const orderDetails = document.getElementById('order-details');
                if (orderDetails) {
                    orderDetails.classList.add('hidden');
                }
                
                // Reset order type select
                const orderTypeSelect = document.getElementById('orderTypeSelect');
                if (orderTypeSelect) {
                    orderTypeSelect.value = '';
                }
                
                // Update summary
                updateSummary();
                
                // Clear cached data
                localStorage.removeItem(CACHE_KEY);
                
                // Show confirmation
                alert('Form cleared successfully!');
            }
        }

        // Update mobile summary whenever desktop summary updates
        function updateMobileSummary() {
            const desktopSummary = document.getElementById('summary-content');
            const mobileSummary = document.getElementById('mobile-summary-content');
            
            if (desktopSummary && mobileSummary) {
                mobileSummary.innerHTML = desktopSummary.innerHTML;
            }
        }

        // Override the existing updateSummary function to also update mobile
        const originalUpdateSummary = updateSummary;
        updateSummary = function() {
            // Call original function
            if (originalUpdateSummary) {
                originalUpdateSummary();
            }
            
            // Update mobile summary as well
            setTimeout(updateMobileSummary, 100);
        };

        // Close modal when clicking outside of it
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('mobileSummaryModal');
            if (event.target === modal) {
                closeMobileSummary();
            }
        });

        // Handle escape key to close mobile modal
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('mobileSummaryModal');
                if (modal && modal.style.display === 'block') {
                    closeMobileSummary();
                }
            }
        });

        // Show/hide mobile FAB based on screen size
        function toggleMobileFAB() {
            const fabContainer = document.querySelector('.mobile-fab-container');
            if (fabContainer) {
                if (window.innerWidth <= 768) {
                    fabContainer.style.display = 'flex';
                } else {
                    fabContainer.style.display = 'none';
                }
            }
        }

        // Initialize FAB visibility
        document.addEventListener('DOMContentLoaded', toggleMobileFAB);
        window.addEventListener('resize', toggleMobileFAB);
    </script>
</body>
</html>